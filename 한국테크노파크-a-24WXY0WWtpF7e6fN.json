{"createdAt":"2025-06-18T02:22:42.020Z","updatedAt":"2025-06-18T09:02:57.107Z","id":"24WXY0WWtpF7e6fN","name":"한국테크노파크-a","active":false,"isArchived":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"dca754ac-4479-4295-ab21-47d895f62cae","name":"pblanc_nm","value":"={{ $json.output.pblanc_nm }}","type":"string"},{"id":"0f927bf2-d7a7-4973-aac7-2717bed23371","name":"jrsd_instt_nm","value":"={{ $json.output.jrsd_instt_nm }}","type":"string"},{"id":"8d6fa575-7d4d-44d6-aaf8-9f967d478af6","name":"bsns_sumry_cn","value":"={{ $json.output.bsns_sumry_cn }}","type":"string"},{"id":"01a4c2d1-ab75-4e73-90a8-7bf79e5f8cd5","name":"trget_nm","value":"={{ $json.output.trget_nm }}","type":"string"},{"id":"9507037a-7c15-4819-8357-0805d0904d7c","name":"reqst_begin_end_de","value":"={{ $json.output.reqst_begin_end_de }}","type":"string"},{"id":"47c24bf8-ce6b-40be-a8fd-93d8d1b03a19","name":"reqst_begin_dt","value":"={{ $json.output.reqst_begin_dt.replaceAll('. ','-').replaceAll('.','') }}","type":"string"},{"id":"e3053a53-0200-4b96-88df-30b9bec65e62","name":"reqst_end_dt","value":"={{ $json.output.reqst_end_dt.replaceAll('. ','-').replaceAll('.','') }}","type":"string"},{"id":"b78de255-6269-44b3-9097-50b993f40bfc","name":"refrnc_nm","value":"={{ $json.output.refrnc_nm }}","type":"string"},{"id":"b5e49522-9965-4e13-90b1-86edf56df9c2","name":"print_flpth_nm","value":"={{ $('Edit Fields2').item.json.print_flpth_nm }}","type":"string"},{"id":"7e662533-f931-4a90-9dfb-f1386c206c8f","name":"print_file_nm","value":"={{ $('Edit Fields2').item.json.print_file_nm }}","type":"string"},{"id":"607940df-de0c-4780-b040-d59037564076","name":"flpth_nm","value":"={{ $('Edit Fields2').item.json.flpth_nm }}","type":"string"},{"id":"1c9dd011-16d0-42d5-b17d-342b58975048","name":"file_nm","value":"={{ $('Edit Fields2').item.json.file_nm }}","type":"string"},{"id":"aff536ed-a418-4150-b586-d8f02a29010a","name":"is_classified","value":"N","type":"string"},{"id":"9f54d932-dd37-4175-b8cb-2d855891f65f","name":"subsidy_amount","value":"null","type":"object"},{"id":"8e2d8fb4-cebd-42c1-b12a-e673a77fc802","name":"self_contribution_rate","value":"null","type":"object"},{"id":"f12e819d-409d-436e-b658-684ba9ac8e30","name":"support_target","value":"null","type":"object"},{"id":"83e3ad1a-3ad2-4b72-a477-b123113b2e4a","name":"bonus_points_factors","value":"null","type":"object"},{"id":"d324fdce-53d0-453d-a211-7318d5935647","name":"total_budget","value":"null","type":"object"},{"id":"ad017264-5276-4798-91e5-7bf6f8a07b31","name":"subsidy_amount_type","value":"text","type":"string"},{"id":"0839db3e-060e-4a18-9831-915f28600652","name":"total_budget_type","value":"text","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[220,60],"id":"89f6a024-d1b1-4427-b651-f0eb6eaca95f","name":"ai result"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[440,60],"id":"50bcca67-8b94-4b25-bb6d-0d65c54675c1","name":"MySQL","credentials":{"mySql":{"id":"s7XNBHZtTOH7C66M","name":"MySQL account 2"}}},{"parameters":{"jsCode":"return $input.first().json.imgs.map((img) =>{\n  // const match = img.match(/(?:\\?|&)attachNo=([0-9]+)(?:&|$)/);\n  // const match2 = match[0].replaceAll(\"'\", \"\");\n\n  return {img: img};\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-980,560],"id":"fec91cd9-c89d-4600-8725-056f5b155fc3","name":"prepare image addr"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"2dc520aa-302e-48dc-baea-0fb26153154b","name":"do ocr1","type":"n8n-nodes-base.httpRequest","position":[640,600],"typeVersion":4.2,"alwaysOutputData":true},{"parameters":{"url":"={{ $json.base_url + $json.board_list}}","responseFormat":"string","options":{}},"name":"board list1","type":"n8n-nodes-base.httpRequest","position":[-2980,560],"typeVersion":1,"id":"fc31675a-0a6c-4647-8e6b-04ab2422d03e"},{"parameters":{"extractionValues":{"values":[{"key":"announcements","cssSelector":"table > tbody > tr > td > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"name":"html extract board detail list1","type":"n8n-nodes-base.htmlExtract","position":[-2760,560],"typeVersion":1,"id":"449d331c-3e0d-4c36-9fa0-bfff87cec339"},{"parameters":{"functionCode":"return items[0].json.announcements.map(function(announcement) {\n  const match = announcement.match(/'(\\d{8})'/);\n  const match2 = match[0].replaceAll(\"'\", \"\");\n  match2.trim();\n  return {\n  json: {announcement: match2}\n  }\n});"},"name":"Prepare announcement1","type":"n8n-nodes-base.function","position":[-2420,560],"typeVersion":1,"id":"ffb19ad5-abf2-4c47-9f86-21daf73c82a0"},{"parameters":{"url":"={{ $('변수설정1').item.json.base_url + $('변수설정1').item.json.board_list }}?View&boardNo={{ $json.announcement }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1940,580],"id":"e7fc1499-e8b5-4799-9b96-d23297f8963b","name":"get detail1"},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"=data","extractionValues":{"values":[{"key":"img","cssSelector":"table > tbody > tr > td > div > p > a > img","returnValue":"attribute","attribute":"src","returnArray":true},{"key":"img2","cssSelector":".table-cont > p > img","returnValue":"attribute","attribute":"src","returnArray":true},{"key":"title","cssSelector":".board-write > tbody > tr:nth-child(1) > td"},{"key":"download","cssSelector":".board-write > tbody > tr > td > .downfile-list > li > a","returnValue":"attribute","attribute":"onclick","returnArray":true},{"key":"author","cssSelector":".board-write > tbody > tr:nth-child(2) > td"},{"key":"date","cssSelector":".board-write > tbody > tr:nth-child(3) > td"},{"key":"download-file-name","cssSelector":".board-write > tbody > tr > td > .downfile-list > li > a","returnValue":"=text","returnArray":true}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-1760,580],"id":"64dd325c-3a63-463f-b308-f536069fc1e4","name":"extract img list1","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987498f6-b083-4f58-b8a4-62f111640464","leftValue":"={{ $json.date }};\n","rightValue":"={{ $today.minus(1, 'years') }}","operator":{"type":"dateTime","operation":"afterOrEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1260,580],"id":"5b8e92a6-0199-4287-beea-caac7dcd2f48","name":"is it today?1"},{"parameters":{"url":"={{ $json.img }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition"}]},"options":{"response":{"response":{"fullResponse":true,"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-20,540],"id":"543599f5-643d-479f-86cc-59529aa7f9c5","name":"get img2","alwaysOutputData":true},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"ff86e342-798b-478e-9bc1-199abbc41475","name":"Upload a img1","type":"n8n-nodes-base.httpRequest","position":[180,600],"typeVersion":4.2,"alwaysOutputData":true},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","options":{"allowUnauthorizedCerts":false}},"id":"e439bed4-8e4a-4cd3-9e5a-a103b31df4c7","name":"Retrieve img1","type":"n8n-nodes-base.httpRequest","position":[320,600],"typeVersion":4.2},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"options":{"allowUnauthorizedCerts":false}},"id":"9af71a75-f7d6-4e16-a7e8-079f8aebe8f1","name":"Retrieve img3","type":"n8n-nodes-base.httpRequest","position":[480,600],"typeVersion":4.2},{"parameters":{"url":"={{ $('변수설정1').item.json.base_url  +  $json.img }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition"}]},"options":{"response":{"response":{"fullResponse":true,"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-20,680],"id":"2810d44b-267f-41d2-b209-1c1101f49ad1","name":"get img3","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8b678027-4ef0-48a2-be86-69f6234163bc","leftValue":"={{ $json.list }}","rightValue":"http","operator":{"type":"string","operation":"startsWith"}},{"id":"b89a7288-14b1-482f-83ac-6239ea5c0139","leftValue":"={{ $json.list }}","rightValue":"https","operator":{"type":"string","operation":"startsWith"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-340,600],"id":"25f839cb-c72c-4fe9-b050-d0431f8ddec3","name":"url starts with http or https1"},{"parameters":{},"id":"57f72c9f-9161-48a3-94c7-031be982bc6c","name":"NoOp1","type":"n8n-nodes-base.noOp","position":[800,600],"typeVersion":1},{"parameters":{"options":{"reset":"={{ $node[\"Loop Over Items2\"].context[\"done\"] }}"}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-2160,560],"id":"62c4f564-6874-4969-96c0-eecae9480ed9","name":"Loop Over Items2"},{"parameters":{"batchSize":"={{ $json.img.length }}","options":{"reset":"={{ $node[\"Loop Over Items3\"].context[\"done\"] }}"}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-560,580],"id":"f0eaa305-11e7-40a9-b04e-f9760c02425e","name":"Loop Over Items3"},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"append","field":"pages[0].markdown"}]},"options":{"outputFormat":"singleItem"}},"type":"n8n-nodes-base.summarize","typeVersion":1.1,"position":[-360,60],"id":"bd6454b5-249a-4a9c-96be-2c56320f6be2","name":"Summarize"},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"base_url\": \"http://www.technopark.kr\",\n  \"board_list\": \"/index.php?mid=businessboard&page=1\",\n  \"api_key\":\"gqWjltgMgARE3CsbEOXptHkJeXetB4gO\",\n  \"attach_url\": \"http://www.technopark.kr/common/attachfile/attachfileDownload.do?attachNo=\"\n}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3140,580],"id":"dbbb6d4b-72ea-485c-9d8f-82760fef0951","name":"변수설정1"},{"parameters":{"assignments":{"assignments":[{"id":"db86008e-ffea-4dd3-b12c-eb9d5087ad7c","name":"pblanc_nm","value":"={{ $json.title }}","type":"string"},{"id":"c315a533-97f3-40d7-8f3e-b3bae337323c","name":"date","value":"={{ $json.date }}","type":"string"},{"id":"b04c634c-8aaf-4b8f-877f-72995e5cadcc","name":"imgs","value":"={{ $json.img }}","type":"array"},{"id":"cc2fb364-0250-4408-93b5-6e968598ce33","name":"print_flpth_nm","value":"={{ $json.print_flpth_nm }}","type":"string"},{"id":"96d4784c-3dc9-4b59-bb59-82b4bd91bf7d","name":"print_file_nm","value":"={{ $json.print_file_nm }}","type":"string"},{"id":"cd9f6a54-57a5-48e4-ae30-04ecf25ed0a3","name":"flpth_nm","value":"={{ $json.flpth_nm }}","type":"string"},{"id":"c27766b0-0055-43f5-9fbd-c8d14b5b9560","name":"file_nm","value":"={{ $json.file_nm }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1440,580],"id":"623e154e-5cb4-46a6-a16e-c28349bb84a3","name":"Edit Fields2","onError":"continueRegularOutput"},{"parameters":{"jsCode":"\n\nconst flpth_nm_list = $input.first().json.download.map((item) =>{\n  const a = item.match(/'(\\d{8})'/);\n  if(a == null) return \"\";\n  return $('변수설정1').first().json.attach_url  + a[1]\n});\n\nconst file_nm_list = $input.first().json[\"download-file-name\"];\n\nconst print_flpth_nm = flpth_nm_list[0];\nconst flpth_nm = flpth_nm_list.join(\"@\");\n\nconst print_file_nm = file_nm_list[0];\nconst file_nm = file_nm_list.join(\"@\");\n\n\n\nreturn {title: $input.first().json.title,\n        date: $input.first().json.date,\n        img: $input.first().json.img.concat($input.first().json.img2),\n        print_flpth_nm: print_flpth_nm,\n        print_file_nm: print_file_nm,\n        flpth_nm: flpth_nm,\n        file_nm: file_nm\n       }"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1580,580],"id":"94fd3e6c-3ef9-420f-9e3d-07b6e5661af4","name":"Code2"},{"parameters":{"promptType":"define","text":"={{ $json.appended_pages0_markdown }} \\n에서 pblanc_nm(공고제목), jrsd_instt_nm(지역 혹은 사이트이름), bsns_sumry_cn(공고요약), bsns_sumry_cn(대상기업), reqst_begin_end_de(공고 전체기간 형식은 \"YYYY-MM-DD ~ YYYY-MM-DD\"), reqst_begin_dt(공고시작기간 YYYY-MM-DD), reqst_end_dt(공고마감기간 YYYY-MM-DD), reqst_mth_papers_cn(사업신청방법), refrnc_nm(문의처)에 대한 정보를 알려줘 만약 자료가 없다면 null으로라도 알려줘","hasOutputParser":true,"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-140,60],"id":"6b8a30f9-6f17-4957-91b6-1abce15ca943","name":"Basic LLM Chain1"},{"parameters":{"modelName":"models/gemini-1.5-flash-8b-latest","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-120,320],"id":"c5aaeb73-2fc2-485d-8bcd-01f7445350dd","name":"Google Gemini Chat Model2","credentials":{"googlePalmApi":{"id":"1n1ZCgSpI165zI9c","name":"Google Gemini(PaLM) Api account 3"}}},{"parameters":{"schemaType":"manual","inputSchema":"{\n    \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n    \"$id\": \"https://example.com/product.schema.json\",\n    \"title\": \"anouncement\",\n\t\"type\": \"object\",\n\t\"properties\": {\n      \"pblanc_nm\": {\n        \"type\": \"string\",\n        \"description\": \"공고제목\"\n      },\n      \"jrsd_instt_nm\": {\n        \"type\": \"string\",\n        \"description\": \"공고지역\"\n      },\n      \"bsns_sumry_cn\": {\n        \"type\": \"string\",\n        \"description\": \"공고요약\"\n      },\n      \"trget_nm\": {\n        \"type\": \"string\",\n        \"description\": \"대상기업\"\n      },\n      \"reqst_begin_end_de\": {\n        \"type\": \"string\",\n        \"description\": \"공고 전체 기간\"\n      },\n      \"reqst_begin_dt\": {\n        \"type\": \"string\",\n        \"description\": \"공고 시작 기간\"\n      },\n      \"reqst_end_dt\": {\n        \"type\": \"string\",\n        \"description\": \"공고 종료 기간\"\n      },\n      \"reqst_mth_papers_cn\": {\n        \"type\": \"string\",\n        \"description\": \"사업신청 방법\"\n      },\n      \"refrnc_nm\": {\n        \"type\": \"string\",\n        \"description\": \"문의처내용\"\n      }\n\t},\n  \"required\": [\"pblanc_nm\"]\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[80,300],"id":"fb2195a6-8feb-4c37-a651-3b2ed9b24ddf","name":"Structured Output Parser2","notesInFlow":false},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-3100,1860],"id":"d38f2c3e-60ed-4175-9352-683ed0e0eb6f","name":"When clicking ‘Execute workflow’"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-280,360],"id":"73d826d5-eb17-47b6-9bdf-9eb37b1da760","name":"Google Gemini Chat Model6","credentials":{"googlePalmApi":{"id":"1n1ZCgSpI165zI9c","name":"Google Gemini(PaLM) Api account 3"}}},{"parameters":{"batchSize":1,"options":{"reset":false}},"id":"48269d43-3166-48de-b003-2f2931bf92ce","name":"SplitInBatches12","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-2020,1860]},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'http://www.technopark.kr' + $json.href }}"}]},"options":{}},"id":"3490897b-2faf-4366-8197-6c10166c54a6","name":"Set Full URL6","type":"n8n-nodes-base.set","typeVersion":1,"position":[-1820,1860]},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"id":"bd22d837-4dcc-4543-a489-c3c0600dfb3f","name":"Get Detail HTML6","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-1600,1860]},{"parameters":{"extractionValues":{"values":[{"key":"pblanc_nm","cssSelector":"head > title"},{"key":"flpth_nm","cssSelector":".board_add_file ul li a","returnValue":"attribute","attribute":"href","returnArray":true},{"key":"file_nm","cssSelector":".board_add_file ul li a","returnArray":true},{"key":"base64Img","cssSelector":"img[src^=\"data:image\"] ","returnValue":"attribute","attribute":"src"}]},"options":{"trimValues":true}},"id":"b4da231e-5221-4b13-be73-f2ea29e7b83f","name":"Extract Content6","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-1380,1860]},{"parameters":{"jsCode":"// return $json.href.map(link => {\n//   return {\n//     json: {\n//       href: link\n//     }\n//   };\n// });\nconst links = $json.href || [];\nreturn links.map(link => ({ json: { href: link } }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2400,1860],"id":"fed975b1-54ad-4f03-bee1-94c2aa387a3a","name":"split4"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"63c73959-d2e6-454d-8f70-bf04bffeabe5","name":"Upload a file7","type":"n8n-nodes-base.httpRequest","position":[-560,920],"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-300,900],"id":"dae1457b-83e7-4d32-b2a0-da3e323c5e53","name":"HTTP Request16"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"29b5deb3-e88a-40fb-8eb6-6dad5cf9fce6","name":"do ocr7","type":"n8n-nodes-base.httpRequest","position":[-80,900],"typeVersion":4.2},{"parameters":{"url":"={{ $json.downloadUrl }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"},{"name":"Referer","value":"http://www.technopark.kr"},{"name":"Accept","value":"*/*"}]},"options":{"response":{"response":{"responseFormat":"file"}},"timeout":60000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1080,940],"id":"e31ff8e2-ea9a-4ee0-99eb-66eae9da28be","name":"download files5","executeOnce":false},{"parameters":{"jsCode":"// const ocrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\n\n// return {\n//   json: {\n//     chatInput: `다음은 공고의 첨부파일에서 OCR로 추출한 텍스트입니다. 이 텍스트를 읽고 다음 정보를 요약해 주세요.\n//   반환형식을 꼭 지켜!\n\n// 다음은 정부지원사업 공고의 OCR 텍스트입니다.  \n// 이 텍스트를 기반으로 아래 JSON 구조에 맞게 항목을 채워 주세요.\n\n// 각 key는 반드시 그대로 유지하고, 값이 없을 경우 null 또는 기본값을 사용해 주세요.  \n// (주석은 설명 용도로만 표시한 것입니다. 응답에서는 제거하고 순수 JSON으로 반환해주세요.)\n\n// json\n// {\n//   \"biz_info_id\": null,                            // (자동 생성. 입력하지 않아도 됨)\n//   \"pblanc_nm\": null,                              // 공고 제목\n//   \"pblanc_url\": null,                             // 공고 상세 URL\n//   \"pblanc_id\": null,                              // 공고 ID\n//   \"jrsd_instt_nm\": null,                          // 주관/지원 기관명 (예: 전북특별자치도)\n//   \"exc_instt_nm\": null,                           // 수행기관 (예: 직접수행, 외부수행 등)\n//   \"bsns_sumry_cn\": null,                          // 공고 요약 (HTML 혹은 일반 텍스트)\n//   \"print_flpth_nm\": null,                         // 메인 PDF 링크\n//   \"print_file_nm\": null,                          // 메인 PDF 파일명\n//   \"flpth_nm\": null,                               // 첨부파일 경로들 (@ 구분)\n//   \"file_nm\": null,                                // 첨부파일명 (zip 등)\n\n//   \"pldir_sport_realm_lclas_code_nm\": null,        // 대분류 분야명 (예: 기술, 경영 등)\n//   \"rcept_engn_hmpg_url\": null,                    // 신청처 홈페이지\n//   \"trget_nm\": null,                               // 대상기업 (예: 중소기업, 중견기업 등)\n\n//   \"reqst_begin_end_de\": null,                     // 공고 전체 기간 (예: 20240801 ~ 20240930)\n//   \"reqst_begin_dt\": null,                         // 시작일 (예: 2024-08-01)\n//   \"reqst_end_dt\": null,                           // 마감일 (예: 2024-09-30)\n//   \"reqst_mth_papers_cn\": null,                    // 신청 방법 (예: 온라인 접수 등)\n//   \"pldir_sport_realm_mlsfc_code_nm\": null,        // 중분류 분야명\n//   \"refrnc_nm\": null,                              // 문의처 (예: 전화번호 포함 문장)\n//   \"inqire_co\": 0,                                 // 문의 수 (없으면 0)\n\n//   \"creat_p_nttm\": null,                           // 공고 등록 일시\n//   \"created_ts\": null,                             // 시스템에 등록된 시간\n//   \"hash_tags\": null,                              // 키워드 (쉼표 구분)\n//   \"del_yn\": \"N\",                                   // 삭제 여부 (기본값 N)\n//   \"hide_yn\": \"Y\",                                  // 숨김 여부 (기본값 Y)\n//   \"views\": 0,                                     // 조회수 (기본값 0)\n\n//   \"is_classified\": \"N\",                           // 분류 여부 (N: 미분류)\n//   \"source\": \"한국산업단지공단\",                            // 출처 (예: 한국산업단지공단)\n//   \"main_category\": null,\n//   \"sub_category\": null,\n//   \"classified_date\": null,\n//   \"classified_by\": null,\n\n//   \"subsidy_amount\": null,                         // 정부 지원금 (예: \"140억 원\")\n//   \"self_contribution_rate\": null,                 // 자부담 비율 (예: \"40% 이상\")\n//   \"support_target\": null,                         // 지원 대상 설명\n//   \"bonus_points_factors\": null,                   // 가점 요소\n//   \"total_budget\": null,                           // 총사업비 (예: \"200억 원\")\n//   \"applicant_count\": 0,                           // 모집/선정 수 (없으면 0)\n//   \"subsidy_amount_type\": null,                    // 지원금 단위 (예: 연차별, 총액)\n//   \"total_budget_type\": null,                      // 총사업비 단위\n//   \"equipment_detail_file_path\": null,             // 장비 세부파일 경로\n//   \"equipment_detail_file_name\": null              // 장비 세부파일 이름\n// }\n\n\n// [텍스트 시작]\n// ${ocrText}\n// [텍스트 끝]`\n//   }\n// };\n\n\n\nconst fullOcrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\nconst truncatedOcrText = fullOcrText.slice(0, 3000); // 앞 3000자만 추출\n\nreturn {\n  json: {\n    chatInput: `다음은 공고의 첨부파일에서 OCR로 추출한 텍스트입니다. 이 텍스트를 읽고 다음 정보를 요약해 주세요.\n  반환형식을 꼭 지켜!\n\n다음은 정부지원사업 공고의 OCR 텍스트입니다.  \n이 텍스트를 기반으로 아래 JSON 구조에 맞게 항목을 채워 주세요.\n\n각 key는 반드시 그대로 유지하고, 값이 없을 경우 null 또는 기본값을 사용해 주세요.  \n(주석은 설명 용도로만 표시한 것입니다. 응답에서는 제거하고 순수 JSON으로 반환해주세요.)\n\njson\n{\n  \"biz_info_id\": null,\n  \"pblanc_nm\": null,\n  \"pblanc_url\": null,\n  \"pblanc_id\": null,\n  \"jrsd_instt_nm\": null,\n  \"exc_instt_nm\": null,\n  \"bsns_sumry_cn\": null,\n  \"print_flpth_nm\": null,\n  \"print_file_nm\": null,\n  \"flpth_nm\": null,\n  \"file_nm\": null,\n  \"pldir_sport_realm_lclas_code_nm\": null,\n  \"rcept_engn_hmpg_url\": null,\n  \"trget_nm\": null,\n  \"reqst_begin_end_de\": null,\n  \"reqst_begin_dt\": null,\n  \"reqst_end_dt\": null,\n  \"reqst_mth_papers_cn\": null,\n  \"pldir_sport_realm_mlsfc_code_nm\": null,\n  \"refrnc_nm\": null,\n  \"inqire_co\": 0,\n  \"creat_p_nttm\": null,\n  \"created_ts\": null,\n  \"hash_tags\": null,\n  \"del_yn\": \"N\",\n  \"hide_yn\": \"Y\",\n  \"views\": 0,\n  \"is_classified\": \"N\",\n  \"source\": \"기업마당\",\n  \"main_category\": null,\n  \"sub_category\": null,\n  \"classified_date\": null,\n  \"classified_by\": null,\n  \"subsidy_amount\": null,\n  \"self_contribution_rate\": null,\n  \"support_target\": null(이건 100자 이하로), \n  \"bonus_points_factors\": null,\n  \"total_budget\": null,\n  \"applicant_count\": 0,\n  \"subsidy_amount_type\": null,\n  \"total_budget_type\": null,\n  \"equipment_detail_file_path\": null,\n  \"equipment_detail_file_name\": null\n}\n\n[텍스트 시작]\n${truncatedOcrText}\n[텍스트 끝]`\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[100,900],"id":"bdd10f2e-b438-4dd3-b7dc-a98e72975b69","name":"Code21"},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[260,900],"id":"306ace87-4368-4b87-9cd9-64caf48eb97a","name":"Basic LLM Chain5"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[980,2000],"id":"b961f2a7-9705-4b16-9eb9-5b4e105da56d","name":"MySQL7","credentials":{"mySql":{"id":"s7XNBHZtTOH7C66M","name":"MySQL account 2"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1400,2060],"id":"b8e328b0-b8ae-4bcf-bb66-56aa879d8f16","name":"No Operation, do nothing1"},{"parameters":{"method":"POST","url":"http://43.200.39.170:8000/convert","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-720,1080],"id":"534f6199-8086-42e4-bb88-b74f4d2ce975","name":"hwp ocr"},{"parameters":{"jsCode":"// // Gemini 또는 LLM 응답의 텍스트 내용만 추출\n// const geminiText = $json.text; // or $item(0).json.text\n\n// // Markdown 코드 블록에서 JSON 추출: ```json\\n{...}\\n```\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(jsonMatch[1]);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // 후처리 + 경로 가공\n// return {\n//   json: {\n//     ...$json,\n//     ...parsed,\n\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//   }\n// };\n\n\n\n\n\n//2번째 거\n// const geminiText = $json.text;\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(jsonMatch[1]);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // ✅ text 필드 제외 후 병합\n// const {\n//   text, // eslint-disable-line no-unused-vars\n//   ...rest\n// } = $json;\n\n// return {\n//   json: {\n//     ...rest,\n//     ...parsed,\n\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     source: \"한국산업단지공단\"\n//   }\n// };\n\n\n\n//3번째 거\n// const geminiText = $json.text;\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(jsonMatch[1]);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // text 제외\n// const { text, ...rest } = $json;\n\n// // 병합 키 유지\n// const mergeKey = $json.fileIndex || $json.mergeKey || 0;\n\n// return {\n//   json: {\n//     ...rest,\n//     ...parsed,\n//     mergeKey,  // 👈 병합 키 추가\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     source: \"한국산업단지공단\"\n//   }\n// };\n\n\n\n\n\n//4번째 거\n// const geminiText = $json.text;\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// // 전처리: inqire_co가 숫자형 전화번호면 문자열로 감싸기\n// let rawJson = jsonMatch[1]\n//   .replace(/\"inqire_co\"\\s*:\\s*([0-9\\-]+)\\s*,/g, '\"inqire_co\": \"$1\",');\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(rawJson);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // text 제외\n// const { text, ...rest } = $json;\n\n// // 병합 키 유지\n// const mergeKey = $json.fileIndex || $json.mergeKey || 0;\n\n// return {\n//   json: {\n//     ...rest,\n//     ...parsed,\n//     mergeKey,\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     source: \"한국산업단지공단\"\n//   }\n// };\n\n\n\n//5번째 거\nfunction convertDate(dateStr) {\n  if (!dateStr || typeof dateStr !== 'string') return null;\n  const match = dateStr.match(/(\\d{4})\\.\\s*(\\d{1,2})\\.\\s*(\\d{1,2})/);\n  if (!match) return null;\n  const [ , year, month, day ] = match;\n  return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\n}\n\nconst geminiText = $json.text;\nconst jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif (!jsonMatch) {\n  throw new Error(\"JSON block not found in Gemini output.\");\n}\n\n// 전화번호 문자 처리\nlet rawJson = jsonMatch[1]\n  .replace(/\"inqire_co\"\\s*:\\s*([0-9\\-]+)\\s*,/g, '\"inqire_co\": \"$1\",');\n\nlet parsed;\ntry {\n  parsed = JSON.parse(rawJson);\n} catch (err) {\n  throw new Error(\"Failed to parse JSON: \" + err.message);\n}\n\nconst { text, ...rest } = $json;\nconst mergeKey = $json.fileIndex || $json.mergeKey || 0;\n\nreturn {\n  json: {\n    ...rest,\n    ...parsed,\n    mergeKey,\n\n    // ✅ flpth_nm 변환\n    flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    print_flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    // ✅ 날짜 변환\n    reqst_begin_dt: convertDate(parsed.reqst_begin_dt),\n    reqst_end_dt: convertDate(parsed.reqst_end_dt),\n\n    exc_instt_nm: parsed.exc_instt_nm,\n    del_yn: \"N\",\n    creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    source: \"한국산업단지공단\"\n  }\n};\n            "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[580,900],"id":"16b2cb92-24b9-4067-b979-27c90f445a2a","name":"ocr res"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1c0e8621-50ab-46ff-bda6-ed3fad0fbb97","leftValue":"={{$binary.data.fileExtension}}","rightValue":"pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-880,940],"id":"1d8e6c6e-4bfc-4fd9-949d-698a05d59128","name":"If"},{"parameters":{"url":"http://www.technopark.kr/index.php?mid=businessboard&page=1","responseFormat":"string","options":{}},"id":"bad0fda4-295a-4f78-b788-ea810f8bf6b7","name":"리스트요청","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-2880,1860]},{"parameters":{"extractionValues":{"values":[{"key":"href","cssSelector":"table > tbody > tr > td > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"0e1a43ec-86b0-4f40-aad6-83ecf98ea01a","name":"게시글요청","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-2660,1860]},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[280,1120],"id":"51013a3d-07ae-44ba-9e12-e8f23ca8e9d3","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"1n1ZCgSpI165zI9c","name":"Google Gemini(PaLM) Api account 3"}}},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"=data","extractionValues":{"values":[{"key":"img","cssSelector":".xe_content img","returnValue":"attribute","attribute":"src","returnArray":true},{"key":"img2","cssSelector":".table-cont > p > img","returnValue":"attribute","attribute":"src","returnArray":true},{"key":"title","cssSelector":".board-write > tbody > tr:nth-child(1) > td"},{"key":"download","cssSelector":".board-write > tbody > tr > td > .downfile-list > li > a","returnValue":"attribute","attribute":"onclick","returnArray":true},{"key":"author","cssSelector":".board-write > tbody > tr:nth-child(2) > td"},{"key":"date","cssSelector":".board-write > tbody > tr:nth-child(3) > td"},{"key":"download-file-name","cssSelector":".board-write > tbody > tr > td > .downfile-list > li > a","returnValue":"=text","returnArray":true}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-1580,2840],"id":"373a81b9-0585-4996-b1bc-2364ae76b3de","name":"extract img list","onError":"continueRegularOutput"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"eb2be677-865e-422e-a99d-7a7aeae3cd41","name":"do ocr","type":"n8n-nodes-base.httpRequest","position":[-480,1860],"typeVersion":4.2},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"cedb766f-3efd-478a-92a9-df8abc54fb21","name":"Upload a file","type":"n8n-nodes-base.httpRequest","position":[-940,1860],"typeVersion":4.2},{"parameters":{"jsCode":"const base64Str = $json.base64Img;\nconst matches = base64Str.match(/^data:(.+);base64,(.+)$/);\n\nif (!matches) {\n  throw new Error(\"Invalid base64 format\");\n}\n\nconst mimeType = matches[1];\nconst base64Data = matches[2];\n\nreturn [\n  {\n    binary: {\n      data: {\n        data: base64Data,\n        mimeType,\n        fileName: \"image.png\"\n      }\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1160,1860],"id":"4164177c-33ca-446d-ae05-3597b16a68d3","name":"img->바이너리"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-720,1860],"id":"9465f470-0cdc-4c74-a9d7-d30332747682","name":"파일 ID로 Mistral 이미지 URL 얻기"},{"parameters":{"jsCode":"const fullOcrText = $json.pages?.[0]?.markdown || JSON.stringify($json, null, 2);\nconst truncatedOcrText = fullOcrText.slice(0, 3000);\n\nreturn {\n  json: {\n    chatInput: `다음은 정부지원사업 공고의 OCR 텍스트입니다.  \n이 텍스트를 기반으로 아래 JSON 구조에 맞게 항목을 채워 주세요.\n\n**주의사항**  \n- 키 이름은 절대 변경하지 마세요.  \n- 값이 없으면 null로 설정하세요.  \n- 각 키는 다음과 같은 의미입니다. (AI 이해용 주석, 응답에는 포함하지 마세요)\n\n{\n  \"pblanc_nm\": null, // 공고 제목\n  \"pblanc_url\": null, // 공고 상세 URL\n  \"pblanc_id\": null, // 공고 고유 ID\n  \"jrsd_instt_nm\": null, // 주관 기관명\n  \"exc_instt_nm\": null, // 수행 기관명\n  \"bsns_sumry_cn\": null, // 사업 요약 (3줄 이내 요약문)\n  \"print_flpth_nm\": null, // 출력용 전체 경로 (없으면 null)\n  \"print_file_nm\": null, // 출력 파일명 (없으면 null)\n  \"flpth_nm\": null, // 원본 파일 경로\n  \"file_nm\": null, // 원본 파일 이름\n  \"pldir_sport_realm_lclas_code_nm\": null, // 대분류 (예: 창업지원)\n  \"rcept_engn_hmpg_url\": null, // 접수 홈페이지 URL\n  \"trget_nm\": null, // 신청 대상 예: 중소기업, 스타트업\n  \"reqst_begin_end_de\": null, // 접수기간 전체 문자열 (예: 2025.07.01 ~ 2025.07.15)\n  \"reqst_begin_dt\": null, // 접수 시작일 (예: 2025-07-01)\n  \"reqst_end_dt\": null, // 접수 마감일 (예: 2025-07-15)\n  \"reqst_mth_papers_cn\": null, // 신청 방법 (예: 방문접수, 이메일 등)\n  \"pldir_sport_realm_mlsfc_code_nm\": null, // 중분류\n  \"refrnc_nm\": null, // 관련 문서 이름 또는 참고\n  \"inqire_co\": 0, // 문의 횟수 (없으면 0)\n  \"creat_p_nttm\": null, // 등록일시 (예: 2025-06-18T10:20:00)\n  \"created_ts\": null, // 시스템 등록 timestamp\n  \"hash_tags\": null, // 태그 예: \"#창업 #AI\"\n  \"del_yn\": \"N\", // 삭제 여부 (기본 N)\n  \"hide_yn\": \"Y\", // 숨김 여부 (기본 Y)\n  \"views\": 0, // 조회수 (기본 0)\n  \"is_classified\": \"N\", // 분류 여부\n  \"source\": \"기업마당\", // 수집 출처\n  \"main_category\": null, // 주요 카테고리\n  \"sub_category\": null, // 서브 카테고리\n  \"classified_date\": null, // 분류 일자\n  \"classified_by\": null, // 분류 담당자\n  \"subsidy_amount\": null, // 보조금 금액 (숫자)\n  \"self_contribution_rate\": null, // 자부담 비율 (예: 20%)\n  \"support_target\": null, // 지원 대상 (100자 이내)\n  \"bonus_points_factors\": null, // 가점 요인\n  \"total_budget\": null, // 총 예산\n  \"applicant_count\": 0, // 신청자 수 (기본 0)\n  \"subsidy_amount_type\": null, // 정액/정률 등\n  \"total_budget_type\": null, // 국비/지방비/민자 등\n  \"equipment_detail_file_path\": null,\n  \"equipment_detail_file_name\": null\n}\n\n[텍스트 시작]\n${truncatedOcrText}\n[텍스트 끝]`\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-260,1860],"id":"569db670-b1c1-4a4a-9942-3c74578f3cb7","name":"Code22"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-20,2100],"id":"6bbb5480-b0b0-4ad3-91aa-0a27a4da36e1","name":"Google Gemini Chat Model7","credentials":{"googlePalmApi":{"id":"1n1ZCgSpI165zI9c","name":"Google Gemini(PaLM) Api account 3"}}},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-80,1880],"id":"6e7c7b05-ffc0-48af-986f-39f0b389f3f5","name":"Basic LLM Chain"},{"parameters":{"jsCode":"\n//5번째 거\nfunction convertDate(dateStr) {\n  if (!dateStr || typeof dateStr !== 'string') return null;\n  const match = dateStr.match(/(\\d{4})\\.\\s*(\\d{1,2})\\.\\s*(\\d{1,2})/);\n  if (!match) return null;\n  const [ , year, month, day ] = match;\n  return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\n}\n\nconst geminiText = $json.text;\nconst jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif (!jsonMatch) {\n  throw new Error(\"JSON block not found in Gemini output.\");\n}\n\n// 전화번호 문자 처리\nlet rawJson = jsonMatch[1]\n  .replace(/\"inqire_co\"\\s*:\\s*([0-9\\-]+)\\s*,/g, '\"inqire_co\": \"$1\",');\n\nlet parsed;\ntry {\n  parsed = JSON.parse(rawJson);\n} catch (err) {\n  throw new Error(\"Failed to parse JSON: \" + err.message);\n}\n\nconst { text, ...rest } = $json;\nconst mergeKey = $json.fileIndex || $json.mergeKey || 0;\n\nreturn {\n  json: {\n    ...rest,\n    ...parsed,\n\n    mergeKey: $json.mergeKey || $itemIndex,\n\n    // ✅ flpth_nm 변환\n    flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? parsed.flpth_nm.map(path => \"www.technopark.k\" + path).join(\"@\")\n      : parsed.flpth_nm ? \"www.technopark.k\" + parsed.flpth_nm : null,\n\n    print_flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? \"www.technopark.k\" + parsed.flpth_nm[0]\n      : parsed.flpth_nm ? \"www.technopark.k\" + parsed.flpth_nm : null,\n\n    // ✅ 날짜 변환\n    reqst_begin_dt: convertDate(parsed.reqst_begin_dt),\n    reqst_end_dt: convertDate(parsed.reqst_end_dt),\n\n    exc_instt_nm: parsed.exc_instt_nm,\n    del_yn: \"N\",\n    creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    source: \"한국테크노파크\"\n  }\n};\n            "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[280,1880],"id":"3f5906c7-1abc-4c73-93ba-b027dc8a6840","name":"ocr res1"},{"parameters":{"mode":"combine","fieldsToMatchString":"mergeKey","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[460,2380],"id":"8086ce9c-17c9-439e-aa6c-029c8dd8d8a3","name":"Merge"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"return {\n  json: {\n    ...$json,\n    mergeKey: $json.mergeKey || $itemIndex,\n    biz_info_id: $json.biz_info_id || $itemIndex\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1480,2300],"id":"b3259813-afc6-406a-8b9f-b6ffe64f52b2","name":"병합키 추가"},{"parameters":{"jsCode":"const { data, mergeKey,biz_info_id, base64Img, ...rest } = $json;\n\n// ✅ flpth_nm 변환\nif (Array.isArray(rest.flpth_nm)) {\n  rest.print_flpth_nm = \"http://www.technopark.kr/\" + rest.flpth_nm[0];\n  rest.flpth_nm = rest.flpth_nm.map(path => \"http://www.technopark.kr/\" + path).join(\"@\");\n} else if (typeof rest.flpth_nm === \"string\") {\n  rest.print_flpth_nm = \"http://www.technopark.kr/\" + rest.flpth_nm;\n  rest.flpth_nm = \"http://www.technopark.kr/\" + rest.flpth_nm;\n} else {\n  rest.print_flpth_nm = null;\n  rest.flpth_nm = null;\n}\n\n// ✅ file_nm: 배열이면 문자열로 결합 (@ 구분)\nif (Array.isArray(rest.file_nm)) {\n  rest.file_nm = rest.file_nm.join(\"@\");\n}\n\n// ✅ print_file_nm 설정 (첫 번째 파일 이름)\nrest.print_file_nm = rest.file_nm?.split(\"@\")[0] || null;\n\n// ✅ 주요 필드 이스케이프 처리\nfunction escapeSQL(value) {\n  return typeof value === 'string' ? value.replace(/'/g, \"''\") : value;\n}\nconst fieldsToEscape = [\n  \"pblanc_nm\", \"bsns_sumry_cn\", \"support_target\",\n  \"bonus_points_factors\", \"subsidy_amount_type\",\n  \"total_budget_type\", \"print_file_nm\", \"file_nm\"\n];\nfor (const field of fieldsToEscape) {\n  if (rest[field] !== undefined) {\n    rest[field] = escapeSQL(rest[field]);\n  }\n}\n\nreturn { json: rest };\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[680,2380],"id":"a5079591-be86-439e-8b6f-e3735b4ee397","name":"Code"}],"connections":{"ai result":{"main":[[{"node":"MySQL","type":"main","index":0}]]},"MySQL":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"prepare image addr":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"do ocr1":{"main":[[{"node":"NoOp1","type":"main","index":0}]]},"board list1":{"main":[[{"node":"html extract board detail list1","type":"main","index":0}]]},"html extract board detail list1":{"main":[[{"node":"Prepare announcement1","type":"main","index":0}]]},"Prepare announcement1":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"get detail1":{"main":[[{"node":"extract img list1","type":"main","index":0}]]},"extract img list1":{"main":[[{"node":"Code2","type":"main","index":0}]]},"is it today?1":{"main":[[{"node":"prepare image addr","type":"main","index":0}]]},"get img2":{"main":[[{"node":"Upload a img1","type":"main","index":0}]]},"Upload a img1":{"main":[[{"node":"Retrieve img1","type":"main","index":0}]]},"Retrieve img1":{"main":[[{"node":"Retrieve img3","type":"main","index":0}]]},"Retrieve img3":{"main":[[{"node":"do ocr1","type":"main","index":0}]]},"get img3":{"main":[[{"node":"Upload a img1","type":"main","index":0}]]},"url starts with http or https1":{"main":[[{"node":"get img2","type":"main","index":0}],[{"node":"get img3","type":"main","index":0}]]},"NoOp1":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Loop Over Items2":{"main":[[],[{"node":"get detail1","type":"main","index":0}]]},"Loop Over Items3":{"main":[[{"node":"Summarize","type":"main","index":0}],[{"node":"url starts with http or https1","type":"main","index":0}]]},"Summarize":{"main":[[{"node":"Basic LLM Chain1","type":"main","index":0}]]},"변수설정1":{"main":[[{"node":"board list1","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"is it today?1","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Basic LLM Chain1":{"main":[[{"node":"ai result","type":"main","index":0}]]},"Google Gemini Chat Model2":{"ai_languageModel":[[]]},"Structured Output Parser2":{"ai_outputParser":[[{"node":"Basic LLM Chain1","type":"ai_outputParser","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"리스트요청","type":"main","index":0}]]},"Google Gemini Chat Model6":{"ai_languageModel":[[]]},"SplitInBatches12":{"main":[[{"node":"Set Full URL6","type":"main","index":0}]]},"Set Full URL6":{"main":[[{"node":"Get Detail HTML6","type":"main","index":0}]]},"Get Detail HTML6":{"main":[[{"node":"Extract Content6","type":"main","index":0}]]},"Extract Content6":{"main":[[{"node":"img->바이너리","type":"main","index":0},{"node":"병합키 추가","type":"main","index":0}]]},"split4":{"main":[[{"node":"SplitInBatches12","type":"main","index":0}]]},"Upload a file7":{"main":[[{"node":"HTTP Request16","type":"main","index":0}]]},"HTTP Request16":{"main":[[{"node":"do ocr7","type":"main","index":0}]]},"do ocr7":{"main":[[{"node":"Code21","type":"main","index":0}]]},"download files5":{"main":[[{"node":"If","type":"main","index":0}]]},"Code21":{"main":[[{"node":"Basic LLM Chain5","type":"main","index":0}]]},"Basic LLM Chain5":{"main":[[{"node":"ocr res","type":"main","index":0}]]},"MySQL7":{"main":[[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"No Operation, do nothing1":{"main":[[{"node":"SplitInBatches12","type":"main","index":0}]]},"hwp ocr":{"main":[[{"node":"Upload a file7","type":"main","index":0}]]},"ocr res":{"main":[[]]},"If":{"main":[[{"node":"Upload a file7","type":"main","index":0}],[{"node":"hwp ocr","type":"main","index":0}]]},"리스트요청":{"main":[[{"node":"게시글요청","type":"main","index":0}]]},"게시글요청":{"main":[[{"node":"split4","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain5","type":"ai_languageModel","index":0}]]},"Upload a file":{"main":[[{"node":"파일 ID로 Mistral 이미지 URL 얻기","type":"main","index":0}]]},"img->바이너리":{"main":[[{"node":"Upload a file","type":"main","index":0}]]},"파일 ID로 Mistral 이미지 URL 얻기":{"main":[[{"node":"do ocr","type":"main","index":0}]]},"do ocr":{"main":[[{"node":"Code22","type":"main","index":0}]]},"Code22":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]},"Google Gemini Chat Model7":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"ocr res1","type":"main","index":0}]]},"ocr res1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"병합키 추가":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"MySQL7","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"1f3a7bf1-66fc-4e60-8b85-c6f9d590f210","triggerCount":0,"shared":[{"createdAt":"2025-06-18T02:22:42.020Z","updatedAt":"2025-06-18T02:22:42.020Z","role":"workflow:owner","workflowId":"24WXY0WWtpF7e6fN","projectId":"FMA96HVWnRkNvN5Q"}],"tags":[]}