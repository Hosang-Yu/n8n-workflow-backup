{"createdAt":"2025-06-18T01:05:53.166Z","updatedAt":"2025-06-20T04:50:15.563Z","id":"zlKmwQLdb6KYyNXB","name":"10.í•œêµ­ì‚°ì—…ë‹¨ì§€ê³µë‹¨(ì•„ì˜)","active":false,"isArchived":true,"nodes":[{"parameters":{},"name":"execute","type":"n8n-nodes-base.manualTrigger","position":[-1700,440],"typeVersion":1,"id":"d7646943-f82d-4f72-b4dd-b5ffbcff2f09"},{"parameters":{"batchSize":1,"options":{"reset":false}},"id":"71db3983-69cb-47af-8f1c-3983bbd99dae","name":"SplitInBatches12","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-780,440]},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'https://www.kicox.or.kr' + $json.href }}"}]},"options":{}},"id":"40e98a01-db4b-4a8c-abeb-3b0aa68399f8","name":"Set Full URL6","type":"n8n-nodes-base.set","typeVersion":1,"position":[-580,440]},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"id":"37aef9cb-e20a-4b18-8701-de82a875c4ad","name":"Get Detail HTML6","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-360,440]},{"parameters":{"extractionValues":{"values":[{"key":"pblanc_nm","cssSelector":"div.detail-area div.title"},{"key":"reqst_begin_end_de","cssSelector":"div.util span.date"},{"key":"bsns_sumry_cn","cssSelector":"div.txt","returnValue":"html"},{"key":"flpth_nm","cssSelector":"span.file-download-list a\t","returnValue":"attribute","attribute":"href","returnArray":true},{"key":"file_nm","cssSelector":"span.file-download-list a","returnArray":true}]},"options":{"trimValues":true}},"id":"7572af28-bf33-4484-9d10-725d7e6644f0","name":"Extract Content6","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-140,440]},{"parameters":{"jsCode":"// return $json.href.map(link => {\n//   return {\n//     json: {\n//       href: link\n//     }\n//   };\n// });\nconst links = $json.href || [];\nreturn links.map(link => ({ json: { href: link } }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1000,440],"id":"4db3a5be-faf8-4302-a9bf-323c45d6e7d7","name":"split4"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"610497a1-c9bb-43ce-8550-7816f22e6d84","name":"Upload a file7","type":"n8n-nodes-base.httpRequest","position":[800,140],"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1060,120],"id":"d7f7b436-c758-4092-ac4a-fe134a3afa19","name":"HTTP Request16"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"d39641a9-4584-4e86-8573-7cce72ae7fef","name":"do ocr7","type":"n8n-nodes-base.httpRequest","position":[1280,120],"typeVersion":4.2},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}},"timeout":60000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[280,200],"id":"c8a629be-6cc7-4162-8e3a-1023433f5451","name":"download files5","executeOnce":false},{"parameters":{"jsCode":"// const ocrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\n\n// return {\n//   json: {\n//     chatInput: `ë‹¤ìŒì€ ê³µê³ ì˜ ì²¨ë¶€íŒŒì¼ì—ì„œ OCRë¡œ ì¶”ì¶œí•œ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì´ í…ìŠ¤íŠ¸ë¥¼ ì½ê³  ë‹¤ìŒ ì •ë³´ë¥¼ ìš”ì•½í•´ ì£¼ì„¸ìš”.\n//   ë°˜í™˜í˜•ì‹ì„ ê¼­ ì§€ì¼œ!\n\n// ë‹¤ìŒì€ ì •ë¶€ì§€ì›ì‚¬ì—… ê³µê³ ì˜ OCR í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.  \n// ì´ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•„ë˜ JSON êµ¬ì¡°ì— ë§ê²Œ í•­ëª©ì„ ì±„ì›Œ ì£¼ì„¸ìš”.\n\n// ê° keyëŠ” ë°˜ë“œì‹œ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê³ , ê°’ì´ ì—†ì„ ê²½ìš° null ë˜ëŠ” ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.  \n// (ì£¼ì„ì€ ì„¤ëª… ìš©ë„ë¡œë§Œ í‘œì‹œí•œ ê²ƒì…ë‹ˆë‹¤. ì‘ë‹µì—ì„œëŠ” ì œê±°í•˜ê³  ìˆœìˆ˜ JSONìœ¼ë¡œ ë°˜í™˜í•´ì£¼ì„¸ìš”.)\n\n// json\n// {\n//   \"biz_info_id\": null,                            // (ìë™ ìƒì„±. ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë¨)\n//   \"pblanc_nm\": null,                              // ê³µê³  ì œëª©\n//   \"pblanc_url\": null,                             // ê³µê³  ìƒì„¸ URL\n//   \"pblanc_id\": null,                              // ê³µê³  ID\n//   \"jrsd_instt_nm\": null,                          // ì£¼ê´€/ì§€ì› ê¸°ê´€ëª… (ì˜ˆ: ì „ë¶íŠ¹ë³„ìì¹˜ë„)\n//   \"exc_instt_nm\": null,                           // ìˆ˜í–‰ê¸°ê´€ (ì˜ˆ: ì§ì ‘ìˆ˜í–‰, ì™¸ë¶€ìˆ˜í–‰ ë“±)\n//   \"bsns_sumry_cn\": null,                          // ê³µê³  ìš”ì•½ (HTML í˜¹ì€ ì¼ë°˜ í…ìŠ¤íŠ¸)\n//   \"print_flpth_nm\": null,                         // ë©”ì¸ PDF ë§í¬\n//   \"print_file_nm\": null,                          // ë©”ì¸ PDF íŒŒì¼ëª…\n//   \"flpth_nm\": null,                               // ì²¨ë¶€íŒŒì¼ ê²½ë¡œë“¤ (@ êµ¬ë¶„)\n//   \"file_nm\": null,                                // ì²¨ë¶€íŒŒì¼ëª… (zip ë“±)\n\n//   \"pldir_sport_realm_lclas_code_nm\": null,        // ëŒ€ë¶„ë¥˜ ë¶„ì•¼ëª… (ì˜ˆ: ê¸°ìˆ , ê²½ì˜ ë“±)\n//   \"rcept_engn_hmpg_url\": null,                    // ì‹ ì²­ì²˜ í™ˆí˜ì´ì§€\n//   \"trget_nm\": null,                               // ëŒ€ìƒê¸°ì—… (ì˜ˆ: ì¤‘ì†Œê¸°ì—…, ì¤‘ê²¬ê¸°ì—… ë“±)\n\n//   \"reqst_begin_end_de\": null,                     // ê³µê³  ì „ì²´ ê¸°ê°„ (ì˜ˆ: 20240801 ~ 20240930)\n//   \"reqst_begin_dt\": null,                         // ì‹œì‘ì¼ (ì˜ˆ: 2024-08-01)\n//   \"reqst_end_dt\": null,                           // ë§ˆê°ì¼ (ì˜ˆ: 2024-09-30)\n//   \"reqst_mth_papers_cn\": null,                    // ì‹ ì²­ ë°©ë²• (ì˜ˆ: ì˜¨ë¼ì¸ ì ‘ìˆ˜ ë“±)\n//   \"pldir_sport_realm_mlsfc_code_nm\": null,        // ì¤‘ë¶„ë¥˜ ë¶„ì•¼ëª…\n//   \"refrnc_nm\": null,                              // ë¬¸ì˜ì²˜ (ì˜ˆ: ì „í™”ë²ˆí˜¸ í¬í•¨ ë¬¸ì¥)\n//   \"inqire_co\": 0,                                 // ë¬¸ì˜ ìˆ˜ (ì—†ìœ¼ë©´ 0)\n\n//   \"creat_p_nttm\": null,                           // ê³µê³  ë“±ë¡ ì¼ì‹œ\n//   \"created_ts\": null,                             // ì‹œìŠ¤í…œì— ë“±ë¡ëœ ì‹œê°„\n//   \"hash_tags\": null,                              // í‚¤ì›Œë“œ (ì‰¼í‘œ êµ¬ë¶„)\n//   \"del_yn\": \"N\",                                   // ì‚­ì œ ì—¬ë¶€ (ê¸°ë³¸ê°’ N)\n//   \"hide_yn\": \"Y\",                                  // ìˆ¨ê¹€ ì—¬ë¶€ (ê¸°ë³¸ê°’ Y)\n//   \"views\": 0,                                     // ì¡°íšŒìˆ˜ (ê¸°ë³¸ê°’ 0)\n\n//   \"is_classified\": \"N\",                           // ë¶„ë¥˜ ì—¬ë¶€ (N: ë¯¸ë¶„ë¥˜)\n//   \"source\": \"í•œêµ­ì‚°ì—…ë‹¨ì§€ê³µë‹¨\",                            // ì¶œì²˜ (ì˜ˆ: í•œêµ­ì‚°ì—…ë‹¨ì§€ê³µë‹¨)\n//   \"main_category\": null,\n//   \"sub_category\": null,\n//   \"classified_date\": null,\n//   \"classified_by\": null,\n\n//   \"subsidy_amount\": null,                         // ì •ë¶€ ì§€ì›ê¸ˆ (ì˜ˆ: \"140ì–µ ì›\")\n//   \"self_contribution_rate\": null,                 // ìë¶€ë‹´ ë¹„ìœ¨ (ì˜ˆ: \"40% ì´ìƒ\")\n//   \"support_target\": null,                         // ì§€ì› ëŒ€ìƒ ì„¤ëª…\n//   \"bonus_points_factors\": null,                   // ê°€ì  ìš”ì†Œ\n//   \"total_budget\": null,                           // ì´ì‚¬ì—…ë¹„ (ì˜ˆ: \"200ì–µ ì›\")\n//   \"applicant_count\": 0,                           // ëª¨ì§‘/ì„ ì • ìˆ˜ (ì—†ìœ¼ë©´ 0)\n//   \"subsidy_amount_type\": null,                    // ì§€ì›ê¸ˆ ë‹¨ìœ„ (ì˜ˆ: ì—°ì°¨ë³„, ì´ì•¡)\n//   \"total_budget_type\": null,                      // ì´ì‚¬ì—…ë¹„ ë‹¨ìœ„\n//   \"equipment_detail_file_path\": null,             // ì¥ë¹„ ì„¸ë¶€íŒŒì¼ ê²½ë¡œ\n//   \"equipment_detail_file_name\": null              // ì¥ë¹„ ì„¸ë¶€íŒŒì¼ ì´ë¦„\n// }\n\n\n// [í…ìŠ¤íŠ¸ ì‹œì‘]\n// ${ocrText}\n// [í…ìŠ¤íŠ¸ ë]`\n//   }\n// };\n\n\n\nconst fullOcrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\nconst truncatedOcrText = fullOcrText.slice(0, 3000); // ì• 3000ìë§Œ ì¶”ì¶œ\n\nreturn {\n  json: {\n    chatInput: `ë‹¤ìŒì€ ê³µê³ ì˜ ì²¨ë¶€íŒŒì¼ì—ì„œ OCRë¡œ ì¶”ì¶œí•œ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì´ í…ìŠ¤íŠ¸ë¥¼ ì½ê³  ë‹¤ìŒ ì •ë³´ë¥¼ ìš”ì•½í•´ ì£¼ì„¸ìš”.\n  ë°˜í™˜í˜•ì‹ì„ ê¼­ ì§€ì¼œ!\n\në‹¤ìŒì€ ì •ë¶€ì§€ì›ì‚¬ì—… ê³µê³ ì˜ OCR í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.  \nì´ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•„ë˜ JSON êµ¬ì¡°ì— ë§ê²Œ í•­ëª©ì„ ì±„ì›Œ ì£¼ì„¸ìš”.\n\nê° keyëŠ” ë°˜ë“œì‹œ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê³ , ê°’ì´ ì—†ì„ ê²½ìš° null ë˜ëŠ” ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.  \n(ì£¼ì„ì€ ì„¤ëª… ìš©ë„ë¡œë§Œ í‘œì‹œí•œ ê²ƒì…ë‹ˆë‹¤. ì‘ë‹µì—ì„œëŠ” ì œê±°í•˜ê³  ìˆœìˆ˜ JSONìœ¼ë¡œ ë°˜í™˜í•´ì£¼ì„¸ìš”.)\n\njson\n{\n  \"biz_info_id\": null,\n  \"pblanc_nm\": null,\n  \"pblanc_url\": null,\n  \"pblanc_id\": null,\n  \"jrsd_instt_nm\": null,\n  \"exc_instt_nm\": null,\n  \"bsns_sumry_cn\": null,\n  \"print_flpth_nm\": null,\n  \"print_file_nm\": null,\n  \"flpth_nm\": null,\n  \"file_nm\": null,\n  \"pldir_sport_realm_lclas_code_nm\": null,\n  \"rcept_engn_hmpg_url\": null,\n  \"trget_nm\": null,\n  \"reqst_begin_end_de\": null,\n  \"reqst_begin_dt\": null,\n  \"reqst_end_dt\": null,\n  \"reqst_mth_papers_cn\": null,\n  \"pldir_sport_realm_mlsfc_code_nm\": null,\n  \"refrnc_nm\": null,\n  \"inqire_co\": 0,\n  \"creat_p_nttm\": null,\n  \"created_ts\": null,\n  \"hash_tags\": null,\n  \"del_yn\": \"N\",\n  \"hide_yn\": \"Y\",\n  \"views\": 0,\n  \"is_classified\": \"N\",\n  \"source\": \"ê¸°ì—…ë§ˆë‹¹\",\n  \"main_category\": null,\n  \"sub_category\": null,\n  \"classified_date\": null,\n  \"classified_by\": null,\n  \"subsidy_amount\": null,\n  \"self_contribution_rate\": null,\n  \"support_target\": null(ì´ê±´ 100ì ì´í•˜ë¡œ), \n  \"bonus_points_factors\": null,\n  \"total_budget\": null,\n  \"applicant_count\": 0,\n  \"subsidy_amount_type\": null,\n  \"total_budget_type\": null,\n  \"equipment_detail_file_path\": null,\n  \"equipment_detail_file_name\": null\n}\n\n[í…ìŠ¤íŠ¸ ì‹œì‘]\n${truncatedOcrText}\n[í…ìŠ¤íŠ¸ ë]`\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1460,120],"id":"e1d27984-7cd5-4e1f-a8de-4003eae2088e","name":"Code21"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1640,340],"id":"da7f7809-8eb0-4431-9e35-5278d860740a","name":"Google Gemini Chat Model6","credentials":{"googlePalmApi":{"id":"1n1ZCgSpI165zI9c","name":"Google Gemini(PaLM) Api account 3"}}},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[1620,120],"id":"33445dfe-4bb1-4e59-b349-a24e6b908f9c","name":"Basic LLM Chain5"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// // Run Once for Each Item ëª¨ë“œì— ë§ì¶˜ Code\n// const urls = Array.isArray($json.flpth_nm)\n//   ? $json.flpth_nm\n//   : String($json.flpth_nm).split('@');\n\n// // ì§€ê¸ˆ ì²˜ë¦¬ ì¤‘ì¸ íŒŒì¼ ì¸ë±ìŠ¤ê°€ ìˆëŠ” ê²½ìš°ë§Œ í•˜ë‚˜ ì¶”ì¶œ\n// const index = $json.fileIndex || 0;\n// const url = urls[index];\n\n// // ì—†ìœ¼ë©´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ\n// if (!url) {\n//   return {};\n// }\n\n// // ë°˜í™˜ì€ ë‹¨ì¼ ê°ì²´ë§Œ\n// return {\n//   json: {\n//     ...$json,\n//     downloadUrl: \"https://www.kicox.or.kr\" + url.trim(),\n//     fileIndex: index\n//   }\n// };\n\n\n\n//2ë²ˆì§¸ ê±°\n// const urls = Array.isArray($json.flpth_nm)\n//   ? $json.flpth_nm\n//   : String($json.flpth_nm || \"\").split('@');\n\n// const index = $json.fileIndex || 0;\n// const url = urls[index];\n\n// if (!url) {\n//   return {};\n// }\n\n// return {\n//   json: {\n//     ...$json,\n//     downloadUrl: \"https://www.kicox.or.kr\" + url.trim(),\n//     fileIndex: index,\n//     originalFilePath: url.trim()\n//   }\n// };\n\n//3ë²ˆì§¸ ê±°\nconst urls = Array.isArray($json.flpth_nm)\n  ? $json.flpth_nm\n  : String($json.flpth_nm || \"\").split('@');\n\nconst index = $json.fileIndex || 0;\nconst url = urls[index];\n\nif (!url) {\n  return {};\n}\n\nreturn {\n  json: {\n    ...$json,\n    mergeKey: index,  // ğŸ‘ˆ ë³‘í•© í‚¤ ì¶”ê°€\n    downloadUrl: \"https://www.kicox.or.kr\" + url.trim(),\n    fileIndex: index,\n    originalFilePath: url.trim()\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[60,440],"id":"c5276ee4-cc4b-4329-b959-83c63d40589f","name":"flpth_nm ë¶„ë¦¬ í›„ downloadUrl ìƒì„±4"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[2780,420],"id":"369a8075-c209-4ac6-aa3f-0588d10cfd1b","name":"MySQL7","credentials":{"mySql":{"id":"s7XNBHZtTOH7C66M","name":"MySQL account 2"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2980,420],"id":"91745504-969d-42ca-b9f3-71910108966a","name":"No Operation, do nothing1"},{"parameters":{"method":"POST","url":"http://43.200.39.170:8000/convert","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[640,300],"id":"695d860f-3e3c-4cae-89eb-37b3ba03e404","name":"hwp ocr"},{"parameters":{"jsCode":"// // Gemini ë˜ëŠ” LLM ì‘ë‹µì˜ í…ìŠ¤íŠ¸ ë‚´ìš©ë§Œ ì¶”ì¶œ\n// const geminiText = $json.text; // or $item(0).json.text\n\n// // Markdown ì½”ë“œ ë¸”ë¡ì—ì„œ JSON ì¶”ì¶œ: ```json\\n{...}\\n```\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(jsonMatch[1]);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // í›„ì²˜ë¦¬ + ê²½ë¡œ ê°€ê³µ\n// return {\n//   json: {\n//     ...$json,\n//     ...parsed,\n\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//   }\n// };\n\n\n\n\n\n//2ë²ˆì§¸ ê±°\n// const geminiText = $json.text;\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(jsonMatch[1]);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // âœ… text í•„ë“œ ì œì™¸ í›„ ë³‘í•©\n// const {\n//   text, // eslint-disable-line no-unused-vars\n//   ...rest\n// } = $json;\n\n// return {\n//   json: {\n//     ...rest,\n//     ...parsed,\n\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     source: \"í•œêµ­ì‚°ì—…ë‹¨ì§€ê³µë‹¨\"\n//   }\n// };\n\n\n\n//3ë²ˆì§¸ ê±°\n// const geminiText = $json.text;\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(jsonMatch[1]);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // text ì œì™¸\n// const { text, ...rest } = $json;\n\n// // ë³‘í•© í‚¤ ìœ ì§€\n// const mergeKey = $json.fileIndex || $json.mergeKey || 0;\n\n// return {\n//   json: {\n//     ...rest,\n//     ...parsed,\n//     mergeKey,  // ğŸ‘ˆ ë³‘í•© í‚¤ ì¶”ê°€\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     source: \"í•œêµ­ì‚°ì—…ë‹¨ì§€ê³µë‹¨\"\n//   }\n// };\n\n\n\n\n\n//4ë²ˆì§¸ ê±°\n// const geminiText = $json.text;\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// // ì „ì²˜ë¦¬: inqire_coê°€ ìˆ«ìí˜• ì „í™”ë²ˆí˜¸ë©´ ë¬¸ìì—´ë¡œ ê°ì‹¸ê¸°\n// let rawJson = jsonMatch[1]\n//   .replace(/\"inqire_co\"\\s*:\\s*([0-9\\-]+)\\s*,/g, '\"inqire_co\": \"$1\",');\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(rawJson);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // text ì œì™¸\n// const { text, ...rest } = $json;\n\n// // ë³‘í•© í‚¤ ìœ ì§€\n// const mergeKey = $json.fileIndex || $json.mergeKey || 0;\n\n// return {\n//   json: {\n//     ...rest,\n//     ...parsed,\n//     mergeKey,\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     source: \"í•œêµ­ì‚°ì—…ë‹¨ì§€ê³µë‹¨\"\n//   }\n// };\n\n\n\n//5ë²ˆì§¸ ê±°\nfunction convertDate(dateStr) {\n  if (!dateStr || typeof dateStr !== 'string') return null;\n  const match = dateStr.match(/(\\d{4})\\.\\s*(\\d{1,2})\\.\\s*(\\d{1,2})/);\n  if (!match) return null;\n  const [ , year, month, day ] = match;\n  return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\n}\n\nconst geminiText = $json.text;\nconst jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif (!jsonMatch) {\n  throw new Error(\"JSON block not found in Gemini output.\");\n}\n\n// ì „í™”ë²ˆí˜¸ ë¬¸ì ì²˜ë¦¬\nlet rawJson = jsonMatch[1]\n  .replace(/\"inqire_co\"\\s*:\\s*([0-9\\-]+)\\s*,/g, '\"inqire_co\": \"$1\",');\n\nlet parsed;\ntry {\n  parsed = JSON.parse(rawJson);\n} catch (err) {\n  throw new Error(\"Failed to parse JSON: \" + err.message);\n}\n\nconst { text, ...rest } = $json;\nconst mergeKey = $json.fileIndex || $json.mergeKey || 0;\n\nreturn {\n  json: {\n    ...rest,\n    ...parsed,\n    mergeKey,\n\n    // âœ… flpth_nm ë³€í™˜\n    flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    print_flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    // âœ… ë‚ ì§œ ë³€í™˜\n    reqst_begin_dt: convertDate(parsed.reqst_begin_dt),\n    reqst_end_dt: convertDate(parsed.reqst_end_dt),\n\n    exc_instt_nm: parsed.exc_instt_nm,\n    del_yn: \"N\",\n    creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    source: \"í•œêµ­ì‚°ì—…ë‹¨ì§€ê³µë‹¨\"\n  }\n};\n            "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1940,120],"id":"1dc7ab5a-17f1-4b08-96cc-32fa88fbf4fc","name":"ocr res"},{"parameters":{"mode":"combine","fieldsToMatchString":"mergeKey","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2280,420],"id":"4b49b5e0-a470-41b2-af3b-28aca0f1a1df","name":"Merge"},{"parameters":{"jsCode":"//1ë²ˆì§¸ ê±°\n// const baseUrl = \"https://www.kicox.or.kr\";\n\n// // flpth_nmì´ ë°°ì—´ì´ë©´ ì²˜ë¦¬, ì•„ë‹ˆë©´ null\n// let updatedFlpthNm = null;\n\n// if (Array.isArray($json.flpth_nm)) {\n//   updatedFlpthNm = $json.flpth_nm\n//     .map(path => `${baseUrl}${path.trim()}`)\n//     .join(\"@\");\n// } else if (typeof $json.flpth_nm === \"string\") {\n//   // ì´ë¯¸ ë¬¸ìì—´ì¸ë° @ë¡œ êµ¬ë¶„ëœ ê²½ìš°\n//   updatedFlpthNm = $json.flpth_nm\n//     .split(\"@\")\n//     .map(path => `${baseUrl}${path.trim()}`)\n//     .join(\"@\");\n// }\n\n// return {\n//   json: {\n//     ...$json,\n//     flpth_nm: updatedFlpthNm\n//   }\n// };\n\n\n\n\n\n// //2..\n// const baseUrl = \"https://www.kicox.or.kr\";\n\n\n// // 1. flpth_nm ì²˜ë¦¬\n// let updatedFlpthNm = null;\n// if (Array.isArray($json.flpth_nm)) {\n//   updatedFlpthNm = $json.flpth_nm\n//     .map(path => `${baseUrl}${path.trim()}`)\n//     .join(\"@\");\n// } else if (typeof $json.flpth_nm === \"string\") {\n//   updatedFlpthNm = $json.flpth_nm\n//     .split(\"@\")\n//     .map(path => `${baseUrl}${path.trim()}`)\n//     .join(\"@\");\n// }\n\n// // 2. í•„í„°ë§ ëŒ€ìƒ ì»¬ëŸ¼ (biz_infoì— ì‹¤ì œ ì¡´ì¬í•˜ëŠ” í•„ë“œë§Œ)\n// const allowedFields = [\n//   \"biz_info_id\", \"pblanc_nm\", \"pblanc_url\", \"pblanc_id\", \"jrsd_instt_nm\",\n//   \"exc_instt_nm\", \"bsns_sumry_cn\", \"print_flpth_nm\", \"pldir_sport_realm_lclas_code_nm\",\n//   \"rcept_engn_hmpg_url\", \"trget_nm\", \"flpth_nm\", \"reqst_begin_end_de\",\n//   \"reqst_begin_dt\", \"reqst_end_dt\", \"print_file_nm\", \"reqst_mth_papers_cn\",\n//   \"pldir_sport_realm_mlsfc_code_nm\", \"refrnc_nm\", \"file_nm\", \"inqire_co\",\n//   \"creat_p_nttm\", \"created_ts\", \"hash_tags\", \"del_yn\", \"hide_yn\", \"views\",\n//   \"is_classified\", \"source\", \"main_category\", \"sub_category\", \"classified_date\",\n//   \"classified_by\", \"subsidy_amount\", \"self_contribution_rate\", \"support_target\",\n//   \"bonus_points_factors\", \"total_budget\", \"applicant_count\", \"subsidy_amount_type\",\n//   \"total_budget_type\", \"equipment_detail_file_path\", \"equipment_detail_file_name\"\n// ];\n\n// // 3. ê¸°ì¡´ JSONì—ì„œ í•„ìš”í•œ í•„ë“œë§Œ ì¶”ì¶œ\n// const filtered = {};\n// for (const key of allowedFields) {\n//   if (key === \"flpth_nm\") {\n//     filtered[key] = updatedFlpthNm;\n//   } else if ($json.hasOwnProperty(key)) {\n//     filtered[key] = $json[key];\n//   }\n// }\n\n// return [{ json: filtered }];\n\n\n\n\n\n//3ë²ˆì§¸ ê±°\n// const baseUrl = \"https://www.kicox.or.kr\";\n\n// // 1. flpth_nm ì²˜ë¦¬: ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ê³ , URL ë¶™ì´ê³ , @ë¡œ ì—°ê²°\n// let updatedFlpthNm = null;\n// let firstPath = null;\n\n// if (Array.isArray($json.flpth_nm)) {\n//   updatedFlpthNm = $json.flpth_nm\n//     .map(path => `${baseUrl}${path.trim()}`)\n//     .join(\"@\");\n//   firstPath = `${baseUrl}${$json.flpth_nm[0].trim()}`;\n// } else if (typeof $json.flpth_nm === \"string\") {\n//   const paths = $json.flpth_nm.split(\"@\").map(p => p.trim());\n//   updatedFlpthNm = paths.map(path => `${baseUrl}${path}`).join(\"@\");\n//   if (paths.length > 0) {\n//     firstPath = `${baseUrl}${paths[0]}`;\n//   }\n// }\n\n// // 2. biz_info í…Œì´ë¸”ì— í¬í•¨ëœ í•„ë“œë§Œ ìœ ì§€\n// const allowedFields = [\n//   \"pblanc_nm\", \"pblanc_url\", \"pblanc_id\", \"jrsd_instt_nm\",\n//   \"exc_instt_nm\", \"bsns_sumry_cn\", \"print_flpth_nm\", \"pldir_sport_realm_lclas_code_nm\",\n//   \"rcept_engn_hmpg_url\", \"trget_nm\", \"flpth_nm\", \"reqst_begin_end_de\",\n//   \"reqst_begin_dt\", \"reqst_end_dt\", \"print_file_nm\", \"reqst_mth_papers_cn\",\n//   \"pldir_sport_realm_mlsfc_code_nm\", \"refrnc_nm\", \"file_nm\", \"inqire_co\",\n//   \"creat_p_nttm\", \"created_ts\", \"hash_tags\", \"del_yn\", \"hide_yn\", \"views\",\n//   \"is_classified\", \"source\", \"main_category\", \"sub_category\", \"classified_date\",\n//   \"classified_by\", \"subsidy_amount\", \"self_contribution_rate\", \"support_target\",\n//   \"bonus_points_factors\", \"total_budget\", \"applicant_count\", \"subsidy_amount_type\",\n//   \"total_budget_type\", \"equipment_detail_file_path\", \"equipment_detail_file_name\"\n// ];\n\n// // 3. í•„ë“œ ì •ë¦¬ ë° ì ìš©\n// const filtered = {};\n// for (const key of allowedFields) {\n//   if (key === \"flpth_nm\") {\n//     filtered[key] = updatedFlpthNm;\n//   } else if (key === \"print_flpth_nm\") {\n//     filtered[key] = firstPath || null;\n//   } else if ($json.hasOwnProperty(key)) {\n//     filtered[key] = $json[key];\n//   }\n// }\n\n// return [{ json: filtered }];\n\n\n\n\n//4ë²ˆì§¸ ê±°\nconst baseUrl = \"https://www.kicox.or.kr\";\n\n// flpth_nm ì²˜ë¦¬: URL ë¶™ì´ê³  @ë¡œ ì—°ê²°\nlet updatedFlpthNm = null;\nlet firstPath = null;\n\nif (Array.isArray($json.flpth_nm)) {\n  updatedFlpthNm = $json.flpth_nm.map(path => `${baseUrl}${path.trim()}`).join(\"@\");\n  firstPath = `${baseUrl}${$json.flpth_nm[0].trim()}`;\n} else if (typeof $json.flpth_nm === \"string\") {\n  const paths = $json.flpth_nm.split(\"@\").map(p => p.trim());\n  updatedFlpthNm = paths.map(path => `${baseUrl}${path}`).join(\"@\");\n  if (paths.length > 0) {\n    firstPath = `${baseUrl}${paths[0]}`;\n  }\n}\n\n// file_nm ì²˜ë¦¬: ë°°ì—´ì´ë©´ @ë¡œ ì—°ê²°, ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ\nlet updatedFileNm = null;\nif (Array.isArray($json.file_nm)) {\n  updatedFileNm = $json.file_nm.map(name => name.trim()).join(\"@\");\n} else if (typeof $json.file_nm === \"string\") {\n  updatedFileNm = $json.file_nm.trim();\n}\n\n// biz_info í…Œì´ë¸” ìœ íš¨ í•„ë“œë§Œ\nconst allowedFields = [\n  \"pblanc_nm\", \"pblanc_url\", \"pblanc_id\", \"jrsd_instt_nm\",\n  \"exc_instt_nm\", \"bsns_sumry_cn\", \"print_flpth_nm\", \"pldir_sport_realm_lclas_code_nm\",\n  \"rcept_engn_hmpg_url\", \"trget_nm\", \"flpth_nm\", \"reqst_begin_end_de\",\n  \"reqst_begin_dt\", \"reqst_end_dt\", \"print_file_nm\", \"reqst_mth_papers_cn\",\n  \"pldir_sport_realm_mlsfc_code_nm\", \"refrnc_nm\", \"file_nm\", \"inqire_co\",\n  \"creat_p_nttm\", \"created_ts\", \"hash_tags\", \"del_yn\", \"hide_yn\", \"views\",\n  \"is_classified\", \"source\", \"main_category\", \"sub_category\", \"classified_date\",\n  \"classified_by\", \"subsidy_amount\", \"self_contribution_rate\", \"support_target\",\n  \"bonus_points_factors\", \"total_budget\", \"applicant_count\", \"subsidy_amount_type\",\n  \"total_budget_type\", \"equipment_detail_file_path\", \"equipment_detail_file_name\"\n];\n\n// í•„ë“œ ì •ë¦¬\nconst filtered = {};\nfor (const key of allowedFields) {\n  if (key === \"flpth_nm\") {\n    filtered[key] = updatedFlpthNm;\n  } else if (key === \"print_flpth_nm\") {\n    filtered[key] = firstPath || null;\n  } else if (key === \"file_nm\") {\n    filtered[key] = updatedFileNm || null;\n  } else if ($json.hasOwnProperty(key)) {\n    filtered[key] = $json[key];\n  }\n}\n\nreturn [{ json: filtered }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2520,420],"id":"bd67c1e5-1c3f-4119-83cb-3448684de905","name":"Code"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1c0e8621-50ab-46ff-bda6-ed3fad0fbb97","leftValue":"={{$binary.data.fileExtension}}","rightValue":"pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[480,160],"id":"f8bfa7c6-4fcb-438f-94de-84c429d71ca7","name":"If"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage=1","responseFormat":"string","options":{}},"id":"e99ae960-2502-4500-adfd-0e56205923af","name":"ë¦¬ìŠ¤íŠ¸ìš”ì²­","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-1480,440]},{"parameters":{"extractionValues":{"values":[{"key":"href","cssSelector":"td.subject > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"b2f11591-9cbc-4ce1-9e64-de8584470308","name":"ê²Œì‹œê¸€ìš”ì²­","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-1260,440]}],"connections":{"execute":{"main":[[{"node":"ë¦¬ìŠ¤íŠ¸ìš”ì²­","type":"main","index":0}]]},"SplitInBatches12":{"main":[[{"node":"Set Full URL6","type":"main","index":0}]]},"Set Full URL6":{"main":[[{"node":"Get Detail HTML6","type":"main","index":0}]]},"Get Detail HTML6":{"main":[[{"node":"Extract Content6","type":"main","index":0}]]},"Extract Content6":{"main":[[{"node":"flpth_nm ë¶„ë¦¬ í›„ downloadUrl ìƒì„±4","type":"main","index":0}]]},"split4":{"main":[[{"node":"SplitInBatches12","type":"main","index":0}]]},"Upload a file7":{"main":[[{"node":"HTTP Request16","type":"main","index":0}]]},"HTTP Request16":{"main":[[{"node":"do ocr7","type":"main","index":0}]]},"do ocr7":{"main":[[{"node":"Code21","type":"main","index":0}]]},"download files5":{"main":[[{"node":"If","type":"main","index":0}]]},"Code21":{"main":[[{"node":"Basic LLM Chain5","type":"main","index":0}]]},"Google Gemini Chat Model6":{"ai_languageModel":[[{"node":"Basic LLM Chain5","type":"ai_languageModel","index":0}]]},"Basic LLM Chain5":{"main":[[{"node":"ocr res","type":"main","index":0}]]},"flpth_nm ë¶„ë¦¬ í›„ downloadUrl ìƒì„±4":{"main":[[{"node":"download files5","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"MySQL7":{"main":[[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"No Operation, do nothing1":{"main":[[{"node":"SplitInBatches12","type":"main","index":0}]]},"hwp ocr":{"main":[[{"node":"Upload a file7","type":"main","index":0}]]},"ocr res":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"MySQL7","type":"main","index":0}]]},"If":{"main":[[{"node":"Upload a file7","type":"main","index":0}],[{"node":"hwp ocr","type":"main","index":0}]]},"ë¦¬ìŠ¤íŠ¸ìš”ì²­":{"main":[[{"node":"ê²Œì‹œê¸€ìš”ì²­","type":"main","index":0}]]},"ê²Œì‹œê¸€ìš”ì²­":{"main":[[{"node":"split4","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"28c695bb-0130-4da6-9a72-65d164d5c4cb","triggerCount":0,"shared":[{"createdAt":"2025-06-18T01:05:53.166Z","updatedAt":"2025-06-18T01:05:53.166Z","role":"workflow:owner","workflowId":"zlKmwQLdb6KYyNXB","projectId":"YGqg9zdxGQSC73yC"}],"tags":[]}