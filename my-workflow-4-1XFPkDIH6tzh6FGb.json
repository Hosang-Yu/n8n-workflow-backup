{"updatedAt":"2025-06-20T00:21:09.171Z","createdAt":"2025-06-04T05:08:33.769Z","id":"1XFPkDIH6tzh6FGb","name":"My workflow 4","active":false,"isArchived":true,"nodes":[{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"9071e81b-c7be-4988-8e0e-0a5bd0db0108","name":"do ocr","type":"n8n-nodes-base.httpRequest","position":[3600,60],"typeVersion":4.2,"alwaysOutputData":true,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{},"name":"execute","type":"n8n-nodes-base.manualTrigger","position":[-760,20],"typeVersion":1,"id":"7b2532bc-3af7-4b66-94b0-209d1c414b21"},{"parameters":{"url":"={{ $json.base_url + $json.board_list}}?page=2","responseFormat":"string","options":{}},"name":"board list","type":"n8n-nodes-base.httpRequest","position":[-400,20],"typeVersion":1,"id":"2e425ac4-a9aa-4a07-aeb3-e9e5cc3c8640"},{"parameters":{"extractionValues":{"values":[{"key":"announcements","cssSelector":"table > tbody > tr > td > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"name":"html extract board detail list","type":"n8n-nodes-base.htmlExtract","position":[-180,20],"typeVersion":1,"id":"14d640ae-0c9d-4305-ba97-9d9646967740"},{"parameters":{"functionCode":"return items[0].json.announcements.map(function(announcement) {\n  const match = announcement.match(/'(\\d{8})'/);\n  const match2 = match[0].replaceAll(\"'\", \"\");\n  match2.trim();\n  return {\n  json: {announcement: match2}\n  }\n});"},"name":"Prepare announcement","type":"n8n-nodes-base.function","position":[160,20],"typeVersion":1,"id":"b4105eed-8606-4814-b13d-1b3b8fd5a56c"},{"parameters":{"url":"={{ $('변수설정').item.json.base_url + $('변수설정').item.json.board_list }}?View&boardNo={{ $json.announcement }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[640,40],"id":"5aa8065f-53f6-42c5-b1a8-1aaeda4c9777","name":"get detail"},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"=data","extractionValues":{"values":[{"key":"img","cssSelector":"table > tbody > tr > td > div > p > a > img","returnValue":"attribute","attribute":"src","returnArray":true},{"key":"img2","cssSelector":".table-cont > p > img","returnValue":"attribute","attribute":"src","returnArray":true},{"key":"title","cssSelector":".board-write > tbody > tr:nth-child(1) > td"},{"key":"download","cssSelector":".board-write > tbody > tr > td > .downfile-list > li > a","returnValue":"attribute","attribute":"onclick","returnArray":true},{"key":"author","cssSelector":".board-write > tbody > tr:nth-child(2) > td"},{"key":"date","cssSelector":".board-write > tbody > tr:nth-child(3) > td"},{"key":"download-file-name","cssSelector":".board-write > tbody > tr > td > .downfile-list > li > a","returnValue":"=text","returnArray":true}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[820,40],"id":"cacebafe-e076-4a72-833f-0e94a6b2089b","name":"extract img list","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987498f6-b083-4f58-b8a4-62f111640464","leftValue":"={{ $json.date }};\n","rightValue":"={{ $today.minus(1, 'years') }}","operator":{"type":"dateTime","operation":"afterOrEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1380,40],"id":"44d5cb73-0973-49f4-be9d-ff2108056e1d","name":"is it today?"},{"parameters":{"functionCode":"\nconst list1 = $input.first().json.img\nconst list2 = $input.first().json.img2\n\nconst list = list1.concat(list2);\nreturn list.map(function(item) {\n  return {list: item}\n});\n\n \n"},"name":"Prepare imgs","type":"n8n-nodes-base.function","position":[1640,40],"typeVersion":1,"id":"1cc7c8bb-9aed-482b-8ac4-7acf307260da"},{"parameters":{"url":"={{ $json.list }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition"}]},"options":{"response":{"response":{"fullResponse":true,"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2940,0],"id":"6ff2eba4-c41d-4bb0-a380-c1b3754ea174","name":"get img","alwaysOutputData":true},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"6569b10c-b27e-4e95-82a7-195104f98adc","name":"Upload a img","type":"n8n-nodes-base.httpRequest","position":[3140,60],"typeVersion":4.2,"alwaysOutputData":true,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","options":{"allowUnauthorizedCerts":false}},"id":"2fa3a62c-bf69-43f8-9221-e04e8cfa5314","name":"Retrieve img","type":"n8n-nodes-base.httpRequest","position":[3280,60],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"options":{"allowUnauthorizedCerts":false}},"id":"ef32569d-3346-4059-a1ea-53f825d3acbf","name":"Retrieve img2","type":"n8n-nodes-base.httpRequest","position":[3440,60],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"={{ \"https://www.seoultp.or.kr\"  + $json.list }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition"}]},"options":{"response":{"response":{"fullResponse":true,"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2940,140],"id":"784cefe8-a72e-4eea-969f-a4167b1136ef","name":"get img1","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8b678027-4ef0-48a2-be86-69f6234163bc","leftValue":"={{ $json.list }}","rightValue":"http","operator":{"type":"string","operation":"startsWith"}},{"id":"b89a7288-14b1-482f-83ac-6239ea5c0139","leftValue":"={{ $json.list }}","rightValue":"https","operator":{"type":"string","operation":"startsWith"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2620,60],"id":"0c9844bc-7856-4141-a8ae-46c14d9dc42d","name":"url starts with http or https"},{"parameters":{},"id":"a80a1c91-27a0-4666-8a59-ddbb2d949f03","name":"NoOp","type":"n8n-nodes-base.noOp","position":[3760,60],"typeVersion":1},{"parameters":{"options":{"reset":"={{ $node[\"Loop Over Items\"].context[\"done\"] }}"}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[420,20],"id":"08ae6277-5cfe-41c5-814c-f9f76c31029a","name":"Loop Over Items"},{"parameters":{"batchSize":"={{ $('Prepare imgs').all().length }}","options":{"reset":"={{ $node[\"Loop Over Items1\"].context[\"done\"] }}"}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1820,40],"id":"981c94f6-6910-4337-8e1c-5a82db13b6f0","name":"Loop Over Items1"},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"append","field":"pages[0].markdown"}]},"options":{"outputFormat":"singleItem"}},"type":"n8n-nodes-base.summarize","typeVersion":1.1,"position":[2000,-480],"id":"0347edf5-b9d7-47c8-994d-8998553ff330","name":"Summarize2"},{"parameters":{"promptType":"define","text":"={{ $json.appended_pages0_markdown }} \\n에서 pblanc_nm(공고제목), jrsd_instt_nm(지역 혹은 사이트이름), bsns_sumry_cn(공고요약), bsns_sumry_cn(대상기업), 공고시작기간, 공고마감기간, 사업신청방법, 문의처에 대한 정보를 알려줘","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[3400,-380],"id":"2da19727-3c7e-445b-8028-3b4985521826","name":"AI Agent1"},{"parameters":{"modelName":"models/gemini-1.5-flash-8b-latest","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[3420,-220],"id":"2829c23e-3b97-4ebe-b290-30af6f4725c1","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"base_url\": \"https://www.seoultp.or.kr\",\n  \"board_list\": \"/user/nd19746.do\",\n  \"api_key\":\"gqWjltgMgARE3CsbEOXptHkJeXetB4gO\",\n  \"attach_url\": \"https://www.seoultp.or.kr/common/attachfile/attachfileDownload.do?attachNo=\"\n}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-560,20],"id":"a966f201-8841-4467-8e9b-da313878bb64","name":"변수설정"},{"parameters":{"assignments":{"assignments":[{"id":"db86008e-ffea-4dd3-b12c-eb9d5087ad7c","name":"pblanc_nm","value":"={{ $json.title }}","type":"string"},{"id":"6c5d9cd9-8615-4b24-9877-85bc3212838e","name":"jrsd_instt_nm","value":"","type":"string"},{"id":"d5d8167a-b583-4be1-acd3-7f0a7a670db4","name":"bsns_sumry_cn","value":"","type":"string"},{"id":"8b1d7818-c19d-4e71-8f92-eb189ac74c2f","name":"print_flpth_nm","value":"","type":"string"},{"id":"024227d2-c0d4-41cf-8861-18253133de44","name":"print_file_nm","value":"","type":"string"},{"id":"3128702e-55ec-4b48-bf10-c6ad64cf22d8","name":"flpth_nm","value":"","type":"string"},{"id":"4fe7272a-2b3b-44b0-a516-17728f425834","name":"file_nm","value":"","type":"string"},{"id":"6d92a68b-a296-4b78-833d-327ecd397459","name":"trget_nm","value":"","type":"string"},{"id":"6946fd74-8e26-4d32-a7d9-2598963cdc1d","name":"reqst_begin_end_de","value":"","type":"string"},{"id":"7bb3c27c-2f02-45c8-ae78-1f3056f3e16e","name":"reqst_begin_dt","value":"","type":"string"},{"id":"cf2e7999-d720-400e-9cc5-4f3c28aaecf3","name":"reqst_mth_papers_cn","value":"","type":"string"},{"id":"33fc6441-0da2-4b2d-b3a8-6ea254feaa82","name":"refrnc_nm","value":"","type":"string"},{"id":"e5ccd168-6b14-450f-8bed-a6d8d24a69d6","name":"hash_tags","value":"","type":"string"},{"id":"e51a8bf0-48c4-49bd-90c2-7f0e969b3cb5","name":"is_classified","value":"N","type":"string"},{"id":"e1d8ebcb-4bd9-4b05-9847-c090a8fa1de9","name":"source","value":"서울테크노파크","type":"string"},{"id":"f3810748-7fe3-461f-8cc7-06906cbdeb4a","name":"subsidy_amount_type","value":"text","type":"string"},{"id":"3db963f3-f950-42ad-9068-80ed7c01535c","name":"total_budget_type","value":"text","type":"string"},{"id":"85f6b1b3-d733-43ac-9c6e-868e7efa55a8","name":"announcement","value":"={{ $json.announcement }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1140,220],"id":"acc2ae53-e2b9-42cf-89a8-1c87304f14d9","name":"Edit Fields","onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"db86008e-ffea-4dd3-b12c-eb9d5087ad7c","name":"pblanc_nm","value":"","type":"string"},{"id":"6c5d9cd9-8615-4b24-9877-85bc3212838e","name":"jrsd_instt_nm","value":"","type":"string"},{"id":"d5d8167a-b583-4be1-acd3-7f0a7a670db4","name":"bsns_sumry_cn","value":"","type":"string"},{"id":"8b1d7818-c19d-4e71-8f92-eb189ac74c2f","name":"print_flpth_nm","value":"","type":"string"},{"id":"024227d2-c0d4-41cf-8861-18253133de44","name":"print_file_nm","value":"","type":"string"},{"id":"3128702e-55ec-4b48-bf10-c6ad64cf22d8","name":"flpth_nm","value":"","type":"string"},{"id":"4fe7272a-2b3b-44b0-a516-17728f425834","name":"file_nm","value":"","type":"string"},{"id":"6d92a68b-a296-4b78-833d-327ecd397459","name":"trget_nm","value":"","type":"string"},{"id":"6946fd74-8e26-4d32-a7d9-2598963cdc1d","name":"reqst_begin_end_de","value":"","type":"string"},{"id":"7bb3c27c-2f02-45c8-ae78-1f3056f3e16e","name":"reqst_begin_dt","value":"","type":"string"},{"id":"cf2e7999-d720-400e-9cc5-4f3c28aaecf3","name":"reqst_mth_papers_cn","value":"","type":"string"},{"id":"33fc6441-0da2-4b2d-b3a8-6ea254feaa82","name":"refrnc_nm","value":"","type":"string"},{"id":"e5ccd168-6b14-450f-8bed-a6d8d24a69d6","name":"hash_tags","value":"","type":"string"},{"id":"e51a8bf0-48c4-49bd-90c2-7f0e969b3cb5","name":"is_classified","value":"N","type":"string"},{"id":"e1d8ebcb-4bd9-4b05-9847-c090a8fa1de9","name":"source","value":"서울테크노파크","type":"string"},{"id":"f3810748-7fe3-461f-8cc7-06906cbdeb4a","name":"subsidy_amount_type","value":"text","type":"string"},{"id":"3db963f3-f950-42ad-9068-80ed7c01535c","name":"total_budget_type","value":"text","type":"string"},{"id":"85f6b1b3-d733-43ac-9c6e-868e7efa55a8","name":"announcement","value":"={{ $json.announcement }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[440,620],"id":"77c8b2b2-1172-4026-a77f-7ea3106b370d","name":"Edit Fields1","onError":"continueRegularOutput"},{"parameters":{"jsCode":"return {title: $input.first().json.title}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[980,220],"id":"00fe51c3-3047-4b2e-9ec9-c29fe0b08e7a","name":"Code"},{"parameters":{"schemaType":"manual","inputSchema":"{\n    \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n    \"$id\": \"https://example.com/product.schema.json\",\n    \"title\": \"anouncement\",\n\t\"type\": \"object\",\n\t\"properties\": {\n      \"pblanc_nm\": {\n        \"type\": \"string\",\n        \"description\": \"공고 제목\"\n      }\n\t}\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[3620,-200],"id":"90c3cbb2-e7e7-47f6-bfba-76a1851127da","name":"Structured Output Parser","notesInFlow":false},{"parameters":{"jsCode":"return JSON.parse($input.first().json.output);\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2580,-480],"id":"70dbe25c-b671-42df-be7a-29c8ec035976","name":"Code1"},{"parameters":{"promptType":"define","text":"={{ $json.appended_pages0_markdown }} \\n에서 pblanc_nm(공고제목), jrsd_instt_nm(지역 혹은 사이트이름), bsns_sumry_cn(공고요약), trget_nm(대상기업), reqst_begin_end_de(공고 전체기간), reqst_begin_dt(공고시작기간), reqst_end_dt(공고마감기간), reqst_mth_papers_cn(사업신청방법), refrnc_nm(문의처)에 대한 정보를 알려줘","hasOutputParser":true,"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[2220,-480],"id":"e5f39cd4-5475-4cb4-a76a-ed68c345acd6","name":"Basic LLM Chain"},{"parameters":{"modelName":"models/gemini-1.5-flash-8b-latest","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[2240,-220],"id":"9f44d0be-cb7d-4018-975d-6d655ece7ad5","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"schemaType":"manual","inputSchema":"{\n    \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n    \"$id\": \"https://example.com/product.schema.json\",\n    \"title\": \"anouncement\",\n\t\"type\": \"object\",\n\t\"properties\": {\n      \"pblanc_nm\": {\n        \"type\": \"string\",\n        \"description\": \"공고제목\"\n      },\n      \"jrsd_instt_nm\": {\n        \"type\": \"string\",\n        \"description\": \"공고지역\"\n      },\n      \"bsns_sumry_cn\": {\n        \"type\": \"string\",\n        \"description\": \"공고요약\"\n      },\n      \"trget_nm\": {\n        \"type\": \"string\",\n        \"description\": \"대상기업\"\n      },\n      \"reqst_begin_end_de\": {\n        \"type\": \"string\",\n        \"description\": \"공고 전체 기간\"\n      },\n      \"reqst_begin_dt\": {\n        \"type\": \"string\",\n        \"description\": \"공고 시작 기간\"\n      },\n      \"reqst_end_dt\": {\n        \"type\": \"string\",\n        \"description\": \"공고 종료 기간\"\n      },\n      \"reqst_mth_papers_cn\": {\n        \"type\": \"string\",\n        \"description\": \"사업신청 방법\"\n      },\n      \"refrnc_nm\": {\n        \"type\": \"string\",\n        \"description\": \"문의처내용\"\n      },\n      \"hash_tags\": {\n        \"type\": \"string\",\n        \"description\": \"해시태그들\"\n      }\n\t}\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[2420,-220],"id":"89b21439-2d67-4df8-b3d5-43cc1c082690","name":"Structured Output Parser1","notesInFlow":false}],"connections":{"do ocr":{"main":[[{"node":"NoOp","type":"main","index":0}]]},"execute":{"main":[[{"node":"변수설정","type":"main","index":0}]]},"board list":{"main":[[{"node":"html extract board detail list","type":"main","index":0}]]},"html extract board detail list":{"main":[[{"node":"Prepare announcement","type":"main","index":0}]]},"Prepare announcement":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"get detail":{"main":[[{"node":"extract img list","type":"main","index":0}]]},"extract img list":{"main":[[{"node":"is it today?","type":"main","index":0},{"node":"Code","type":"main","index":0}]]},"is it today?":{"main":[[{"node":"Prepare imgs","type":"main","index":0}],[]]},"Prepare imgs":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"get img":{"main":[[{"node":"Upload a img","type":"main","index":0}]]},"Upload a img":{"main":[[{"node":"Retrieve img","type":"main","index":0}]]},"Retrieve img":{"main":[[{"node":"Retrieve img2","type":"main","index":0}]]},"Retrieve img2":{"main":[[{"node":"do ocr","type":"main","index":0}]]},"get img1":{"main":[[{"node":"Upload a img","type":"main","index":0}]]},"url starts with http or https":{"main":[[{"node":"get img","type":"main","index":0}],[{"node":"get img1","type":"main","index":0}]]},"NoOp":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"get detail","type":"main","index":0}]]},"Loop Over Items1":{"main":[[{"node":"Summarize2","type":"main","index":0}],[{"node":"url starts with http or https","type":"main","index":0}]]},"Summarize2":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]},"AI Agent1":{"main":[[]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"변수설정":{"main":[[{"node":"board list","type":"main","index":0}]]},"Edit Fields":{"main":[[]]},"Code":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent1","type":"ai_outputParser","index":0}]]},"Code1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Basic LLM Chain","type":"ai_outputParser","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"86c0e14a-5c18-4745-99f7-37d40db3d9f6","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-06-04T05:08:33.769Z","createdAt":"2025-06-04T05:08:33.769Z","role":"workflow:owner","workflowId":"1XFPkDIH6tzh6FGb","projectId":"YGqg9zdxGQSC73yC"}],"activeVersion":null,"tags":[]}