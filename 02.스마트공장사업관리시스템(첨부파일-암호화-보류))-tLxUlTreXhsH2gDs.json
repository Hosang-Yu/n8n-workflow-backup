{"createdAt":"2025-06-16T04:57:03.412Z","updatedAt":"2025-06-23T02:19:54.364Z","id":"tLxUlTreXhsH2gDs","name":"02.스마트공장사업관리시스템(첨부파일 암호화 보류))","active":false,"isArchived":true,"nodes":[{"parameters":{"method":"POST","url":"https://www.smart-factory.kr/raonkupload/handler/raonkhandler.jsp","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"},{"name":"Accept-Encoding","value":"gzip, deflate, br, zstd"},{"name":"Referer","value":"https://www.smart-factory.kr/files/getAtchFileUpload.do"}]},"sendBody":true,"contentType":"form-urlencoded","bodyParameters":{"parameters":[{"name":"k00","value":"a2MMYzianzwExorC2swMQwxC2sxMgwxYjI0OTM0ZjdjMzE0NDFlOWEyMGI3ZTU5ZTE0MTgzMAtrMDUMMAtrMjYML2Nsb3VkX25hcy91cGxvYWQvc2ZwbXMvMjAyNS8wNS8yMDI1MDUxOTE1MDIxOF9iZFFFRF9QVDExZWYwMDA2NjMxNDRfMS5od3ALazMxDDIuIDI164WEIOuMgOykkeyGjOyDgeyDne2YleyKpOuniO2KuOqzteyepeyCrOyXhV/rj4TsnoXquLDsl4Ug66qo7KeRIOqzteqzoCjslYgpX0hE7ZiE64yA7J247ZSE65287L2U7Ja0Lmh3cAtrMjEML2Nsb3VkX25hcy91cGxvYWQvc2ZwbXMvMjAyNS8wNS8yMDI1MDUxOTE1MDIxOF9iZFFFRF9QVDExZWYwMDA2NjMxNDRfMS5od3ALazE2DA=="}]},"options":{"redirect":{"redirect":{}},"response":{"response":{"responseFormat":"file","outputPropertyName":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1220,-520],"id":"8eaee037-941e-4e8e-9984-0413df775946","name":"HTTP Request"},{"parameters":{"jsCode":"return $input.first().json.bsnsPbancList.map((item) => {\n  return {\"pbancId\": item.pbancId, \"pbancSn\": item.pbancSn};\n})"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-160,-640],"id":"98c5837b-53b0-4df3-ad8e-cbfb2dbb317d","name":"split board list"},{"parameters":{"method":"POST","url":"={{ $json[\"board-list-url\"] }}","sendBody":true,"specifyBody":"json","jsonBody":"{\"key\":\"list\",\"bizYr\":\"2025\",\"bizClsfCd\":[],\"dtlPbancNm\":\"\",\"blockPage\":\"10\",\"pageBasic\":\"1\",\"startNumber\":\"0\",\"showPage\":\"10\",\"totalPageCount\":\"14\",\"endNumber\":\"9\",\"currentPage\":2,\"totalCount\":\"140\"}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-320,-640],"id":"44513dc2-0f29-479c-a8f4-05f21a066cf2","name":"http board list request","notesInFlow":false,"alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"1d1842d1-0eda-466d-b89e-a67dacd7a05c","name":"offset","value":"={{ $json.pblanc_nm }}","type":"string"},{"id":"49fe1a30-fd6e-4750-a111-190dc51fef4e","name":"board-detail-url","value":"https://www.smart-factory.kr/usr/bg/ba/ma/bsnsPblanc/getBsnsPbancDtl.do","type":"string"},{"id":"de41dcc9-8101-4e9b-bc09-47d945ccd02c","name":"board-list-url","value":"https://www.smart-factory.kr/usr/bg/ba/ma/bsnsPblanc/getBsnsPbancAllList.do","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-460,-640],"id":"3f4a7cd0-543b-42b4-9f0d-3356a1402baa","name":"offset setting"},{"parameters":{"operation":"select","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"limit":1,"where":{"values":[{"column":"source","value":"스마트공장사업관리시스템"}]},"sort":{"values":[{"column":"biz_info_id","direction":"DESC"}]},"options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[-600,-640],"id":"acd01211-c693-47a3-ac16-bf78cc92f137","name":"query last offset","alwaysOutputData":true,"credentials":{"mySql":{"id":"HSXhV0YEF0PlSVWX","name":"MySQL account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1160,-220],"id":"2f68b8b2-6c5b-4e61-ad42-8f36d0568514","name":"execute"},{"parameters":{"options":{"reset":"={{ $node[\"Loop Over Items\"].context[\"done\"] }}"}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[40,-640],"id":"5ed9ca50-d17d-4d8a-ad25-9e62c652fb3a","name":"Loop Over Items"},{"parameters":{"method":"POST","url":"={{ $('offset setting').item.json[\"board-detail-url\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"pbancId","value":"={{ $json.pbancId }}"},{"name":"pbancSn","value":"={{ $json.pbancSn }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[240,-520],"id":"35edf001-a49c-4e90-a25a-81c8ca317619","name":"HTTP Request1","onError":"continueRegularOutput"},{"parameters":{"method":"POST","url":"https://www.smart-factory.kr/files/selectTmpltAtchList.do","sendBody":true,"bodyParameters":{"parameters":[{"name":"atchFileId","value":"={{ $json.bsnsPbancDtl.atchFileId }}"},{"name":"upDocTypeCd","value":"F00276"},{"name":"extnNm","value":"png,jpg,jpeg,hwp,xlsx,xls,pdf,ppt,pptx,doc,docx,cvs,txt,zip,egg"},{"name":"sbmsnEsntlYn","value":"N"},{"name":"singleOnlyRead","value":"N"},{"name":"tmpltType","value":"0"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[460,-520],"id":"a28c9ff4-464a-422b-87b6-a2f35fa829bc","name":"HTTP Request2"},{"parameters":{"jsCode":"const CryptoJS = require('crypto-js');\n\nvar RaonKBase64 = {\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n    _trans_unitDelimiter: \"\\x0B\",\n    _trans_unitAttributeDelimiter: \"\\f\",\n    encode: function(b) {\n        var e = \"\", c, a, f, g, k, l, n = 0;\n        for (b = RaonKBase64._utf8_encode(b); n < b.length; )\n            c = b.charCodeAt(n++),\n            a = b.charCodeAt(n++),\n            f = b.charCodeAt(n++),\n            g = c >> 2,\n            c = (c & 3) << 4 | a >> 4,\n            k = (a & 15) << 2 | f >> 6,\n            l = f & 63,\n            isNaN(a) ? k = l = 64 : isNaN(f) && (l = 64),\n            e = e + this._keyStr.charAt(g) + this._keyStr.charAt(c) + this._keyStr.charAt(k) + this._keyStr.charAt(l);\n        return e\n    },\n    decode: function(b) {\n        var e = \"\", c, a, f, g, k, l = 0;\n        for (b = b.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\"); l < b.length; )\n            c = this._keyStr.indexOf(b.charAt(l++)),\n            a = this._keyStr.indexOf(b.charAt(l++)),\n            g = this._keyStr.indexOf(b.charAt(l++)),\n            k = this._keyStr.indexOf(b.charAt(l++)),\n            c = c << 2 | a >> 4,\n            a = (a & 15) << 4 | g >> 2,\n            f = (g & 3) << 6 | k,\n            e += String.fromCharCode(c),\n            64 != g && (e += String.fromCharCode(a)),\n            64 != k && (e += String.fromCharCode(f));\n        return e = RaonKBase64._utf8_decode(e)\n    },\n    _utf8_encode: function(b) {\n        b = b.replace(/\\r\\n/g, \"\\n\");\n        for (var e = \"\", c = 0; c < b.length; c++) {\n            var a = b.charCodeAt(c);\n            128 > a ? e += String.fromCharCode(a) : (127 < a && 2048 > a ? e += String.fromCharCode(a >> 6 | 192) : (e += String.fromCharCode(a >> 12 | 224),\n            e += String.fromCharCode(a >> 6 & 63 | 128)),\n            e += String.fromCharCode(a & 63 | 128))\n        }\n        return e\n    },\n    _utf8_decode: function(b) {\n        for (var e = \"\", c = 0, a = c1 = c2 = 0; c < b.length; )\n            a = b.charCodeAt(c),\n            128 > a ? (e += String.fromCharCode(a),\n            c++) : 191 < a && 224 > a ? (c2 = b.charCodeAt(c + 1),\n            e += String.fromCharCode((a & 31) << 6 | c2 & 63),\n            c += 2) : (c2 = b.charCodeAt(c + 1),\n            c3 = b.charCodeAt(c + 2),\n            e += String.fromCharCode((a & 15) << 12 | (c2 & 63) << 6 | c3 & 63),\n            c += 3);\n        return e\n    },\n    makeEncryptParam: function(b) {\n        b = RaonKBase64.encode(b);\n        b = RaonKBase64.insertAt(b, 8, \"r\");\n        b = RaonKBase64.insertAt(b, 6, \"a\");\n        b = RaonKBase64.insertAt(b, 9, \"o\");\n        b = RaonKBase64.insertAt(b, 7, \"n\");\n        b = RaonKBase64.insertAt(b, 8, \"w\");\n        b = RaonKBase64.insertAt(b, 6, \"i\");\n        b = RaonKBase64.insertAt(b, 9, \"z\");\n        return b = b.replace(/[+]/g, \"%2B\")\n    },\n    makeEncryptParam2: function(b, e) {\n        var c = e\n          , a = b.keyValue\n          , a = a.substring(0, 15)\n          , a = CryptoJS.enc.Utf8.parse(a);\n        a.sigBytes = 16;\n        c = CryptoJS.enc.Utf8.parse(c);\n        c = CryptoJS.AES.encrypt(c, a, {\n            iv: a\n        });\n        a = CryptoJS.enc.Base64._map;\n        CryptoJS.enc.Base64._map = \"hituvabcdejklmnopqrxyzsfgwBCDEANOPQRSFGHIJKLYZMTUVWX5890167234+/=\";\n        c = CryptoJS.enc.Base64.stringify(c.ciphertext);\n        CryptoJS.enc.Base64._map = a;\n        return c = c.replace(/[+]/g, \"%2B\")\n    },\n    makeDecryptReponseMessage: function(b, e) {\n        var c, a = function(a, b) {\n            var c = a.split(\"\");\n            c.splice(b, 1);\n            return c = c.join(\"\")\n        };\n        c = b.replace(/ /g, \"\");\n        c = c.replace(/\\r/g, \"\");\n        c = c.replace(/\\n/g, \"\");\n        c = c.replace(/%2B/g, \"+\");\n        if (0 == c.indexOf(\"_\"))\n            try {\n                c = c.substring(1);\n                var f = e.keyValue\n                  , f = f.substring(0, 14)\n                  , f = CryptoJS.enc.Utf8.parse(f);\n                f.sigBytes = 16;\n                var g = CryptoJS.enc.Base64._map;\n                CryptoJS.enc.Base64._map = \"hituvabcdejklmnopqrxyzsfgwBCDEANOPQRSFGHIJKLYZMTUVWX5890167234+/=\";\n                c = CryptoJS.enc.Base64.parse(c);\n                CryptoJS.enc.Base64._map = g;\n                c = CryptoJS.AES.decrypt({\n                    ciphertext: c\n                }, f, {\n                    iv: f\n                }).toString(CryptoJS.enc.Utf8)\n            } catch (k) {\n                c = \"C012|response data decrypt error\"\n            }\n        else\n            c = a(c, 9),\n            c = a(c, 6),\n            c = a(c, 8),\n            c = a(c, 7),\n            c = a(c, 9),\n            c = a(c, 6),\n            c = a(c, 8),\n            c = RaonKBase64.decode(c);\n        return c\n    },\n    insertAt: function(b, e, c) {\n        return String.prototype.insertAt ? b.insertAt(e, c) : b.substr(0, e) + c + b.substr(e)\n    },\n    parseDataFromServer: function(b) {\n        var e = b.toLowerCase().indexOf(\"<raonk>\");\n        -1 < e && (b = b.substring(e + 7));\n        e = b.toLowerCase().indexOf(\"</raonk>\");\n        -1 < e && (b = b.substring(0, e));\n        return b\n    },\n    makeEncryptParamFinal: function(b, e) {\n        var c = {\n            name: \"\",\n            value: \"\"\n        };\n        if (\"1\" >= b.encryptParam)\n            b.createKey ? (c.name = \"k10\",\n            c.value = b.keyValue + RaonKBase64.makeEncryptParam(e)) : (c.name = \"k00\",\n            c.value = RaonKBase64.makeEncryptParam(e));\n        else if (\"2\" == b.encryptParam)\n            try {\n                b.createKey ? (c.name = \"k11\",\n                c.value = b.keyValue + RaonKBase64.makeEncryptParam2(b, e)) : (c.name = \"k01\",\n                c.value = RaonKBase64.makeEncryptParam2(b, e))\n            } catch (a) {\n                b.createKey ? (c.name = \"k10\",\n                c.value = b.keyValue + RaonKBase64.makeEncryptParam(e)) : (c.name = \"k00\",\n                c.value = RaonKBase64.makeEncryptParam(e))\n            }\n        return c\n    }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-940,-220],"id":"4a5fe7fa-dcfa-49d5-a7c2-5bbd9f0afc1e","name":"Code"}],"connections":{"HTTP Request":{"main":[[]]},"http board list request":{"main":[[{"node":"split board list","type":"main","index":0}]]},"offset setting":{"main":[[{"node":"http board list request","type":"main","index":0}]]},"query last offset":{"main":[[{"node":"offset setting","type":"main","index":0}]]},"execute":{"main":[[{"node":"Code","type":"main","index":0}]]},"split board list":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"HTTP Request1","type":"main","index":0}]]},"HTTP Request1":{"main":[[{"node":"HTTP Request2","type":"main","index":0}]]},"HTTP Request2":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Code":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"fe9abdd7-64e8-4f54-811a-08d89062c709","triggerCount":0,"shared":[{"createdAt":"2025-06-16T04:57:03.412Z","updatedAt":"2025-06-16T04:57:03.412Z","role":"workflow:owner","workflowId":"tLxUlTreXhsH2gDs","projectId":"YGqg9zdxGQSC73yC"}],"tags":[]}