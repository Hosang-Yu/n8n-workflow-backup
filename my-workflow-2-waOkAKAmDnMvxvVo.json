{"createdAt":"2025-05-30T08:50:20.570Z","updatedAt":"2025-07-09T00:00:24.207Z","id":"waOkAKAmDnMvxvVo","name":"My workflow 2","active":false,"isArchived":true,"nodes":[{"parameters":{"url":"={{ $json.baseurl }}","responseFormat":"string","options":{}},"name":"HTTP Request","type":"n8n-nodes-base.httpRequest","position":[-1160,-500],"typeVersion":1,"id":"1b52e544-1af1-42c4-aa56-dede16bc2e7c"},{"parameters":{"extractionValues":{"values":[{"key":"announcements","cssSelector":"table > tbody > tr > td > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{}},"name":"HTML Extract","type":"n8n-nodes-base.htmlExtract","position":[-980,-500],"typeVersion":1,"id":"b1cc7538-f39d-456c-83ed-9eb1b54987df"},{"parameters":{"batchSize":1,"options":{"reset":false}},"name":"SplitInBatches","type":"n8n-nodes-base.splitInBatches","position":[-580,-500],"typeVersion":1,"id":"45051bf2-7950-46a9-a7a2-f419dc9d1dc7"},{"parameters":{"functionCode":"return items[0].json.announcements.map(function(announcement) {\n  const match = announcement.match(/'(\\d{8})'/);\n  const match2 = match[0].replaceAll(\"'\", \"\");\n  match2.trim();\n  return {\n  json: {announcement: match2}\n  }\n});"},"name":"Prepare countries","type":"n8n-nodes-base.function","position":[-780,-500],"typeVersion":1,"id":"738609ba-3e76-45cc-b86f-b7af229ec969"},{"parameters":{"command":"mkdir -p  /home/node/.cache/scrapper/"},"name":"Create Directory","type":"n8n-nodes-base.executeCommand","position":[-1600,-500],"typeVersion":1,"id":"323346d3-c2c4-4ee0-b746-4a71010baab0","continueOnFail":true},{"parameters":{"url":"={{ $('Code').item.json.baseurl }}?View&boardNo={{ $json.announcement }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-380,-500],"id":"a224a4d2-ad93-4240-ab35-bb20509a9dc7","name":"HTTP Request1"},{"parameters":{"jsCode":"return {baseurl: 'https://www.seoultp.or.kr/user/nd19746.do'}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1360,-500],"id":"fdfc74c4-ba4c-40b9-ba25-910596f6c91f","name":"Code"},{"parameters":{"promptType":"define","text":"={{ $('HTTP Request').item.json.data }} 에서 제목이랑 작성자, 등록일을 찾아줘","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-40,-500],"id":"f845ccee-1eee-4962-bbe6-f7c1ca21bec5","name":"AI Agent"},{"parameters":{"modelName":"models/gemini-2.0-flash-lite","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-20,-200],"id":"b4d003b8-dd19-4f9e-903d-e010808df155","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"return {chatInput: \"python 크롤링 예제?\"}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1600,-300],"id":"cfff3e0f-f3de-4e37-b206-56396ae033e9","name":"Code2"},{"parameters":{"url":"http://localhost:5678","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1300,-680],"id":"24b6db00-4d20-4415-8b5e-7f604740878a","name":"HTTP Request2"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage={{$json.page}}","options":{"response":{"response":{"responseFormat":"text"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1440,740],"id":"95305136-89f8-4ff7-b865-97167aa57660","name":"HTTP Request3"},{"parameters":{"jsCode":"const output = [];\nfor (let i = 1; i <= 1; i++) {\n  output.push({ json: { page: i } });\n}\nreturn output;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1620,740],"id":"a06ebf67-f62a-4859-84a3-4b8b7071dfc6","name":"Generate Pages"},{"parameters":{"jsCode":"const html = $json.body || $json.data || '';\n\nconst regex = /href=\"(\\/user\\/bbs\\/BD_selectBbs\\.do[^\"]+)[^>]*?\">\\s*([\\s\\S]*?)<\\/a>/g;\nconst matches = html.matchAll(regex);\n\nconst results = [];\nfor (const match of matches) {\n  const rawUrl = match[1];\n  const rawTitle = match[2];\n\n  // HTML 엔티티 디코딩 (예: &amp; -> &)\n  const decodedUrl = rawUrl.replace(/&amp;/g, '&');\n\n  // 태그 제거 + 공백 정리\n  const cleanTitle = rawTitle.replace(/<[^>]+>/g, '').replace(/\\s+/g, ' ').trim();\n\n  results.push({\n    url: \"https://www.kicox.or.kr\" + decodedUrl,\n    title: cleanTitle,\n  });\n}\n\nreturn results.map(r => ({ json: r }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1260,740],"id":"138ff21b-9aea-4016-a895-73d99023fbc1","name":"Parse Post Links","alwaysOutputData":false},{"parameters":{},"type":"n8n-nodes-base.code","typeVersion":2,"position":[700,500],"id":"53ac42b2-92c2-437a-8172-593fa3b3076f","name":"Code1"},{"parameters":{"jsCode":"const html = $json.body || $json.data || '';\nconst regex = /href=\"(\\/user\\/bbs\\/BD_fileDown\\.do[^\"]+)[^>]*?\">\\s*([\\s\\S]*?)<\\/a>/g;\n\nconst results = [];\nfor (const match of html.matchAll(regex)) {\n  results.push({\n    downloadUrl: 'https://www.kicox.or.kr' + match[1].replace(/&amp;/g, '&'),\n    fileName: match[2].replace(/<[^>]+>/g, '').replace(/\\s+/g, ' ').trim()\n  });\n}\n\nreturn results.map(r => ({ json: r }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[300,500],"id":"73a996fd-733d-49d7-af39-34c8f6feaa8d","name":"Extract File Links"},{"parameters":{"url":"={{$json.url}}","options":{"response":{"response":{"responseFormat":"text"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1080,740],"id":"de4bf267-41e1-4072-8327-ec87a506daa7","name":"HTTP Request(Post Detail)"},{"parameters":{"jsCode":"const html = $json.data || '';\nconst regex = /href=\"(\\/(?:user\\/bbs\\/BD_fileDown|component\\/file\\/ND_fileDownload)\\.do[^\"]+)[^>]*?\">\\s*([^<]+)<\\/a>/g;\n\nconst attachments = [];\nlet match;\n\nwhile ((match = regex.exec(html)) !== null) {\n  attachments.push({\n    fileName: match[2].trim(),\n    downloadUrl: \"https://www.kicox.or.kr\" + match[1],\n  });\n}\n\nreturn [\n  {\n    json: {\n      sourceUrl: $json.url || '',  // 게시글 원 URL\n      attachments,\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[500,500],"id":"94466920-1932-4dd1-af65-fb648e54293e","name":"Code3"},{"parameters":{"jsCode":"// const html = $json.data || $json.body || '';\n\n// const regex = /href=\"(\\/component\\/file\\/ND_fileDownload\\.do\\?q_fileSn=([^&]+)&amp;q_fileId=([^\"]+))\"[^>]*?>([^<]+)<\\/a>/g;\n\n// const results = [];\n// let match;\n\n// while ((match = regex.exec(html)) !== null) {\n//   results.push({\n//     fileSn: match[2],\n//     fileId: match[3],\n//     fileName: match[4].trim(),\n//     downloadUrl: `https://www.kicox.or.kr${match[1].replace(/&amp;/g, '&')}`,\n//   });\n// }\n\n// return results.map(r => ({ json: r }));\n\n// Mode 설정: Run Once for All Items\n\nconst results = [];\n\nfor (const item of items) {\n  const html = item.json.data || item.json.body || '';\n\n  const regex = /href=\"(\\/component\\/file\\/ND_fileDownload\\.do\\?q_fileSn=([^&]+)&amp;q_fileId=([^\"]+))\"[^>]*?>([^<]+)<\\/a>/g;\n\n  let match;\n  while ((match = regex.exec(html)) !== null) {\n    results.push({\n      json: {\n        sourceUrl: item.json.url,  // 원래 게시글 링크\n        fileSn: match[2],\n        fileId: match[3],\n        fileName: match[4].trim(),\n        downloadUrl: `https://www.kicox.or.kr${match[1].replace(/&amp;/g, '&')}`,\n      }\n    });\n  }\n}\n\nreturn results;\n\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-880,740],"id":"6c025439-07e4-4b18-80b6-26ea3afc9187","name":"get downladUrl"},{"parameters":{"url":"=","options":{"response":{"response":{"responseFormat":"file"}},"timeout":10000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-360,560],"id":"3a3beba6-05e8-4963-ae66-aa180dffdecf","name":"HTTP Request (Download File)","alwaysOutputData":false},{"parameters":{"url":" https://www.kicox.or.kr/component/file/ND_fileDownload.do?q_fileSn=145261&q_fileId=c62c1a70-b0e0-4e5b-a1a4-6ba6a7dc12d0","options":{"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-120,560],"id":"d599cbed-942f-41a1-a5e7-695160ee0c54","name":"HTTP Request4"},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-380,740],"id":"080e8424-279d-4eed-b26a-dd2ed0dbd06b","name":"HTTP Request5"},{"parameters":{"jsCode":"console.log($json.downloadUrl);\nreturn [{ json: $json }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-540,740],"id":"26a46a22-3aa0-4212-ab10-ad8bd6c71628","name":"Code4"},{"parameters":{"jsCode":"return items.map(item => {\n  const raw = item.json.downloadUrl || '';\n  const cleaned = raw\n    .toString()\n    .replace(/[\\n\\r\\t\\s]+/g, '')         // 공백 및 줄바꿈 제거\n    .replace(/&amp;/g, '&')              // HTML 인코딩 된 & 해제\n    .trim();\n  return {\n    json: {\n      ...item.json,\n      downloadUrl: decodeURI(cleaned)\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-700,740],"id":"3753f4aa-e417-420c-b22c-e2dd47265cf3","name":"Code5"},{"parameters":{"jsCode":"return items.map(item => {\n  item.binary.data.fileName = item.json.fileName || 'downloaded.pdf';\n  return item;\n});\n// return items.map(item => {\n//   return {\n//     json: {\n//       fileName: item.binary?.data?.fileName,\n//       hasBinary: !!item.binary?.data,\n//       base64Exists: !!item.binary?.data?.data\n//     }\n//   };\n// });\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-220,740],"id":"79fe0212-d883-4254-8b82-5d9739baf856","name":"Code6"},{"parameters":{"jsCode":"// return items.map(item => {\n//   const base64 = item.binary?.data?.data;\n\n//   if (!base64) {\n//     return {\n//       json: {\n//         error: 'Base64 데이터가 없음'\n//       }\n//     };\n//   }\n\n//   return {\n//     json: {\n//       fileName: item.binary.data.fileName || 'download.pdf',\n//       base64: base64,\n//       dataUri: `data:application/pdf;base64,${base64}`\n//     }\n//   };\n// });\n\n\n\nreturn items.map(item => {\n  if (!item.binary?.data?.data) {\n    throw new Error(\"PDF binary 데이터가 존재하지 않습니다.\");\n  }\n\n  const base64 = item.binary.data.data.trim(); // 혹시 모를 공백 제거\n  const fileName = item.binary.data.fileName || \"download.pdf\";\n\n  return {\n    json: {\n      fileName,\n      base64,\n      dataUri: `data:application/pdf;base64,${base64}`\n    }\n  };\n});\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[0,740],"id":"f93645b3-a047-46ba-a483-c97db15eeb3e","name":"Code7"},{"parameters":{"jsCode":"return items.map(item => {\n  const base64 = item.json.base64;\n  const fileName = item.json.fileName || 'output.pdf';\n\n  if (!base64) {\n    throw new Error('base64 데이터가 존재하지 않습니다.');\n  }\n\n  return {\n    json: {\n      message: 'PDF Binary 생성 완료',\n    },\n    binary: {\n      data: {\n        data: base64,\n        mimeType: 'application/pdf',\n        fileName: fileName,\n      }\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[220,740],"id":"0d4a8266-59b1-42b0-ab49-53b3af5ef7b2","name":"Code8"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage={{$json.page}}","options":{"response":{"response":{"responseFormat":"text"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2440,7700],"id":"2b375620-d434-4146-aa37-14c27ea7cda8","name":"HTTP Request6"},{"parameters":{"jsCode":"const output = [];\nfor (let i = 1; i <= 1; i++) {\n  output.push({ json: { page: i } });\n}\nreturn output;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2620,7700],"id":"da6072cc-7ce3-4841-96ad-cdea795f1db1","name":"Generate Pages1"},{"parameters":{"jsCode":"const html = $json.body || $json.data || '';\n\nconst regex = /href=\"(\\/user\\/bbs\\/BD_selectBbs\\.do[^\"]+)[^>]*?\">\\s*([\\s\\S]*?)<\\/a>/g;\nconst matches = html.matchAll(regex);\n\nconst results = [];\nfor (const match of matches) {\n  const rawUrl = match[1];\n  const rawTitle = match[2];\n\n  // HTML 엔티티 디코딩 (예: &amp; -> &)\n  const decodedUrl = rawUrl.replace(/&amp;/g, '&');\n\n  // 태그 제거 + 공백 정리\n  const cleanTitle = rawTitle.replace(/<[^>]+>/g, '').replace(/\\s+/g, ' ').trim();\n\n  results.push({\n    url: \"https://www.kicox.or.kr\" + decodedUrl,\n    title: cleanTitle,\n  });\n}\n\nreturn results.map(r => ({ json: r }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2260,7700],"id":"585ad75b-d19a-4e4e-ba9a-3cd6de28c82a","name":"Parse Post Links1","alwaysOutputData":false},{"parameters":{"url":"={{$json.url}}","options":{"response":{"response":{"responseFormat":"text"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2080,7700],"id":"2f97c258-c027-44b2-8fc1-dca3379547e0","name":"HTTP Request(Post Detail)1"},{"parameters":{"jsCode":"const results = [];\nconst fileRe = /href=\"(\\/component\\/file\\/ND_fileDownload\\.do\\?[^\"]+)\"[^>]*>([^<]+)<\\/a>/gi;\n\nfor (const item of items) {\n  const html = item.json.body || item.json.data || '';\n  for (const m of html.matchAll(fileRe)) {\n    const dl = 'https://www.kicox.or.kr' + m[1].replace(/&amp;/g,'&');\n    results.push({json:{\n      sourceUrl: item.json.url,\n      fileName : m[2].trim(),\n      downloadUrl: decodeURIComponent(dl)\n    }});\n  }\n}\nreturn results;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1880,7700],"id":"77ea4e50-2ce4-463c-9409-e255d7ae9386","name":"get downladUrl1"},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1380,7700],"id":"14f7c6d0-3a21-4597-abb2-27cff8850673","name":"HTTP Request7","executeOnce":false},{"parameters":{"jsCode":"// return items.map(item => {\n//   console.log(item.json.downloadUrl);  // 로그 출력 (선택사항)\n//   return {\n//     json: item.json\n//   };\n// });\n\n\n// console.log($json.downloadUrl);\n//const secondItem = items[1]; // 두 번째 (index 1)\n\nconst secondItem = items[3]; // 두 번째 (index 1)\n\nreturn [{\n  json: secondItem.json\n}];\n\n\n// return items.map(item => {\n//   return {\n//     json: item.json\n//   };\n// });\n\n\n// return items\n//   .filter(item => !!item.json.downloadUrl) // 다운로드 링크가 있는 것만\n//   .map(item => {\n//     return {\n//       json: item.json\n//     };\n//   });\n// \n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1540,7700],"id":"f2f73402-8b4b-4780-ab00-9f3460a63c34","name":"Code9"},{"parameters":{"jsCode":"return items.map(item => {\n  const raw = item.json.downloadUrl || '';\n  const cleaned = raw\n    .toString()\n    .replace(/[\\n\\r\\t\\s]+/g, '')         // 공백 및 줄바꿈 제거\n    .replace(/&amp;/g, '&')              // HTML 인코딩 된 & 해제\n    .trim();\n  return {\n    json: {\n      ...item.json,\n      downloadUrl: decodeURI(cleaned)\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1700,7700],"id":"7f19b7fb-4684-4d2f-89fb-141a26705935","name":"Code10"},{"parameters":{"jsCode":"return items.map(item => {\n  item.binary.data.fileName = item.json.fileName || 'downloaded.pdf';\n  return item;\n});\n// return items.map(item => {\n//   return {\n//     json: {\n//       fileName: item.binary?.data?.fileName,\n//       hasBinary: !!item.binary?.data,\n//       base64Exists: !!item.binary?.data?.data\n//     }\n//   };\n// });\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-260,900],"id":"d7d30df7-6e40-437c-bd20-47181bae00ec","name":"Code11"},{"parameters":{"jsCode":"// return items.map(item => {\n//   const base64 = item.binary?.data?.data;\n\n//   if (!base64) {\n//     return {\n//       json: {\n//         error: 'Base64 데이터가 없음'\n//       }\n//     };\n//   }\n\n//   return {\n//     json: {\n//       fileName: item.binary.data.fileName || 'download.pdf',\n//       base64: base64,\n//       dataUri: `data:application/pdf;base64,${base64}`\n//     }\n//   };\n// });\n\n\n\n// return items.map(item => {\n//   if (!item.binary?.data?.data) {\n//     throw new Error(\"PDF binary 데이터가 존재하지 않습니다.\");\n//   }\n\n//   const base64 = item.binary.data.data.trim(); // 혹시 모를 공백 제거\n//   const fileName = item.binary.data.fileName || \"download.pdf\";\n\n//   return {\n//     json: {\n//       fileName,\n//       base64,\n//       dataUri: `data:application/pdf;base64,${base64}`\n//     }\n//   };\n// });\n\nreturn items.map(item => {\n  if (!item.binary?.data?.data) {\n    throw new Error(\"PDF binary 데이터가 존재하지 않습니다.\");\n  }\n\n  const base64 = item.binary.data.data.trim(); // 공백 제거\n  const fileName = item.binary.data.fileName || \"upload.pdf\";\n\n  return {\n    json: {\n      fileName\n    },\n    binary: {\n      data: {\n        ...item.binary.data,\n        fileName: fileName\n      }\n    }\n  };\n});\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-80,900],"id":"7d86895b-9a4c-40d6-8885-5b949fde47f6","name":"Code12"},{"parameters":{"jsCode":"return items.map(item => {\n  const base64 = item.json.base64;\n  const fileName = item.json.fileName || 'output.pdf';\n\n  if (!base64) {\n    throw new Error('base64 데이터가 존재하지 않습니다.');\n  }\n\n  return {\n    json: {\n      message: 'PDF Binary 생성 완료',\n    },\n    binary: {\n      data: {\n        data: base64,\n        mimeType: 'application/pdf',\n        fileName: fileName,\n      }\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[180,940],"id":"cb3a8398-872c-475a-a08b-0ea4cb5f4c6e","name":"Code13"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"id":"b98443c8-5a58-492b-8a44-0fa6693e9ee1","name":"Mistral Upload","type":"n8n-nodes-base.httpRequest","position":[-280,2520],"typeVersion":4.2},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/json"}]},"options":{}},"id":"6ee197e5-743b-4fdc-abfb-5a003526bb3f","name":"Mistral Signed URL","type":"n8n-nodes-base.httpRequest","position":[-80,2520],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"mode":"id","value":"15BcE6nXto9lQDHPmwjm7y9JPerAVEutY"},"options":{}},"id":"252ac521-80f2-4454-aa2d-06ba058aaefd","name":"Import PDF","type":"n8n-nodes-base.googleDrive","position":[-500,2520],"typeVersion":3},{"parameters":{"operation":"download","fileId":{"__rl":true,"mode":"id","value":"1a2FcRDWHHncMO8CYxD80uNUBGH1Sy1k2"},"options":{}},"id":"f5170a81-5a2e-4f10-823f-aef9019028b8","name":"Import Image","type":"n8n-nodes-base.googleDrive","position":[-500,2740],"typeVersion":3},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"id":"af7b1a57-3a4b-4f7e-9048-6301dc24d054","name":"Mistral Upload1","type":"n8n-nodes-base.httpRequest","position":[-280,2740],"typeVersion":4.2},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/json"}]},"options":{}},"id":"370d7763-ee2f-4da2-b31a-2cf0f134c480","name":"Mistral Signed URL1","type":"n8n-nodes-base.httpRequest","position":[-80,2740],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{}},"id":"a7d6089d-7aea-401d-b872-2ecaab2a42e6","name":"Mistral DOC OCR","type":"n8n-nodes-base.httpRequest","position":[120,2520],"typeVersion":4.2},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"{{ $json.url }}\"\n  }\n}","options":{}},"id":"455f0490-5f54-454d-ae9e-772ea57b1ce2","name":"Mistral IMAGE OCR","type":"n8n-nodes-base.httpRequest","position":[120,2740],"typeVersion":4.2},{"parameters":{"assignments":{"assignments":[{"id":"1eb5f18b-eb06-48df-8491-d60de75b4855","name":"url","type":"string","value":"=https://www.seoultp.or.kr/user/nd19746.do?View&pageLS=10&pageST=SUBJECT&pageSV=&page=1&pageSC=SORT_ORDER&pageSO=DESC&dmlType=&boardNo=00003849&menuCode=www#attachdown"}]},"options":{}},"id":"30ea678f-82fa-4b86-9d2f-87aa6c0a8b9a","name":"Document URL","type":"n8n-nodes-base.set","position":[-1160,2520],"typeVersion":3.4},{"parameters":{"assignments":{"assignments":[{"id":"1eb5f18b-eb06-48df-8491-d60de75b4855","name":"url","type":"string","value":"=https://pub-d4aa9be14ae34d6ebcebe06f13af667b.r2.dev/multimodal_bank_statement_2.png"}]},"options":{}},"id":"a31c2cbd-a97c-4262-967c-d167f0fe6164","name":"Image URL","type":"n8n-nodes-base.set","position":[-1160,2740],"typeVersion":3.4},{"parameters":{"content":"### Example 1. Publicly Hosted Files\nThe default way to use Mistral OCR is to give it a public URL of the file you want processed. Great for your own semi-private docs or other people's. If you rather not expose files due to privacy concerns, then you'd want to check out example 2.","height":580,"width":680,"color":7},"id":"d49fdaec-d675-433e-af9a-956170fba25d","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-1300,2380],"typeVersion":1},{"parameters":{"content":"### Example 2. Privately Hosted via Mistral Cloud\nGive Mistral OCR private and secure access to your files by uploading them to Mistral cloud first. Retrieve the file using a signed URL and pass this to Mistral OCR. Benefit of storing via Mistral could be faster cache access and reduced latency for repeat docs.","height":560,"width":920,"color":7},"id":"d32ea100-4927-4be7-83e3-5a19a5b4a5d9","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-580,2380],"typeVersion":1},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"{{ $json.url }}\"\n  }\n}","options":{}},"id":"9daa16c4-ef19-4909-9e8b-31bc18145a98","name":"Mistral IMAGE OCR1","type":"n8n-nodes-base.httpRequest","position":[-920,2740],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"content":"## Document Parsing with Mistral OCR\nUp your structured document parsing game with Mistral's latest release... **Mistral-OCR**!\n* Designed to specifically parse PDF and image files.\n* Handles multiple-page documents and images up to 10k pixels.\n* Each page is conveniently transcribed as markdown only - there is no plain text output.\n* Incredible pricing at only $0.001 per page!\n\n### Requirements\n* You'll need a Mistral Cloud API Key\n* This template only works with the Mistral Cloud API for Mistral OCR.","height":640,"width":380},"id":"13a6c4a3-56cd-4223-bdac-ff5b907c3e1c","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[-1740,2100],"typeVersion":1},{"parameters":{"content":"### Example 3. No need for Extraction? Talk Directly with the File!\nIt seems Mistral were also able to integrate OCR capabilities into its text models which allows you to carry out tasks such as document classification and sentiment analysis really quickly. Unfortunately, it doesn't work the same way with images - you have to use Pixtral but the results are really bad!","height":580,"width":680,"color":7},"id":"189d7a7d-35f8-4751-8b9d-ff849a224d26","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[380,2380],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"1eb5f18b-eb06-48df-8491-d60de75b4855","name":"url","type":"string","value":"=https://pub-d4aa9be14ae34d6ebcebe06f13af667b.r2.dev/multimodal_bank_statement_scan.pdf"},{"id":"c639fce3-6967-444d-be18-6c9ce802ef22","name":"query","type":"string","value":"what is the total number of deposits?"}]},"options":{}},"id":"13855bb7-116a-4b08-b117-88e30323e836","name":"Document URL1","type":"n8n-nodes-base.set","position":[540,2520],"typeVersion":3.4},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/chat/completions","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-small-latest\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.query }}\"\n        },\n        {\n          \"type\": \"document_url\",\n          \"document_url\": \"{{ $json.url }}\"\n        }\n      ]\n    }\n  ],\n  \"document_image_limit\": 8,\n  \"document_page_limit\": 64\n}","options":{}},"id":"bf122dc2-e624-4320-9152-f5b8ecb10629","name":"Document Understanding","type":"n8n-nodes-base.httpRequest","position":[760,2520],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"assignments":{"assignments":[{"id":"1eb5f18b-eb06-48df-8491-d60de75b4855","name":"url","type":"string","value":"=https://pub-d4aa9be14ae34d6ebcebe06f13af667b.r2.dev/multimodal_bank_statement_2.png"},{"id":"639cd062-ebef-44ab-97a2-79ee388f8b41","name":"query","type":"string","value":"what is the total number of deposits?"}]},"options":{}},"id":"add82346-a683-4810-9ff0-f20653f8f007","name":"Image URL1","type":"n8n-nodes-base.set","position":[540,2740],"typeVersion":3.4},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/chat/completions","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"pixtral-large-latest\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.query }}\"\n        },\n        {\n          \"type\": \"image_url\",\n          \"image_url\": \"{{ $json.url }}\"\n        }\n      ]\n    }\n  ],\n  \"document_image_limit\": 8,\n  \"document_page_limit\": 64\n}","options":{}},"id":"cdafb4dd-75fb-4991-850b-660b3cc7b27a","name":"Document Mis-Understanding?","type":"n8n-nodes-base.httpRequest","position":[760,2740],"typeVersion":4.2},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"{{ $json.url }}\"\n  }\n}","options":{}},"id":"d7eac9ca-a63c-47ed-967d-86f7291393d5","name":"Mistral IMAGE OCR2","type":"n8n-nodes-base.httpRequest","position":[-940,2520],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"operation":"write","fileName":"/home/node/.cache/scrapper/abc.pdf","options":{}},"type":"n8n-nodes-base.readWriteFile","typeVersion":1,"position":[-660,1780],"id":"09796e77-ec0c-4ed3-9d3d-293f876c957b","name":"Read/Write Files from Disk"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"90854a17-11d2-4e85-ac92-fc24cfd91117","name":"Upload a file","type":"n8n-nodes-base.httpRequest","position":[-760,2180],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","options":{"allowUnauthorizedCerts":false}},"id":"35f5e3e8-c148-42ec-9335-302ee3be09e9","name":"Retrieve file","type":"n8n-nodes-base.httpRequest","position":[-540,2180],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"options":{"allowUnauthorizedCerts":false}},"id":"5d20f5af-a308-46fa-a118-e401f90c8fb0","name":"Retrieve file1","type":"n8n-nodes-base.httpRequest","position":[-340,2180],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"73411b05-fbeb-47d6-aaa8-615d93749000","name":"do ocr","type":"n8n-nodes-base.httpRequest","position":[-160,2180],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"ugGFyfTTnUR6Slhs","name":"Mistral Cloud account"}}},{"parameters":{"url":"https://www.seoultp.or.kr/common/attachfile/attachfileDownload.do?attachNo=00006302","options":{"response":{"response":{"fullResponse":true,"neverError":true}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1020,2160],"id":"597e757b-37df-4721-95d4-ed968c2a57c3","name":"HTTP Request8","alwaysOutputData":true},{"parameters":{"command":"mkdir -p  /home/node/.cache/scrapper/"},"name":"Create Directory1","type":"n8n-nodes-base.executeCommand","position":[-1200,2160],"typeVersion":1,"id":"3b9e89e9-a630-4d2f-99e8-ddd4f385ab51","continueOnFail":true},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"309ad933-b6cd-4353-890a-3d9dec00f1f7","name":"Upload a file1","type":"n8n-nodes-base.httpRequest","position":[-1240,7700],"typeVersion":4.2},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer aJUugk77GjvB8L7smr5n11JlKLab1xE5 "},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"\"\n  },\n  \"include_image_base64\": false\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[420,920],"id":"91143bbf-976f-42ca-8a7f-af0d6fab5d93","name":"HTTP Request9"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1080,7700],"id":"3c6b21ae-d4dc-4316-b67c-68a16ed46ba1","name":"HTTP Request10"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"15577e1b-471c-4f2c-a566-11ea679f62a4","name":"do ocr1","type":"n8n-nodes-base.httpRequest","position":[-940,7700],"typeVersion":4.2},{"parameters":{"operation":"classify","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-720,7700],"id":"a08399f4-1aec-445b-9026-0b2da5740fd3","name":"OpenAI"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage=1","responseFormat":"string","options":{}},"name":"Get List HTML","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-2180,4740],"id":"8c6568e3-869e-4b5f-8db9-3b1756c541af"},{"parameters":{"options":{}},"name":"Extract Links","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-1980,4740],"id":"b74ab3a5-3abb-4642-b05a-d244c686d16f"},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'https://www.kicox.or.kr' + $json.href }}"}]},"options":{}},"name":"Set Full URL","type":"n8n-nodes-base.set","typeVersion":1,"position":[-1780,4740],"id":"32c96572-9dc2-4191-bb9e-5ecccbbc7984"},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"name":"Get Detail HTML","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-1380,4740],"id":"ab9e72c2-5baa-4dd7-bf1a-d81219650f1b"},{"parameters":{"options":{}},"name":"Extract Content","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-1180,4740],"id":"59b65d50-c93a-4fed-924c-b29499323ca7"},{"parameters":{"functionCode":"return [{\n  json: {\n    title: $json.title,\n    date: $json.date,\n    content: $json.content\n  }\n}];"},"name":"Format JSON","type":"n8n-nodes-base.function","typeVersion":1,"position":[-980,4740],"id":"f81fdce0-39cb-4287-b762-df94d74ab93e"},{"parameters":{"additionalFields":{}},"name":"Insert to DB","type":"n8n-nodes-base.postgres","typeVersion":1,"position":[-700,4740],"id":"a0a9c10a-328e-4c1a-b0c9-162e2f755257"},{"parameters":{"batchSize":1,"options":{}},"name":"SplitInBatches1","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-1580,4740],"id":"6a7848d4-ca19-4a60-8718-fa5cf4640840"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage=1","responseFormat":"string","options":{}},"name":"Get List HTML1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-2180,4920],"id":"6812c6df-4241-4a1b-a2d7-0b103453a5b1"},{"parameters":{"extractionValues":{"values":[{"key":"href","cssSelector":"td.subject > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"name":"Extract Links1","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-2000,4920],"id":"5f6ab5c1-ca7d-4bdc-879c-5fb6a51a5cb7"},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'https://www.kicox.or.kr' + $json.href }}"}]},"options":{}},"name":"Set Full URL1","type":"n8n-nodes-base.set","typeVersion":1,"position":[-1820,4920],"id":"159bdd75-9983-4998-a60d-eab2c3abb1a8"},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"name":"Get Detail HTML1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-1440,4920],"id":"73f5459e-711e-4353-bc70-59f4df98a61f"},{"parameters":{"options":{}},"name":"Extract Content1","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-1200,4920],"id":"ba6f77da-850c-4954-b08b-9f7a47f18979"},{"parameters":{"functionCode":"return [{\n  json: {\n    title: $json.title,\n    date: $json.date,\n    content: $json.content\n  }\n}];"},"name":"Format JSON1","type":"n8n-nodes-base.function","typeVersion":1,"position":[-960,4920],"id":"dc4e6e12-5e0d-4aca-9b8b-dc582061d715"},{"parameters":{"batchSize":1,"options":{}},"name":"SplitInBatches2","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-1620,4920],"id":"57195966-0293-4c37-8415-8ca14e6cab67"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage=1","responseFormat":"string","options":{}},"id":"c83dabfd-5935-4169-966c-c86b1fe513af","name":"Get List HTML2","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-2460,8120]},{"parameters":{"extractionValues":{"values":[{"key":"href","cssSelector":"td.subject > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"c57c7278-36ed-4b40-96ed-2eba39432697","name":"Extract Links2","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-2280,8120]},{"parameters":{"options":{}},"id":"dd55c2a9-7c18-4c52-b8c6-51cf081bd016","name":"SplitInBatches3","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-1940,8120]},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'https://www.kicox.or.kr' + $json.href }}"}]},"options":{}},"id":"453ccb19-d4eb-467d-8b56-33b61d506e43","name":"Set Full URL2","type":"n8n-nodes-base.set","typeVersion":1,"position":[-1740,8120]},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"id":"15886251-d863-4629-8715-4f21a266bca3","name":"Get Detail HTML2","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-1540,8120]},{"parameters":{"extractionValues":{"values":[{"key":"pblanc_nm","cssSelector":"div.detail-area div.title"},{"key":"reqst_begin_end_de","cssSelector":"div.util span.date"},{"key":"bsns_sumry_cn","cssSelector":"div.txt","returnValue":"html"},{"key":"flpth_nm","cssSelector":"span.file-download-list a\t","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"81c3e84c-3008-490d-a443-c9967ea14705","name":"Extract Content2","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-1380,8120]},{"parameters":{"functionCode":"return [{ json: { title: $json.title, date: $json.date, content: $json.content } }];"},"id":"859f8e84-ebd1-4e5a-99ee-1654dcf8b6d6","name":"Format JSON2","type":"n8n-nodes-base.function","typeVersion":1,"position":[560,8200]},{"parameters":{"jsCode":"return $json.href.map(link => {\n  return {\n    json: {\n      href: link\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2120,8120],"id":"70f3afa5-9faa-45c3-861d-0032fb974102","name":"split"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[-160,7840],"id":"c83de19b-f9b2-479d-a3fa-c3e04f21e88e","name":"MySQL","credentials":{"mySql":{"id":"HSXhV0YEF0PlSVWX","name":"MySQL account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"return {\n  json: {\n    ...$json,\n    flpth_nm: Array.isArray($json.flpth_nm)\n      ? $json.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n      : \"https://www.kicox.or.kr\" + $json.flpth_nm,\n    print_flpth_nm: Array.isArray($json.flpth_nm)\n      ? \"https://www.kicox.or.kr\" + $json.flpth_nm[0]\n          : \"https://www.kicox.or.kr\" + $json.flpth_nm,\n    exc_instt_nm: \"test\",\n    del_yn: \"N\",\n    creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-360,7840],"id":"d160ae88-5dcd-44d1-9947-1498b5e53785","name":"Code14"},{"parameters":{"batchSize":10,"options":{}},"id":"36876093-6552-44f9-8bea-a5b0991714a5","name":"SplitInBatches4","type":"n8n-nodes-base.splitInBatches","position":[560,8360],"typeVersion":3},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"f342eb7d-f257-4cd9-9627-8dfc622eb905","name":"Upload a file2","type":"n8n-nodes-base.httpRequest","position":[-1040,8340],"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-700,8420],"id":"31903371-7926-4476-87ed-45243a4df88e","name":"HTTP Request11"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"2492e241-1501-4b51-98d5-69a7827d97f3","name":"do ocr2","type":"n8n-nodes-base.httpRequest","position":[-540,8420],"typeVersion":4.2},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}},"timeout":60000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1560,8480],"id":"7de918b1-d440-47c2-a3f1-7f8f8e3a74e1","name":"download files","executeOnce":false},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// // Run Once for Each Item 모드에 맞춘 Code\nconst urls = Array.isArray($json.flpth_nm)\n  ? $json.flpth_nm\n  : String($json.flpth_nm).split('@');\n\n// 지금 처리 중인 파일 인덱스가 있는 경우만 하나 추출\nconst index = $json.fileIndex || 0;\nconst url = urls[index];\n\n// 없으면 아무것도 하지 않음\nif (!url) {\n  return {};\n}\n\n// 반환은 단일 객체만\nreturn {\n  json: {\n    ...$json,\n    downloadUrl: \"https://www.kicox.or.kr\" + url.trim(),\n    fileIndex: index\n  }\n};\n\n\n//run once for all items에 맞춘 코드 ->에러남\n// const filePaths = Array.isArray($json.flpth_nm)\n//   ? $json.flpth_nm\n//   : String($json.flpth_nm).split('@');\n\n// return filePaths.map((path, idx) => ({\n//   json: {\n//     ...$json,\n//     downloadUrl: \"https://www.kicox.or.kr\" + path.trim(),\n//     fileIndex: idx,\n//     originalFilePath: path\n//   }\n// }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2460,8460],"id":"4f90586d-c217-4db3-ba1d-04fc07423e22","name":"Code15"},{"parameters":{"jsCode":"const ocrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\n\nreturn {\n  json: {\n    chatInput: `다음은 공고의 첨부파일에서 OCR로 추출한 텍스트입니다. 이 텍스트를 읽고 다음 정보를 요약해 주세요.\n  반환형식을 꼭 지켜!\n\n다음은 정부지원사업 공고의 OCR 텍스트입니다.  \n이 텍스트를 기반으로 아래 JSON 구조에 맞게 항목을 채워 주세요.\n\n각 key는 반드시 그대로 유지하고, 값이 없을 경우 null 또는 기본값을 사용해 주세요.  \n(주석은 설명 용도로만 표시한 것입니다. 응답에서는 제거하고 순수 JSON으로 반환해주세요.)\n\njson\n{\n  \"biz_info_id\": null,                            // (자동 생성. 입력하지 않아도 됨)\n  \"pblanc_nm\": null,                              // 공고 제목\n  \"pblanc_url\": null,                             // 공고 상세 URL\n  \"pblanc_id\": null,                              // 공고 ID\n  \"jrsd_instt_nm\": null,                          // 주관/지원 기관명 (예: 전북특별자치도)\n  \"exc_instt_nm\": null,                           // 수행기관 (예: 직접수행, 외부수행 등)\n  \"bsns_sumry_cn\": null,                          // 공고 요약 (HTML 혹은 일반 텍스트)\n  \"print_flpth_nm\": null,                         // 메인 PDF 링크\n  \"print_file_nm\": null,                          // 메인 PDF 파일명\n  \"flpth_nm\": null,                               // 첨부파일 경로들 (@ 구분)\n  \"file_nm\": null,                                // 첨부파일명 (zip 등)\n\n  \"pldir_sport_realm_lclas_code_nm\": null,        // 대분류 분야명 (예: 기술, 경영 등)\n  \"rcept_engn_hmpg_url\": null,                    // 신청처 홈페이지\n  \"trget_nm\": null,                               // 대상기업 (예: 중소기업, 중견기업 등)\n\n  \"reqst_begin_end_de\": null,                     // 공고 전체 기간 (예: 20240801 ~ 20240930)\n  \"reqst_begin_dt\": null,                         // 시작일 (예: 2024-08-01)\n  \"reqst_end_dt\": null,                           // 마감일 (예: 2024-09-30)\n  \"reqst_mth_papers_cn\": null,                    // 신청 방법 (예: 온라인 접수 등)\n  \"pldir_sport_realm_mlsfc_code_nm\": null,        // 중분류 분야명\n  \"refrnc_nm\": null,                              // 문의처 (예: 전화번호 포함 문장)\n  \"inqire_co\": 0,                                 // 문의 수 (없으면 0)\n\n  \"creat_p_nttm\": null,                           // 공고 등록 일시\n  \"created_ts\": null,                             // 시스템에 등록된 시간\n  \"hash_tags\": null,                              // 키워드 (쉼표 구분)\n  \"del_yn\": \"N\",                                   // 삭제 여부 (기본값 N)\n  \"hide_yn\": \"Y\",                                  // 숨김 여부 (기본값 Y)\n  \"views\": 0,                                     // 조회수 (기본값 0)\n\n  \"is_classified\": \"N\",                           // 분류 여부 (N: 미분류)\n  \"source\": \"기업마당\",                            // 출처 (예: 기업마당)\n  \"main_category\": null,\n  \"sub_category\": null,\n  \"classified_date\": null,\n  \"classified_by\": null,\n\n  \"subsidy_amount\": null,                         // 정부 지원금 (예: \"140억 원\")\n  \"self_contribution_rate\": null,                 // 자부담 비율 (예: \"40% 이상\")\n  \"support_target\": null,                         // 지원 대상 설명\n  \"bonus_points_factors\": null,                   // 가점 요소\n  \"total_budget\": null,                           // 총사업비 (예: \"200억 원\")\n  \"applicant_count\": 0,                           // 모집/선정 수 (없으면 0)\n  \"subsidy_amount_type\": null,                    // 지원금 단위 (예: 연차별, 총액)\n  \"total_budget_type\": null,                      // 총사업비 단위\n  \"equipment_detail_file_path\": null,             // 장비 세부파일 경로\n  \"equipment_detail_file_name\": null              // 장비 세부파일 이름\n}\n\n\n[텍스트 시작]\n${ocrText}\n[텍스트 끝]`\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-320,8420],"id":"1c160c7b-01d1-4ca3-ba13-f606fcd53372","name":"Code16"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-280,8840],"id":"227519e7-6a83-40e5-9c19-0a19455d1c2b","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[440,7980],"id":"c687b737-34c8-4060-ade2-6c97e21f85a6","name":"AI Agent1"},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-280,8620],"id":"8e921348-261a-4f6e-be79-25c80bbaabfa","name":"Basic LLM Chain"},{"parameters":{"jsCode":"// Gemini 또는 LLM 응답의 텍스트 내용만 추출\nconst geminiText = $json.text; // or $item(0).json.text\n\n// Markdown 코드 블록에서 JSON 추출: ```json\\n{...}\\n```\nconst jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n\nif (!jsonMatch) {\n  throw new Error(\"JSON block not found in Gemini output.\");\n}\n\nlet parsed;\ntry {\n  parsed = JSON.parse(jsonMatch[1]);\n} catch (err) {\n  throw new Error(\"Failed to parse JSON: \" + err.message);\n}\n\n// 후처리 + 경로 가공\nreturn {\n  json: {\n    ...$json,\n    ...parsed,\n\n    flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    print_flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    exc_instt_nm: parsed.exc_instt_nm || \"test\",\n    del_yn: \"N\",\n    creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[140,8640],"id":"1fc3029c-884f-4aee-9825-9f4b0e2eca77","name":"Code17"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[340,8640],"id":"d98997aa-565e-4df4-b694-9cf3ecfea6ef","name":"MySQL1","credentials":{"mySql":{"id":"HSXhV0YEF0PlSVWX","name":"MySQL account"}}},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"3d713af0-e66a-4da6-9cce-4e82c8455f07","name":"Upload a file3","type":"n8n-nodes-base.httpRequest","position":[-6120,12940],"typeVersion":4.2},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5980,12940],"id":"fbdffb1b-9d3b-4c1b-a5b8-214c535098e7","name":"HTTP Request12"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"4e1a399b-794e-4781-8293-c5e4553753a4","name":"do ocr3","type":"n8n-nodes-base.httpRequest","position":[-5820,12940],"typeVersion":4.2},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-6280,12940],"id":"5ab7a2d7-76de-433f-93da-00e9bddd5caa","name":"download files1","executeOnce":false},{"parameters":{"jsCode":"const ocrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\n\nreturn {\n  json: {\n    chatInput: `다음은 공고의 첨부파일에서 OCR로 추출한 텍스트입니다. 이 텍스트를 읽고 다음 정보를 요약해 주세요.\n  반환형식을 꼭 지켜!\n\n다음은 정부지원사업 공고의 OCR 텍스트입니다.  \n이 텍스트를 기반으로 아래 JSON 구조에 맞게 항목을 채워 주세요.\n\n각 key는 반드시 그대로 유지하고, 값이 없을 경우 null 또는 기본값을 사용해 주세요.  \n(주석은 설명 용도로만 표시한 것입니다. 응답에서는 제거하고 순수 JSON으로 반환해주세요.)\n\njson\n{\n  \"biz_info_id\": null,                            // (자동 생성. 입력하지 않아도 됨)\n  \"pblanc_nm\": null,                              // 공고 제목\n  \"pblanc_url\": null,                             // 공고 상세 URL\n  \"pblanc_id\": null,                              // 공고 ID\n  \"jrsd_instt_nm\": null,                          // 주관/지원 기관명 (예: 전북특별자치도)\n  \"exc_instt_nm\": null,                           // 수행기관 (예: 직접수행, 외부수행 등)\n  \"bsns_sumry_cn\": null,                          // 공고 요약 (HTML 혹은 일반 텍스트)\n  \"print_flpth_nm\": null,                         // 메인 PDF 링크\n  \"print_file_nm\": null,                          // 메인 PDF 파일명\n  \"flpth_nm\": null,                               // 첨부파일 경로들 (@ 구분)\n  \"file_nm\": null,                                // 첨부파일명 (zip 등)\n\n  \"pldir_sport_realm_lclas_code_nm\": null,        // 대분류 분야명 (예: 기술, 경영 등)\n  \"rcept_engn_hmpg_url\": null,                    // 신청처 홈페이지\n  \"trget_nm\": null,                               // 대상기업 (예: 중소기업, 중견기업 등)\n\n  \"reqst_begin_end_de\": null,                     // 공고 전체 기간 (예: 20240801 ~ 20240930)\n  \"reqst_begin_dt\": null,                         // 시작일 (예: 2024-08-01)\n  \"reqst_end_dt\": null,                           // 마감일 (예: 2024-09-30)\n  \"reqst_mth_papers_cn\": null,                    // 신청 방법 (예: 온라인 접수 등)\n  \"pldir_sport_realm_mlsfc_code_nm\": null,        // 중분류 분야명\n  \"refrnc_nm\": null,                              // 문의처 (예: 전화번호 포함 문장)\n  \"inqire_co\": 0,                                 // 문의 수 (없으면 0)\n\n  \"creat_p_nttm\": null,                           // 공고 등록 일시\n  \"created_ts\": null,                             // 시스템에 등록된 시간\n  \"hash_tags\": null,                              // 키워드 (쉼표 구분)\n  \"del_yn\": \"N\",                                   // 삭제 여부 (기본값 N)\n  \"hide_yn\": \"Y\",                                  // 숨김 여부 (기본값 Y)\n  \"views\": 0,                                     // 조회수 (기본값 0)\n\n  \"is_classified\": \"N\",                           // 분류 여부 (N: 미분류)\n  \"source\": \"기업마당\",                            // 출처 (예: 기업마당)\n  \"main_category\": null,\n  \"sub_category\": null,\n  \"classified_date\": null,\n  \"classified_by\": null,\n\n  \"subsidy_amount\": null,                         // 정부 지원금 (예: \"140억 원\")\n  \"self_contribution_rate\": null,                 // 자부담 비율 (예: \"40% 이상\")\n  \"support_target\": null,                         // 지원 대상 설명\n  \"bonus_points_factors\": null,                   // 가점 요소\n  \"total_budget\": null,                           // 총사업비 (예: \"200억 원\")\n  \"applicant_count\": 0,                           // 모집/선정 수 (없으면 0)\n  \"subsidy_amount_type\": null,                    // 지원금 단위 (예: 연차별, 총액)\n  \"total_budget_type\": null,                      // 총사업비 단위\n  \"equipment_detail_file_path\": null,             // 장비 세부파일 경로\n  \"equipment_detail_file_name\": null              // 장비 세부파일 이름\n}\n\n\n[텍스트 시작]\n${ocrText}\n[텍스트 끝]`\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5600,12940],"id":"caf1b61b-daa3-4481-a1d3-1bca3c159ea3","name":"Code18"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-5220,12940],"id":"91e323bf-28cc-4575-98ce-94c932774fcf","name":"Google Gemini Chat Model2","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-5220,12720],"id":"4977aad7-7ef2-4766-963c-8fefb7109c65","name":"Basic LLM Chain1"},{"parameters":{"jsCode":"// Gemini 또는 LLM 응답의 텍스트 내용만 추출\nconst geminiText = $json.text; // or $item(0).json.text\n\n// Markdown 코드 블록에서 JSON 추출: ```json\\n{...}\\n```\nconst jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n\nif (!jsonMatch) {\n  throw new Error(\"JSON block not found in Gemini output.\");\n}\n\nlet parsed;\ntry {\n  parsed = JSON.parse(jsonMatch[1]);\n} catch (err) {\n  throw new Error(\"Failed to parse JSON: \" + err.message);\n}\n\n// 후처리 + 경로 가공\nreturn {\n  json: {\n    ...$json,\n    ...parsed,\n\n    flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    print_flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    exc_instt_nm: parsed.exc_instt_nm || \"test\",\n    del_yn: \"N\",\n    creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4800,12740],"id":"0cb0d163-43d9-44d8-92f9-48411e9a30e0","name":"Code19"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[-4600,12740],"id":"dfb7b0f1-a279-4aee-a567-4a3c3c56d93a","name":"MySQL2","credentials":{"mySql":{"id":"HSXhV0YEF0PlSVWX","name":"MySQL account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// const filePaths = Array.isArray($json.flpth_nm)\n//   ? $json.flpth_nm\n//   : String($json.flpth_nm).split('@');\n\n// return filePaths.map((path, idx) => {\n//   return {\n//     json: {\n//       ...$json,\n//       downloadUrl: \"https://www.kicox.or.kr\" + path.trim(),\n//       fileIndex: idx,\n//       originalFilePath: path\n//     }\n//   };\n// });\n//\n\n// Run Once for Each Item 모드에 맞춘 Code\nconst urls = Array.isArray($json.flpth_nm)\n  ? $json.flpth_nm\n  : String($json.flpth_nm).split('@');\n\n// 지금 처리 중인 파일 인덱스가 있는 경우만 하나 추출\nconst index = $json.fileIndex || 0;\nconst url = urls[index];\n\n// 없으면 아무것도 하지 않음\nif (!url) {\n  return {};\n}\n\n// 반환은 단일 객체만\nreturn {\n  json: {\n    ...$json,\n    downloadUrl: \"https://www.kicox.or.kr\" + url.trim(),\n    fileIndex: index\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2160,8500],"id":"493418c9-b6c8-4400-8474-b026d6b7b51e","name":"flpth_nm 분리 후 downloadUrl 생성"},{"parameters":{"options":{}},"id":"c3eb9b37-a154-4fee-81fc-072c4cf1ca9e","name":"SplitInBatches5","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-1920,8460]},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-860,8600],"id":"66016715-8591-4c21-b131-27b32b19fc34","name":"Code20"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me","typeVersion":1,"position":[-1320,8700],"id":"c55c16d8-0b98-4494-800a-953170f22ed2"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage=1","responseFormat":"string","options":{}},"id":"159a947e-f560-4a9b-9268-7f6806023b11","name":"Get List HTML4","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-2120,10960]},{"parameters":{"extractionValues":{"values":[{"key":"href","cssSelector":"td.subject > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"966bdb84-ee09-4fea-8766-46ac16e500ff","name":"Extract Links4","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-1940,10960]},{"parameters":{"batchSize":1,"options":{}},"id":"892db56e-f026-41ee-b68a-c74d11f9086c","name":"SplitInBatches8","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-1600,10960]},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'https://www.kicox.or.kr' + $json.href }}"}]},"options":{}},"id":"f5361ec2-5f28-42a1-a9bd-f1d7e4b41183","name":"Set Full URL4","type":"n8n-nodes-base.set","typeVersion":1,"position":[-1400,10960]},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"id":"42f41000-34a7-4f69-91e5-9f6508ac6606","name":"Get Detail HTML4","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-1200,10960]},{"parameters":{"extractionValues":{"values":[{"key":"pblanc_nm","cssSelector":"div.detail-area div.title"},{"key":"reqst_begin_end_de","cssSelector":"div.util span.date"},{"key":"bsns_sumry_cn","cssSelector":"div.txt","returnValue":"html"},{"key":"flpth_nm","cssSelector":"span.file-download-list a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"2e18b560-8e76-434c-b6d5-7ed8a56905aa","name":"Extract Content4","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-1040,10960]},{"parameters":{"jsCode":"return $json.href.map(link => ({json: {href: link}}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1780,10960],"id":"b76cbc11-46c1-4d5c-9cd0-d228686b8d25","name":"split2"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"c05996ab-315e-4183-86a1-5fc36cbaef3b","name":"Upload a file5","type":"n8n-nodes-base.httpRequest","position":[-680,11180],"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-340,11260],"id":"932af031-396b-4735-b2de-d26473753e0b","name":"HTTP Request14"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"0cb7011f-df19-4214-b25d-4252f999efc8","name":"do ocr5","type":"n8n-nodes-base.httpRequest","position":[-180,11260],"typeVersion":4.2},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}},"timeout":60000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1020,11360],"id":"e30489e1-fc06-4f64-818e-dd5964859565","name":"download files3","executeOnce":false},{"parameters":{"jsCode":"// OCR 결과를 LLM 프롬프트로 포매팅\nconst ocrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\nreturn {json:{chatInput:`다음은 공고의 첨부파일에서 OCR로 추출한 텍스트입니다...\\n[텍스트 시작]\\n${ocrText}\\n[텍스트 끝]`}};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[40,11260],"id":"6220f347-e44b-4885-86dd-f900e4381354","name":"Code25"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[80,11680],"id":"41ebaca2-1a04-4f9c-87a4-c0f304e0734a","name":"Google Gemini Chat Model4","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[80,11460],"id":"ca316200-b60b-48c5-9f41-236d025d0d67","name":"Basic LLM Chain3"},{"parameters":{"jsCode":"// Gemini 응답에서 JSON 추출 및 후처리\nconst geminiText = $json.text;\nconst match = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif(!match) throw new Error('JSON block not found');\nconst parsed = JSON.parse(match[1]);\nconst full = Array.isArray(parsed.flpth_nm)?parsed.flpth_nm.map(p=>'https://www.kicox.or.kr'+p):parsed.flpth_nm?['https://www.kicox.or.kr'+parsed.flpth_nm]:[];\nreturn {json:{...$json,...parsed,\n  flpth_nm: full.join('@')||null,\n  print_flpth_nm: full[0]||null,\n  exc_instt_nm: parsed.exc_instt_nm||'test',\n  del_yn:'N',\n  creat_p_nttm:new Date().toISOString().slice(0,19).replace('T',' '),\n  created_ts:new Date().toISOString().slice(0,19).replace('T',' ')} };"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[500,11480],"id":"eb9807c9-8138-4970-917f-fabddb98e9d6","name":"Code26"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[700,11480],"id":"75d0a6de-58ea-4746-9c47-2fc8789baf7d","name":"MySQL4","credentials":{"mySql":{"id":"HSXhV0YEF0PlSVWX","name":"MySQL account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const urls=Array.isArray($json.flpth_nm)?$json.flpth_nm.split('@'):[String($json.flpth_nm)];\nconst idx=$json.fileIndex||0;const url=urls[idx];if(!url)return{};return{json:{...$json,downloadUrl:url.trim(),fileIndex:idx}};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1820,11340],"id":"b5739523-97bf-47e7-b44b-abc76b9252dc","name":"flpth_nm 분리 후 downloadUrl 생성2"},{"parameters":{"batchSize":1,"options":{}},"id":"1e102156-0068-49fc-98b2-5071610fe32f","name":"SplitInBatches9","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-1580,11300]},{"parameters":{"jsCode":"for(const item of $input.all()){item.json.myNewField=1;}return $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-500,11440],"id":"b24d51ce-7236-4d2f-844c-0d77a9c47211","name":"Code27"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me2","typeVersion":1,"position":[-980,11540],"id":"0bd6217b-df36-4c03-a244-8c7b87ef31ec"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage=1","responseFormat":"string","options":{}},"id":"1ebfa461-fcb5-43fe-8921-f4e259f67a56","name":"Get List HTML3","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-3320,12940]},{"parameters":{"extractionValues":{"values":[{"key":"href","cssSelector":"td.subject > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"12537f0b-9f30-4411-84d6-f8f612c9c60f","name":"Extract Links3","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-3080,12940]},{"parameters":{"batchSize":1,"options":{}},"id":"4292c723-f5c2-4fea-852d-4acffe2e03a5","name":"SplitInBatches6","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-2740,12940]},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'https://www.kicox.or.kr' + $json.href }}"}]},"options":{}},"id":"fbb0c347-9f79-4fbc-989f-42b7338404ae","name":"Set Full URL3","type":"n8n-nodes-base.set","typeVersion":1,"position":[-2540,12940]},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"id":"dba39ccf-00fa-4fac-85c7-ed449cb2a98a","name":"Get Detail HTML3","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-2340,12940]},{"parameters":{"extractionValues":{"values":[{"key":"pblanc_nm","cssSelector":"div.detail-area div.title"},{"key":"reqst_begin_end_de","cssSelector":"div.util span.date"},{"key":"bsns_sumry_cn","cssSelector":"div.txt","returnValue":"html"},{"key":"flpth_nm","cssSelector":"span.file-download-list a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"fccb9153-693b-4ab4-828d-ec03de2b5877","name":"Extract Content3","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-2180,12940]},{"parameters":{"jsCode":"return $json.href.map(link => ({json:{href:link}}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2920,12940],"id":"dc88be00-d683-49c8-bd27-ce6873344013","name":"split1"},{"parameters":{"batchSize":1,"options":{}},"id":"f2cd1eb9-4a1c-4e5d-a38c-1d28af2848b9","name":"SplitInBatches7","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-2720,13220]},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}},"timeout":60000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2460,13220],"id":"8920f1ca-b280-44c8-8d60-22cd3e09b97b","name":"download files2","executeOnce":false},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"6d5cb2fc-3155-4a21-8c74-dcfc6a20d865","name":"Upload a file4","type":"n8n-nodes-base.httpRequest","position":[-2240,13220],"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1780,13200],"id":"96dc4d78-37f7-4aec-bd07-20a921d23517","name":"HTTP Request13"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"b81c65cd-cfcd-4015-9300-6750c989f182","name":"do ocr4","type":"n8n-nodes-base.httpRequest","position":[-1580,13200],"typeVersion":4.2},{"parameters":{"jsCode":"// OCR 텍스트를 LLM 프롬프트로 변환\nconst ocrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\nreturn {json:{chatInput:`다음은 공고 첨부파일 OCR 텍스트입니다.\\n[텍스트 시작]\\n${ocrText}\\n[텍스트 끝]`}};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1740,13600],"id":"3eed60c2-14f2-4717-80f1-e5d40a9823de","name":"Code22"},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1400,13620],"id":"af702688-b746-4a17-bf52-0ed3f34ffab0","name":"Basic LLM Chain2"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-1620,13840],"id":"cea0135c-3025-4ef9-accc-952be9b4e35d","name":"Google Gemini Chat Model3","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"// Gemini 응답에서 JSON 추출\nconst txt = $json.text;\nconst m = txt.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif(!m) throw new Error('JSON block not found');\nconst p = JSON.parse(m[1]);\nconst list = Array.isArray(p.flpth_nm)?p.flpth_nm.map(u=>'https://www.kicox.or.kr'+u):p.flpth_nm?[ 'https://www.kicox.or.kr'+p.flpth_nm ]:[];\nreturn {json:{...$json,...p,\n  flpth_nm: list.join('@')||null,\n  print_flpth_nm: list[0]||null,\n  exc_instt_nm: p.exc_instt_nm||'test',\n  del_yn:'N',\n  creat_p_nttm:new Date().toISOString().slice(0,19).replace('T',' '),\n  created_ts:new Date().toISOString().slice(0,19).replace('T',' ')} };"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1080,13620],"id":"2a7075e3-c345-4c37-86f4-01cd983ffe59","name":"Code23"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[-940,13620],"id":"00b36ddc-8b27-4226-8cec-ed435c72c238","name":"MySQL3","credentials":{"mySql":{"id":"HSXhV0YEF0PlSVWX","name":"MySQL account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"/**\n * flpth_nm 분리 후 downloadUrl 생성 (배열·문자열 모두 대응)\n */\nconst raw = $json.flpth_nm;\nif (!raw) return {};\nlet urls;\nif (Array.isArray(raw)) {\n  urls = raw;\n} else if (typeof raw === 'string') {\n  urls = raw.split('@').filter(Boolean);\n} else {\n  urls = [String(raw)];\n}\nconst idx = $json.fileIndex ?? 0;\nconst url = urls[idx];\nif (!url) return {};\nreturn {\n  json: {\n    ...$json,\n    downloadUrl: url.startsWith('http') ? url : 'https://www.kicox.or.kr' + url,\n    fileIndex: idx\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2940,13220],"id":"a27775f6-7525-44a7-bc4f-6139fba37f78","name":"flpth_nm 분리 후 downloadUrl 생성3"},{"parameters":{"jsCode":"const urls = Array.isArray($json.flpth_nm)\n  ? $json.flpth_nm\n  : String($json.flpth_nm).split('@');\n\nconst index = $json.fileIndex || 0;\nconst url = urls[index];\n\nif (!url) {\n  return {};\n}\n\nreturn {\n  json: {\n    ...$json,\n    downloadUrl: \"https://www.kicox.or.kr\" + url.trim(),\n    fileIndex: index\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3360,15020],"id":"88526e7a-2bd8-47e1-9e49-60924574fc97","name":"flpth_nm 분리 후 downloadUrl 생성1"},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2100,15100],"id":"ea015826-17b2-4772-bdba-d7c41715db21","name":"Code24"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me1","typeVersion":1,"position":[-2240,15260],"id":"ef2ba76f-c854-40a6-80ea-20787e32f1ff"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage=1","responseFormat":"string","options":{}},"id":"6c23326c-7c88-461e-b8fc-c943e99853fe","name":"Get List HTML5","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-3380,14680]},{"parameters":{"extractionValues":{"values":[{"key":"href","cssSelector":"td.subject > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"0a4f031a-8c9c-4e1b-8a4f-1dbabbcaed16","name":"Extract Links5","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-3200,14680]},{"parameters":{"jsCode":"return $json.href.map(link => {\n  return {\n    json: {\n      href: link\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3040,14680],"id":"e948ff60-d02a-4fa4-b082-1e07ecb50fd5","name":"split3"},{"parameters":{"options":{}},"id":"03250a5c-dc1f-42ff-b616-d85f93cc204e","name":"SplitInBatches10","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-2860,14680]},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'https://www.kicox.or.kr' + $json.href }}"}]},"options":{}},"id":"1e817503-d286-4cd9-8710-8eca8c6b98b9","name":"Set Full URL5","type":"n8n-nodes-base.set","typeVersion":1,"position":[-2660,14680]},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"id":"b94a1f84-74a0-41d0-b668-a2e36edecbba","name":"Get Detail HTML5","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-2460,14680]},{"parameters":{"extractionValues":{"values":[{"key":"pblanc_nm","cssSelector":"div.detail-area div.title"},{"key":"reqst_begin_end_de","cssSelector":"div.util span.date"},{"key":"bsns_sumry_cn","cssSelector":"div.txt","returnValue":"html"},{"key":"flpth_nm","cssSelector":"span.file-download-list a\t","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"4e2641de-d86d-4284-8d13-3aad3150789e","name":"Extract Content5","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-2300,14680]},{"parameters":{"options":{}},"id":"d37b30cd-680a-4d97-aeb7-f32391f9758c","name":"SplitInBatches11","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-3100,15020]},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}},"timeout":60000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2840,15020],"id":"576e471a-03b1-4222-8c91-d17df4b3863a","name":"download files4","executeOnce":false},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"ab8aaa16-7ca3-4298-baa8-060d3bd71f10","name":"Upload a file6","type":"n8n-nodes-base.httpRequest","position":[-2480,15000],"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1940,14960],"id":"54ced8e0-190d-41af-abf8-4a2aec520b2d","name":"HTTP Request15"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"4146b8f8-6cc7-4662-9c1d-1e60e68b1acd","name":"do ocr6","type":"n8n-nodes-base.httpRequest","position":[-1780,14960],"typeVersion":4.2},{"parameters":{"jsCode":"const ocrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\n\nreturn {\n  json: {\n    chatInput: `다음은 공고의 첨부파일에서 OCR로 추출한 텍스트입니다. 이 텍스트를 읽고 다음 정보를 요약해 주세요.\n  반환형식을 꼭 지켜!\n\n다음은 정부지원사업 공고의 OCR 텍스트입니다.  \n이 텍스트를 기반으로 아래 JSON 구조에 맞게 항목을 채워 주세요.\n\n각 key는 반드시 그대로 유지하고, 값이 없을 경우 null 또는 기본값을 사용해 주세요.  \n(주석은 설명 용도로만 표시한 것입니다. 응답에서는 제거하고 순수 JSON으로 반환해주세요.)\n\njson\n{\n  \"biz_info_id\": null,                            // (자동 생성. 입력하지 않아도 됨)\n  \"pblanc_nm\": null,                              // 공고 제목\n  \"pblanc_url\": null,                             // 공고 상세 URL\n  \"pblanc_id\": null,                              // 공고 ID\n  \"jrsd_instt_nm\": null,                          // 주관/지원 기관명 (예: 전북특별자치도)\n  \"exc_instt_nm\": null,                           // 수행기관 (예: 직접수행, 외부수행 등)\n  \"bsns_sumry_cn\": null,                          // 공고 요약 (HTML 혹은 일반 텍스트)\n  \"print_flpth_nm\": null,                         // 메인 PDF 링크\n  \"print_file_nm\": null,                          // 메인 PDF 파일명\n  \"flpth_nm\": null,                               // 첨부파일 경로들 (@ 구분)\n  \"file_nm\": null,                                // 첨부파일명 (zip 등)\n\n  \"pldir_sport_realm_lclas_code_nm\": null,        // 대분류 분야명 (예: 기술, 경영 등)\n  \"rcept_engn_hmpg_url\": null,                    // 신청처 홈페이지\n  \"trget_nm\": null,                               // 대상기업 (예: 중소기업, 중견기업 등)\n\n  \"reqst_begin_end_de\": null,                     // 공고 전체 기간 (예: 20240801 ~ 20240930)\n  \"reqst_begin_dt\": null,                         // 시작일 (예: 2024-08-01)\n  \"reqst_end_dt\": null,                           // 마감일 (예: 2024-09-30)\n  \"reqst_mth_papers_cn\": null,                    // 신청 방법 (예: 온라인 접수 등)\n  \"pldir_sport_realm_mlsfc_code_nm\": null,        // 중분류 분야명\n  \"refrnc_nm\": null,                              // 문의처 (예: 전화번호 포함 문장)\n  \"inqire_co\": 0,                                 // 문의 수 (없으면 0)\n\n  \"creat_p_nttm\": null,                           // 공고 등록 일시\n  \"created_ts\": null,                             // 시스템에 등록된 시간\n  \"hash_tags\": null,                              // 키워드 (쉼표 구분)\n  \"del_yn\": \"N\",                                   // 삭제 여부 (기본값 N)\n  \"hide_yn\": \"Y\",                                  // 숨김 여부 (기본값 Y)\n  \"views\": 0,                                     // 조회수 (기본값 0)\n\n  \"is_classified\": \"N\",                           // 분류 여부 (N: 미분류)\n  \"source\": \"기업마당\",                            // 출처 (예: 기업마당)\n  \"main_category\": null,\n  \"sub_category\": null,\n  \"classified_date\": null,\n  \"classified_by\": null,\n\n  \"subsidy_amount\": null,                         // 정부 지원금 (예: \"140억 원\")\n  \"self_contribution_rate\": null,                 // 자부담 비율 (예: \"40% 이상\")\n  \"support_target\": null,                         // 지원 대상 설명\n  \"bonus_points_factors\": null,                   // 가점 요소\n  \"total_budget\": null,                           // 총사업비 (예: \"200억 원\")\n  \"applicant_count\": 0,                           // 모집/선정 수 (없으면 0)\n  \"subsidy_amount_type\": null,                    // 지원금 단위 (예: 연차별, 총액)\n  \"total_budget_type\": null,                      // 총사업비 단위\n  \"equipment_detail_file_path\": null,             // 장비 세부파일 경로\n  \"equipment_detail_file_name\": null              // 장비 세부파일 이름\n}\n\n\n[텍스트 시작]\n${ocrText}\n[텍스트 끝]`}\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1560,14960],"id":"7173e5b3-03de-4bc2-be79-bbaea8c12aa1","name":"Code28"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-1520,15380],"id":"85dd5b92-cf15-4d1c-bb42-84b7a6c43c2b","name":"Google Gemini Chat Model5","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1520,15160],"id":"c75eb927-8c25-42b6-95b1-75e0efbc4258","name":"Basic LLM Chain4"},{"parameters":{"jsCode":"// Gemini 또는 LLM 응답의 텍스트 내용만 추출\nconst geminiText = $json.text; // or $item(0).json.text\n\n// Markdown 코드 블록에서 JSON 추출: ```json\\\\n{...}\\\\n```\nconst jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n\nif (!jsonMatch) {\n  throw new Error(\"JSON block not found in Gemini output.\");\n}\n\nlet parsed;\ntry {\n  parsed = JSON.parse(jsonMatch[1]);\n} catch (err) {\n  throw new Error(\"Failed to parse JSON: \" + err.message);\n}\n\nreturn {\n  json: {\n    ...$json,\n    ...parsed,\n    flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n    print_flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n    exc_instt_nm: parsed.exc_instt_nm || \"test\",\n    del_yn: \"N\",\n    creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \")\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1100,15180],"id":"b9ea37b6-ebaa-4cb2-b6cb-f31b5e3c92b6","name":"Code29"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[-860,15180],"id":"185e8f7e-81b4-43c7-96ac-ea9a1ca2238e","name":"MySQL5","credentials":{"mySql":{"id":"HSXhV0YEF0PlSVWX","name":"MySQL account"}}},{"parameters":{},"name":"execute","type":"n8n-nodes-base.manualTrigger","position":[-4040,16420],"typeVersion":1,"id":"65dc4f8a-2d9d-44a9-8d8f-94440b091610"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2120,16960],"id":"91d097ef-e30a-4514-8373-b241d34fd38f","name":"No Operation, do nothing"},{"parameters":{"url":"https://www.kicox.or.kr/user/bbs/BD_selectBbsList.do?q_bbsCode=1016&currentPage=1","responseFormat":"string","options":{}},"id":"fb5b189a-a773-4340-aeed-445c04bb6315","name":"Get List HTML6","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-4540,16640]},{"parameters":{"extractionValues":{"values":[{"key":"href","cssSelector":"td.subject > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"c9f3b52c-8467-4a4c-b383-68d5b1a47a7f","name":"Extract Links6","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-4200,16640]},{"parameters":{"batchSize":1,"options":{"reset":false}},"id":"b0d6c89d-00c7-43e6-9bb6-2ca5d33b8f20","name":"SplitInBatches12","type":"n8n-nodes-base.splitInBatches","typeVersion":1,"position":[-3840,16640]},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"={{ 'https://www.kicox.or.kr' + $json.href }}"}]},"options":{}},"id":"fd23335b-ae7d-433c-bf2c-2b2f6b4e25fb","name":"Set Full URL6","type":"n8n-nodes-base.set","typeVersion":1,"position":[-3640,16640]},{"parameters":{"url":"={{ $json.fullUrl }}","responseFormat":"string","options":{}},"id":"9b8f5b92-14a9-475a-a959-71852956b89c","name":"Get Detail HTML6","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-3360,16640]},{"parameters":{"extractionValues":{"values":[{"key":"pblanc_nm","cssSelector":"div.detail-area div.title"},{"key":"reqst_begin_end_de","cssSelector":"div.util span.date"},{"key":"bsns_sumry_cn","cssSelector":"div.txt","returnValue":"html"},{"key":"flpth_nm","cssSelector":"span.file-download-list a\t","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"id":"13a4bc2c-ac31-4fff-8ecb-1d283f366afe","name":"Extract Content6","type":"n8n-nodes-base.htmlExtract","typeVersion":1,"position":[-3140,16620]},{"parameters":{"jsCode":"// return $json.href.map(link => {\n//   return {\n//     json: {\n//       href: link\n//     }\n//   };\n// });\nconst links = $json.href || [];\nreturn links.map(link => ({ json: { href: link } }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4040,16640],"id":"de1f04ff-0d74-4049-af91-03edf2799f44","name":"split4"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/octet-stream"},{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"9e3b812d-0b1a-4ccc-a8bb-ed242e16b4f4","name":"Upload a file7","type":"n8n-nodes-base.httpRequest","position":[-2420,16640],"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{$json[\"id\"]}}/url","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2160,16620],"id":"a4530cea-812e-42ec-aeca-f511a5448f7f","name":"HTTP Request16"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer  aJUugk77GjvB8L7smr5n11JlKLab1xE5"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"697b8bdf-6fba-4196-a8a0-b43504e79237","name":"do ocr7","type":"n8n-nodes-base.httpRequest","position":[-2000,16620],"typeVersion":4.2},{"parameters":{"url":"={{ $json.downloadUrl }}","options":{"response":{"response":{"responseFormat":"file"}},"timeout":60000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2640,16640],"id":"a915d68e-ef84-43b2-be10-24afc4b477c0","name":"download files5","executeOnce":false},{"parameters":{"jsCode":"const ocrText = $json.text || $json.ocr_result || JSON.stringify($json, null, 2);\n\nreturn {\n  json: {\n    chatInput: `다음은 공고의 첨부파일에서 OCR로 추출한 텍스트입니다. 이 텍스트를 읽고 다음 정보를 요약해 주세요.\n  반환형식을 꼭 지켜!\n\n다음은 정부지원사업 공고의 OCR 텍스트입니다.  \n이 텍스트를 기반으로 아래 JSON 구조에 맞게 항목을 채워 주세요.\n\n각 key는 반드시 그대로 유지하고, 값이 없을 경우 null 또는 기본값을 사용해 주세요.  \n(주석은 설명 용도로만 표시한 것입니다. 응답에서는 제거하고 순수 JSON으로 반환해주세요.)\n\njson\n{\n  \"biz_info_id\": null,                            // (자동 생성. 입력하지 않아도 됨)\n  \"pblanc_nm\": null,                              // 공고 제목\n  \"pblanc_url\": null,                             // 공고 상세 URL\n  \"pblanc_id\": null,                              // 공고 ID\n  \"jrsd_instt_nm\": null,                          // 주관/지원 기관명 (예: 전북특별자치도)\n  \"exc_instt_nm\": null,                           // 수행기관 (예: 직접수행, 외부수행 등)\n  \"bsns_sumry_cn\": null,                          // 공고 요약 (HTML 혹은 일반 텍스트)\n  \"print_flpth_nm\": null,                         // 메인 PDF 링크\n  \"print_file_nm\": null,                          // 메인 PDF 파일명\n  \"flpth_nm\": null,                               // 첨부파일 경로들 (@ 구분)\n  \"file_nm\": null,                                // 첨부파일명 (zip 등)\n\n  \"pldir_sport_realm_lclas_code_nm\": null,        // 대분류 분야명 (예: 기술, 경영 등)\n  \"rcept_engn_hmpg_url\": null,                    // 신청처 홈페이지\n  \"trget_nm\": null,                               // 대상기업 (예: 중소기업, 중견기업 등)\n\n  \"reqst_begin_end_de\": null,                     // 공고 전체 기간 (예: 20240801 ~ 20240930)\n  \"reqst_begin_dt\": null,                         // 시작일 (예: 2024-08-01)\n  \"reqst_end_dt\": null,                           // 마감일 (예: 2024-09-30)\n  \"reqst_mth_papers_cn\": null,                    // 신청 방법 (예: 온라인 접수 등)\n  \"pldir_sport_realm_mlsfc_code_nm\": null,        // 중분류 분야명\n  \"refrnc_nm\": null,                              // 문의처 (예: 전화번호 포함 문장)\n  \"inqire_co\": 0,                                 // 문의 수 (없으면 0)\n\n  \"creat_p_nttm\": null,                           // 공고 등록 일시\n  \"created_ts\": null,                             // 시스템에 등록된 시간\n  \"hash_tags\": null,                              // 키워드 (쉼표 구분)\n  \"del_yn\": \"N\",                                   // 삭제 여부 (기본값 N)\n  \"hide_yn\": \"Y\",                                  // 숨김 여부 (기본값 Y)\n  \"views\": 0,                                     // 조회수 (기본값 0)\n\n  \"is_classified\": \"N\",                           // 분류 여부 (N: 미분류)\n  \"source\": \"기업마당\",                            // 출처 (예: 기업마당)\n  \"main_category\": null,\n  \"sub_category\": null,\n  \"classified_date\": null,\n  \"classified_by\": null,\n\n  \"subsidy_amount\": null,                         // 정부 지원금 (예: \"140억 원\")\n  \"self_contribution_rate\": null,                 // 자부담 비율 (예: \"40% 이상\")\n  \"support_target\": null,                         // 지원 대상 설명\n  \"bonus_points_factors\": null,                   // 가점 요소\n  \"total_budget\": null,                           // 총사업비 (예: \"200억 원\")\n  \"applicant_count\": 0,                           // 모집/선정 수 (없으면 0)\n  \"subsidy_amount_type\": null,                    // 지원금 단위 (예: 연차별, 총액)\n  \"total_budget_type\": null,                      // 총사업비 단위\n  \"equipment_detail_file_path\": null,             // 장비 세부파일 경로\n  \"equipment_detail_file_name\": null              // 장비 세부파일 이름\n}\n\n\n[텍스트 시작]\n${ocrText}\n[텍스트 끝]`\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1780,16520],"id":"74294323-b2ce-469d-9819-65de5e60b7fc","name":"Code21"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-1600,16820],"id":"d9bc7fea-1b8f-444f-b526-f0da90a1f22a","name":"Google Gemini Chat Model6","credentials":{"googlePalmApi":{"id":"XWAzclOTFyK0A6fs","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1620,16520],"id":"54ea3230-2b77-4a1d-9246-cb5eba8aa9a3","name":"Basic LLM Chain5"},{"parameters":{"jsCode":"// // Gemini 또는 LLM 응답의 텍스트 내용만 추출\n// const geminiText = $json.text; // or $item(0).json.text\n\n// // Markdown 코드 블록에서 JSON 추출: ```json\\n{...}\\n```\n// const jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n\n// if (!jsonMatch) {\n//   throw new Error(\"JSON block not found in Gemini output.\");\n// }\n\n// let parsed;\n// try {\n//   parsed = JSON.parse(jsonMatch[1]);\n// } catch (err) {\n//   throw new Error(\"Failed to parse JSON: \" + err.message);\n// }\n\n// // 후처리 + 경로 가공\n// return {\n//   json: {\n//     ...$json,\n//     ...parsed,\n\n//     flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     print_flpth_nm: Array.isArray(parsed.flpth_nm)\n//       ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n//       : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n//     exc_instt_nm: parsed.exc_instt_nm || \"test\",\n//     del_yn: \"N\",\n//     creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//     created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n//   }\n// };\n\nconst geminiText = $json.text;\nconst jsonMatch = geminiText.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif (!jsonMatch) {\n  throw new Error(\"JSON block not found in Gemini output.\");\n}\n\nlet parsed;\ntry {\n  parsed = JSON.parse(jsonMatch[1]);\n} catch (err) {\n  throw new Error(\"Failed to parse JSON: \" + err.message);\n}\n\n// ✅ text 필드 제외 후 병합\nconst {\n  text, // eslint-disable-line no-unused-vars\n  ...rest\n} = $json;\n\nreturn {\n  json: {\n    ...rest,\n    ...parsed,\n\n    flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? parsed.flpth_nm.map(path => \"https://www.kicox.or.kr\" + path).join(\"@\")\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    print_flpth_nm: Array.isArray(parsed.flpth_nm)\n      ? \"https://www.kicox.or.kr\" + parsed.flpth_nm[0]\n      : parsed.flpth_nm ? \"https://www.kicox.or.kr\" + parsed.flpth_nm : null,\n\n    exc_instt_nm: parsed.exc_instt_nm || \"test\",\n    del_yn: \"N\",\n    creat_p_nttm: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    created_ts: new Date().toISOString().slice(0, 19).replace(\"T\", \" \"),\n    source: \"한국산업단지공단\"\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1260,16520],"id":"b47027dd-2bf9-4e84-a074-8fea7e4c014f","name":"Code30"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// // Run Once for Each Item 모드에 맞춘 Code\n// const urls = Array.isArray($json.flpth_nm)\n//   ? $json.flpth_nm\n//   : String($json.flpth_nm).split('@');\n\n// // 지금 처리 중인 파일 인덱스가 있는 경우만 하나 추출\n// const index = $json.fileIndex || 0;\n// const url = urls[index];\n\n// // 없으면 아무것도 하지 않음\n// if (!url) {\n//   return {};\n// }\n\n// // 반환은 단일 객체만\n// return {\n//   json: {\n//     ...$json,\n//     downloadUrl: \"https://www.kicox.or.kr\" + url.trim(),\n//     fileIndex: index\n//   }\n// };\n\nconst urls = Array.isArray($json.flpth_nm)\n  ? $json.flpth_nm\n  : String($json.flpth_nm || \"\").split('@');\n\nconst index = $json.fileIndex || 0;\nconst url = urls[index];\n\nif (!url) {\n  return {};\n}\n\nreturn {\n  json: {\n    ...$json,\n    downloadUrl: \"https://www.kicox.or.kr\" + url.trim(),\n    fileIndex: index,\n    originalFilePath: url.trim()\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2900,16640],"id":"5fb480be-cd94-4ce2-8d6c-41289dda7692","name":"flpth_nm 분리 후 downloadUrl 생성4"},{"parameters":{"operation":"upsert","table":{"__rl":true,"value":"biz_info","mode":"list","cachedResultName":"biz_info"},"columnToMatchOn":"pblanc_nm","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[-700,16520],"id":"1637d348-47d7-4f83-b677-013c94dfbab1","name":"MySQL7","credentials":{"mySql":{"id":"HSXhV0YEF0PlSVWX","name":"MySQL account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-600,16620],"id":"a4defc11-274c-4b09-a327-b5c5f1d3caeb","name":"No Operation, do nothing1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2140,16040],"id":"8983bdef-2479-4878-98b4-54a181c993b1","name":"Edit Fields"},{"parameters":{"method":"POST","url":"http://43.200.39.170:8000/convert","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2400,16380],"id":"3d81ac4d-9f27-4dd9-9682-ba57eb817f6b","name":"hwp ocr"},{"parameters":{"mode":"raw","jsonOutput":"{{ $json }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2100,16360],"id":"ea07b528-a661-4912-924d-f884240be4ab","name":"Edit Fields1"},{"parameters":{"values":{"string":[{"name":"fullUrl","value":"https://www.kicox.or.kr/user/bbs/BD_selectBbs.do?q_bbsCode=1016&q_bbscttSn=20250529140728157&q_order=&q_clCode="}]},"options":{}},"id":"9dacf9e0-5fed-4aea-95a9-c2a47506af8d","name":"Set Full URL7","type":"n8n-nodes-base.set","typeVersion":1,"position":[-3400,16420]},{"parameters":{"jsCode":"// Code30 - Final merge before DB insert\nconst prevFields = $json;  // This includes Gemini 결과\nconst contextFields = $items(\"Edit Fields\")[0].json;  // Extract된 필드 보존\n\nreturn {\n  json: {\n    ...contextFields,   // 공고명, 공고기간, 요약 등\n    ...prevFields       // OCR + Gemini에서 추출된 정보\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1040,16520],"id":"a96b9185-117e-42ab-be75-65b9cb430728","name":"merge"}],"connections":{"HTTP Request":{"main":[[]]},"HTML Extract":{"main":[[]]},"SplitInBatches":{"main":[[]]},"Prepare countries":{"main":[[]]},"Create Directory":{"main":[[]]},"HTTP Request1":{"main":[[]]},"Code":{"main":[[]]},"AI Agent":{"main":[[]]},"Google Gemini Chat Model":{"ai_languageModel":[[]]},"HTTP Request3":{"main":[[{"node":"Parse Post Links","type":"main","index":0}]]},"Generate Pages":{"main":[[{"node":"HTTP Request3","type":"main","index":0}]]},"Parse Post Links":{"main":[[{"node":"HTTP Request(Post Detail)","type":"main","index":0}]]},"HTTP Request(Post Detail)":{"main":[[{"node":"get downladUrl","type":"main","index":0}]]},"Code3":{"main":[[]]},"get downladUrl":{"main":[[{"node":"Code5","type":"main","index":0}]]},"Code4":{"main":[[{"node":"HTTP Request5","type":"main","index":0}]]},"Code5":{"main":[[{"node":"Code4","type":"main","index":0}]]},"HTTP Request5":{"main":[[{"node":"Code6","type":"main","index":0}]]},"Code6":{"main":[[{"node":"Code7","type":"main","index":0}]]},"Code7":{"main":[[{"node":"Code8","type":"main","index":0}]]},"HTTP Request6":{"main":[[{"node":"Parse Post Links1","type":"main","index":0}]]},"Generate Pages1":{"main":[[{"node":"HTTP Request6","type":"main","index":0}]]},"Parse Post Links1":{"main":[[{"node":"HTTP Request(Post Detail)1","type":"main","index":0}]]},"HTTP Request(Post Detail)1":{"main":[[{"node":"get downladUrl1","type":"main","index":0}]]},"get downladUrl1":{"main":[[{"node":"Code10","type":"main","index":0}]]},"HTTP Request7":{"main":[[{"node":"Upload a file1","type":"main","index":0}]]},"Code9":{"main":[[{"node":"HTTP Request7","type":"main","index":0}]]},"Code10":{"main":[[{"node":"Code9","type":"main","index":0}]]},"Code11":{"main":[[{"node":"Code12","type":"main","index":0}]]},"Code12":{"main":[[]]},"Mistral Upload":{"main":[[{"node":"Mistral Signed URL","type":"main","index":0}]]},"Mistral Signed URL":{"main":[[{"node":"Mistral DOC OCR","type":"main","index":0}]]},"Import PDF":{"main":[[{"node":"Mistral Upload","type":"main","index":0}]]},"Import Image":{"main":[[{"node":"Mistral Upload1","type":"main","index":0}]]},"Mistral Upload1":{"main":[[{"node":"Mistral Signed URL1","type":"main","index":0}]]},"Mistral Signed URL1":{"main":[[{"node":"Mistral IMAGE OCR","type":"main","index":0}]]},"Document URL":{"main":[[{"node":"Mistral IMAGE OCR2","type":"main","index":0}]]},"Image URL":{"main":[[{"node":"Mistral IMAGE OCR1","type":"main","index":0}]]},"Document URL1":{"main":[[{"node":"Document Understanding","type":"main","index":0}]]},"Image URL1":{"main":[[{"node":"Document Mis-Understanding?","type":"main","index":0}]]},"Upload a file":{"main":[[{"node":"Retrieve file","type":"main","index":0}]]},"Retrieve file":{"main":[[{"node":"Retrieve file1","type":"main","index":0}]]},"Retrieve file1":{"main":[[{"node":"do ocr","type":"main","index":0}]]},"HTTP Request8":{"main":[[{"node":"Read/Write Files from Disk","type":"main","index":0},{"node":"Upload a file","type":"main","index":0}]]},"Create Directory1":{"main":[[{"node":"HTTP Request8","type":"main","index":0}]]},"Upload a file1":{"main":[[{"node":"HTTP Request10","type":"main","index":0}]]},"HTTP Request10":{"main":[[{"node":"do ocr1","type":"main","index":0}]]},"do ocr1":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"Get List HTML":{"main":[[{"node":"Extract Links","type":"main","index":0}]]},"Extract Links":{"main":[[{"node":"Set Full URL","type":"main","index":0}]]},"Set Full URL":{"main":[[{"node":"SplitInBatches1","type":"main","index":0}]]},"Get Detail HTML":{"main":[[{"node":"Extract Content","type":"main","index":0}]]},"Extract Content":{"main":[[{"node":"Format JSON","type":"main","index":0}]]},"Format JSON":{"main":[[]]},"SplitInBatches1":{"main":[[{"node":"Get Detail HTML","type":"main","index":0}]]},"Get List HTML1":{"main":[[{"node":"Extract Links1","type":"main","index":0}]]},"Extract Links1":{"main":[[{"node":"Set Full URL1","type":"main","index":0}]]},"Set Full URL1":{"main":[[{"node":"SplitInBatches2","type":"main","index":0}]]},"Get Detail HTML1":{"main":[[{"node":"Extract Content1","type":"main","index":0}]]},"Extract Content1":{"main":[[{"node":"Format JSON1","type":"main","index":0}]]},"SplitInBatches2":{"main":[[{"node":"Get Detail HTML1","type":"main","index":0}]]},"Get List HTML2":{"main":[[{"node":"Extract Links2","type":"main","index":0}]]},"Extract Links2":{"main":[[{"node":"split","type":"main","index":0}]]},"SplitInBatches3":{"main":[[{"node":"Set Full URL2","type":"main","index":0}]]},"Set Full URL2":{"main":[[{"node":"Get Detail HTML2","type":"main","index":0}]]},"Get Detail HTML2":{"main":[[{"node":"Extract Content2","type":"main","index":0}]]},"Extract Content2":{"main":[[{"node":"flpth_nm 분리 후 downloadUrl 생성","type":"main","index":0}]]},"split":{"main":[[{"node":"SplitInBatches3","type":"main","index":0}]]},"Code14":{"main":[[{"node":"MySQL","type":"main","index":0}]]},"Upload a file2":{"main":[[{"node":"HTTP Request11","type":"main","index":0}],[{"node":"Code20","type":"main","index":0}]]},"HTTP Request11":{"main":[[{"node":"do ocr2","type":"main","index":0}]]},"download files":{"main":[[{"node":"Upload a file2","type":"main","index":0}]]},"Code15":{"main":[[]]},"do ocr2":{"main":[[{"node":"Code16","type":"main","index":0}]]},"Code16":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Code17","type":"main","index":0}]]},"Code17":{"main":[[{"node":"MySQL1","type":"main","index":0}]]},"Upload a file3":{"main":[[{"node":"HTTP Request12","type":"main","index":0}]]},"HTTP Request12":{"main":[[{"node":"do ocr3","type":"main","index":0}]]},"do ocr3":{"main":[[{"node":"Code18","type":"main","index":0}]]},"download files1":{"main":[[{"node":"Upload a file3","type":"main","index":0}]]},"Code18":{"main":[[{"node":"Basic LLM Chain1","type":"main","index":0}]]},"Google Gemini Chat Model2":{"ai_languageModel":[[{"node":"Basic LLM Chain1","type":"ai_languageModel","index":0}]]},"Basic LLM Chain1":{"main":[[{"node":"Code19","type":"main","index":0}]]},"Code19":{"main":[[{"node":"MySQL2","type":"main","index":0}]]},"flpth_nm 분리 후 downloadUrl 생성":{"main":[[{"node":"SplitInBatches5","type":"main","index":0}]]},"SplitInBatches5":{"main":[[{"node":"download files","type":"main","index":0}]]},"Replace Me":{"main":[[]]},"Get List HTML4":{"main":[[{"node":"Extract Links4","type":"main","index":0}]]},"Extract Links4":{"main":[[{"node":"split2","type":"main","index":0}]]},"SplitInBatches8":{"main":[[{"node":"Set Full URL4","type":"main","index":0}]]},"Set Full URL4":{"main":[[{"node":"Get Detail HTML4","type":"main","index":0}]]},"Get Detail HTML4":{"main":[[{"node":"Extract Content4","type":"main","index":0}]]},"Extract Content4":{"main":[[{"node":"flpth_nm 분리 후 downloadUrl 생성2","type":"main","index":0}]]},"split2":{"main":[[{"node":"SplitInBatches8","type":"main","index":0}]]},"Upload a file5":{"main":[[{"node":"HTTP Request14","type":"main","index":0}],[{"node":"Code27","type":"main","index":0}]]},"HTTP Request14":{"main":[[{"node":"do ocr5","type":"main","index":0}]]},"do ocr5":{"main":[[{"node":"Code25","type":"main","index":0}]]},"download files3":{"main":[[{"node":"Upload a file5","type":"main","index":0}]]},"Code25":{"main":[[{"node":"Basic LLM Chain3","type":"main","index":0}]]},"Google Gemini Chat Model4":{"ai_languageModel":[[{"node":"Basic LLM Chain3","type":"ai_languageModel","index":0}]]},"Basic LLM Chain3":{"main":[[{"node":"Code26","type":"main","index":0}]]},"Code26":{"main":[[{"node":"MySQL4","type":"main","index":0}]]},"flpth_nm 분리 후 downloadUrl 생성2":{"main":[[{"node":"SplitInBatches9","type":"main","index":0}]]},"SplitInBatches9":{"main":[[{"node":"download files3","type":"main","index":0}]]},"Get List HTML3":{"main":[[{"node":"Extract Links3","type":"main","index":0}]]},"Extract Links3":{"main":[[{"node":"split1","type":"main","index":0}]]},"split1":{"main":[[{"node":"SplitInBatches6","type":"main","index":0}]]},"SplitInBatches6":{"main":[[{"node":"Set Full URL3","type":"main","index":0}]]},"Set Full URL3":{"main":[[{"node":"Get Detail HTML3","type":"main","index":0}]]},"Get Detail HTML3":{"main":[[{"node":"Extract Content3","type":"main","index":0}]]},"Extract Content3":{"main":[[{"node":"flpth_nm 분리 후 downloadUrl 생성3","type":"main","index":0}]]},"SplitInBatches7":{"main":[[{"node":"download files2","type":"main","index":0}]]},"download files2":{"main":[[{"node":"Upload a file4","type":"main","index":0}]]},"Upload a file4":{"main":[[{"node":"HTTP Request13","type":"main","index":0}],[]]},"HTTP Request13":{"main":[[{"node":"do ocr4","type":"main","index":0}]]},"do ocr4":{"main":[[{"node":"Code22","type":"main","index":0}]]},"Code22":{"main":[[{"node":"Basic LLM Chain2","type":"main","index":0}]]},"Basic LLM Chain2":{"main":[[{"node":"Code23","type":"main","index":0}]]},"Code23":{"main":[[{"node":"MySQL3","type":"main","index":0}]]},"flpth_nm 분리 후 downloadUrl 생성3":{"main":[[{"node":"SplitInBatches7","type":"main","index":0}]]},"flpth_nm 분리 후 downloadUrl 생성1":{"main":[[{"node":"SplitInBatches11","type":"main","index":0}]]},"Get List HTML5":{"main":[[{"node":"Extract Links5","type":"main","index":0}]]},"Extract Links5":{"main":[[{"node":"split3","type":"main","index":0}]]},"split3":{"main":[[{"node":"SplitInBatches10","type":"main","index":0}]]},"SplitInBatches10":{"main":[[{"node":"Set Full URL5","type":"main","index":0}]]},"Set Full URL5":{"main":[[{"node":"Get Detail HTML5","type":"main","index":0}]]},"Get Detail HTML5":{"main":[[{"node":"Extract Content5","type":"main","index":0}]]},"Extract Content5":{"main":[[{"node":"flpth_nm 분리 후 downloadUrl 생성1","type":"main","index":0}]]},"SplitInBatches11":{"main":[[{"node":"download files4","type":"main","index":0}]]},"download files4":{"main":[[{"node":"Upload a file6","type":"main","index":0}]]},"Upload a file6":{"main":[[{"node":"HTTP Request15","type":"main","index":0}],[{"node":"Code24","type":"main","index":0}]]},"HTTP Request15":{"main":[[{"node":"do ocr6","type":"main","index":0}]]},"do ocr6":{"main":[[{"node":"Code28","type":"main","index":0}]]},"Code28":{"main":[[{"node":"Basic LLM Chain4","type":"main","index":0}]]},"Google Gemini Chat Model5":{"ai_languageModel":[[{"node":"Basic LLM Chain4","type":"ai_languageModel","index":0}]]},"Basic LLM Chain4":{"main":[[{"node":"Code29","type":"main","index":0}]]},"Code29":{"main":[[{"node":"MySQL5","type":"main","index":0}]]},"execute":{"main":[[{"node":"Set Full URL7","type":"main","index":0}]]},"No Operation, do nothing":{"main":[[{"node":"SplitInBatches12","type":"main","index":0}]]},"Get List HTML6":{"main":[[{"node":"Extract Links6","type":"main","index":0}]]},"Extract Links6":{"main":[[{"node":"split4","type":"main","index":0}]]},"SplitInBatches12":{"main":[[{"node":"Set Full URL6","type":"main","index":0}]]},"Set Full URL6":{"main":[[]]},"Get Detail HTML6":{"main":[[{"node":"Extract Content6","type":"main","index":0}]]},"Extract Content6":{"main":[[{"node":"flpth_nm 분리 후 downloadUrl 생성4","type":"main","index":0},{"node":"Edit Fields","type":"main","index":0}]]},"split4":{"main":[[{"node":"SplitInBatches12","type":"main","index":0}]]},"Upload a file7":{"main":[[{"node":"HTTP Request16","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"HTTP Request16":{"main":[[{"node":"do ocr7","type":"main","index":0}]]},"do ocr7":{"main":[[{"node":"Code21","type":"main","index":0}]]},"download files5":{"main":[[{"node":"Upload a file7","type":"main","index":0}]]},"Code21":{"main":[[{"node":"Basic LLM Chain5","type":"main","index":0}]]},"Google Gemini Chat Model6":{"ai_languageModel":[[{"node":"Basic LLM Chain5","type":"ai_languageModel","index":0}]]},"Basic LLM Chain5":{"main":[[{"node":"Code30","type":"main","index":0}]]},"Code30":{"main":[[{"node":"merge","type":"main","index":0}]]},"flpth_nm 분리 후 downloadUrl 생성4":{"main":[[{"node":"download files5","type":"main","index":0}]]},"MySQL7":{"main":[[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"No Operation, do nothing1":{"main":[[{"node":"SplitInBatches12","type":"main","index":0}]]},"hwp ocr":{"main":[[]]},"Set Full URL7":{"main":[[{"node":"Get Detail HTML6","type":"main","index":0}]]},"merge":{"main":[[{"node":"MySQL7","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"merge","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"c99c9767-5618-401a-8ce1-f163485e56e3","triggerCount":0,"shared":[{"createdAt":"2025-05-30T08:50:20.570Z","updatedAt":"2025-05-30T08:50:20.570Z","role":"workflow:owner","workflowId":"waOkAKAmDnMvxvVo","projectId":"YGqg9zdxGQSC73yC"}],"tags":[]}