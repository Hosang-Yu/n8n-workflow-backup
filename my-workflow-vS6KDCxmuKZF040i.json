{"createdAt":"2025-05-30T08:08:32.189Z","updatedAt":"2025-06-04T05:07:16.668Z","id":"vS6KDCxmuKZF040i","name":"My workflow","active":false,"isArchived":true,"nodes":[{"parameters":{"command":"mkdir -p  /home/node/.cache/scrapper/"},"name":"Create Directory","type":"n8n-nodes-base.executeCommand","position":[-180,-180],"typeVersion":1,"id":"65a8087b-560e-4706-94f3-ab2d6afd2258","continueOnFail":true},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"1461b7c1-1894-4948-aa4b-c721c37473cc","name":"do ocr","type":"n8n-nodes-base.httpRequest","position":[3200,-220],"typeVersion":4.2,"alwaysOutputData":true,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"content":"## 게시글 루프","height":780,"width":3060},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[800,-400],"id":"7619dc70-3025-4bb7-bc0f-1054603d7c03","name":"Sticky Note"},{"parameters":{"content":"### ocr 이미지 루프","height":360,"width":1780,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1720,-320],"id":"2f0e5764-f28e-4870-b244-097c9983fc62","name":"Sticky Note1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3214aba2-1cb9-4fd8-8c84-f96038b2ba84","leftValue":"={{ $node[\"per 1 img\"].context[\"noItemsLeft\"] }}","rightValue":2,"operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[4080,-220],"id":"94ff36fd-dd06-49f0-b4a9-b5fd154dcbda","name":"ocr end?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"882a64c5-3422-4ffd-b342-2eeb4b1d7abc","leftValue":"={{ $node[\"per 1 announcement\"].context[\"noItemsLeft\"] }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[5000,140],"id":"279c38c3-a65d-4b10-a801-8ade926ddeb6","name":"page end?"},{"parameters":{},"name":"execute","type":"n8n-nodes-base.manualTrigger","position":[-1020,600],"typeVersion":1,"id":"e1aee61b-a4ed-4165-a6fa-471a06846bdf"},{"parameters":{"jsCode":"return {\n        base_url: 'https://www.seoultp.or.kr',\n        board_list: '/user/nd19746.do',\n        api_key: 'gqWjltgMgARE3CsbEOXptHkJeXetB4gO',\n        str: ''\n       }"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-20,-180],"id":"08bb5757-719f-4db2-a55e-ed4e1801a478","name":"settings"},{"parameters":{"url":"={{ $json.base_url + $json.board_list}}?page=2","responseFormat":"string","options":{}},"name":"board list","type":"n8n-nodes-base.httpRequest","position":[160,-180],"typeVersion":1,"id":"a60528d0-aeda-49db-aebd-fefd382ff113"},{"parameters":{"extractionValues":{"values":[{"key":"announcements","cssSelector":"table > tbody > tr > td > a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{}},"name":"html extract board detail list","type":"n8n-nodes-base.htmlExtract","position":[360,-180],"typeVersion":1,"id":"1daf7893-76c3-4408-8c2d-4661cdfca010"},{"parameters":{"functionCode":"return items[0].json.announcements.map(function(announcement) {\n  const match = announcement.match(/'(\\d{8})'/);\n  const match2 = match[0].replaceAll(\"'\", \"\");\n  match2.trim();\n  return {\n  json: {announcement: match2}\n  }\n});"},"name":"Prepare announcement","type":"n8n-nodes-base.function","position":[580,-180],"typeVersion":1,"id":"3eaf8500-7b4d-46fe-81f6-275e93adf094"},{"parameters":{"batchSize":1,"options":{"reset":"={{ $node[\"per 1 announcement\"].context[\"noItemsLeft\"] }}"}},"name":"per 1 announcement","type":"n8n-nodes-base.splitInBatches","position":[960,-180],"typeVersion":1,"id":"3af10cf2-91a4-46dd-a76a-e0a4dd9100fa","executeOnce":false,"alwaysOutputData":false,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $('settings').item.json.base_url + $('settings').item.json.board_list }}?View&boardNo={{ $json.announcement }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1500,-180],"id":"bab97525-5385-4b8f-a9aa-fec32e1ccb4d","name":"get detail"},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"=data","extractionValues":{"values":[{"key":"img","cssSelector":"table > tbody > tr > td > div > p > a > img","returnValue":"attribute","attribute":"src","returnArray":true},{"key":"img2","cssSelector":".table-cont > p > img","returnValue":"attribute","attribute":"src","returnArray":true},{"key":"board","cssSelector":".board-write > tbody > tr > td","returnArray":true}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1740,60],"id":"67200dd7-fd46-4591-90ee-a4fdfc21d8a6","name":"extract img list","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987498f6-b083-4f58-b8a4-62f111640464","leftValue":"={{ $json.board[2].replaceAll('.', '-') }};\n","rightValue":"={{ $today.minus(1, 'years') }}","operator":{"type":"dateTime","operation":"afterOrEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1900,60],"id":"aeb3bab6-0244-47cd-aa99-7c1125e507eb","name":"is it today?"},{"parameters":{"functionCode":"\nconst list1 = $input.first().json.img\nconst list2 = $input.first().json.img2\n\nconst list = list1.concat(list2);\nreturn list.map(function(item) {\n  return {list: item}\n});\n\n \n"},"name":"Prepare imgs","type":"n8n-nodes-base.function","position":[2000,-180],"typeVersion":1,"id":"88767310-1900-4ef0-bc13-b43e0e27fd38"},{"parameters":{"batchSize":1,"options":{"reset":"= {{ $node[\"per 1 img\"].context[\"noItemsLeft\"] }}"}},"name":"per 1 img","type":"n8n-nodes-base.splitInBatches","position":[2200,-180],"typeVersion":1,"id":"dd5a7968-e284-4dc6-b9ac-8815c2854ea7","executeOnce":false,"alwaysOutputData":false},{"parameters":{"url":"={{ $json.list }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition"}]},"options":{"response":{"response":{"fullResponse":true,"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2540,-300],"id":"236bc0b5-3648-46c0-a3ba-b047134081f3","name":"get img","alwaysOutputData":true},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"2dc40e11-144b-426d-9fba-70039d0bb915","name":"Upload a img","type":"n8n-nodes-base.httpRequest","position":[2740,-220],"typeVersion":4.2,"alwaysOutputData":true,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","options":{"allowUnauthorizedCerts":false}},"id":"97444591-c9b1-49ed-bafe-e0281276a924","name":"Retrieve img","type":"n8n-nodes-base.httpRequest","position":[2880,-220],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"options":{"allowUnauthorizedCerts":false}},"id":"c4e84d74-4567-4368-a8b0-820161051b78","name":"Retrieve img2","type":"n8n-nodes-base.httpRequest","position":[3040,-220],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"={{ $('settings').item.json.base_url + $json.list }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition"}]},"options":{"response":{"response":{"fullResponse":true,"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2580,-160],"id":"ec8e1658-b0b1-40a5-b6ee-00dcf2db8d31","name":"get img1","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8b678027-4ef0-48a2-be86-69f6234163bc","leftValue":"={{ $json.list }}","rightValue":"http","operator":{"type":"string","operation":"startsWith"}},{"id":"b89a7288-14b1-482f-83ac-6239ea5c0139","leftValue":"={{ $json.list }}","rightValue":"https","operator":{"type":"string","operation":"startsWith"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2360,-180],"id":"7d2f6db2-0cde-445b-9c6f-90a37e2edec4","name":"url starts with http or https"},{"parameters":{},"id":"037d4a64-ebfd-4770-a939-6d8176438c4c","name":"NoOp","type":"n8n-nodes-base.noOp","position":[3360,-220],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"c224f50d-04dc-493e-94ee-d4d2bb0277c9","name":"output","value":"[]","type":"array"},{"id":"b554eecb-56ca-4f1b-9274-0ee5364403a2","name":"announcement","value":"={{ $json.announcement }}","type":"string"},{"id":"c64b4a12-abaf-4efb-bc69-4e80e6bf628b","name":"iteration","value":0,"type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1180,-180],"id":"e64e4468-2934-4945-80fd-39f375582478","name":"Edit Fields"},{"parameters":{"mode":"raw","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3700,-220],"id":"1866b1df-53e6-4638-b3a6-c479a5f0c941","name":"Edit Fields1"},{"parameters":{"jsCode":"var a =  \n[\n{\n\"list\": \n\"/common/attachfile/attachfileView.do?attachNo=00006275\"\n},\n{\n\"list\": \n\"/common/attachfile/attachfileView.do?attachNo=00006276\"\n},\n{\n\"list\": \n\"/common/attachfile/attachfileView.do?attachNo=00006277\"\n},\n{\n\"list\": \n\"/common/attachfile/attachfileView.do?attachNo=00006278\"\n},\n{\n\"list\": \n\"/common/attachfile/attachfileView.do?attachNo=00006279\"\n}\n]\n\nreturn a;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-600,600],"id":"d9bc60bf-e478-4a9e-a08a-8b0aab4d0426","name":"Code"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}","options":{"allowUnauthorizedCerts":false,"response":{"response":{"responseFormat":"json"}}}},"id":"014a33ee-a2b3-4742-9920-c715701153fa","name":"do ocr1","type":"n8n-nodes-base.httpRequest","position":[820,600],"typeVersion":4.2,"alwaysOutputData":true,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"={{ $json.list }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition"}]},"options":{"response":{"response":{"fullResponse":true,"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[160,520],"id":"d0d45dd1-2dd7-42a1-9370-49dbd5693c1e","name":"get img2","alwaysOutputData":true},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"=file","inputDataFieldName":"data"}]},"options":{"allowUnauthorizedCerts":false}},"id":"ec2e03a4-d9c7-4f82-b7c9-9e4d2e52fac8","name":"Upload a img1","type":"n8n-nodes-base.httpRequest","position":[360,600],"typeVersion":4.2,"alwaysOutputData":true,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","options":{"allowUnauthorizedCerts":false}},"id":"ce22990f-a127-487e-ad62-dd5c1a07716e","name":"Retrieve img1","type":"n8n-nodes-base.httpRequest","position":[500,600],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"options":{"allowUnauthorizedCerts":false}},"id":"6f7f9296-60ea-4a99-92d2-f10b3b832f69","name":"Retrieve img3","type":"n8n-nodes-base.httpRequest","position":[660,600],"typeVersion":4.2,"credentials":{"mistralCloudApi":{"id":"DMvGIk4nGb1Gfy0K","name":"Mistral Cloud account 2"}}},{"parameters":{"url":"={{ $('settings1').item.json.base_url + $json.list }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Disposition"}]},"options":{"response":{"response":{"fullResponse":true,"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[160,680],"id":"51cab20a-44b5-4ce8-be82-d9d79dd568fa","name":"get img3","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8b678027-4ef0-48a2-be86-69f6234163bc","leftValue":"={{ $json.list }}","rightValue":"http","operator":{"type":"string","operation":"startsWith"}},{"id":"b89a7288-14b1-482f-83ac-6239ea5c0139","leftValue":"={{ $json.list }}","rightValue":"https","operator":{"type":"string","operation":"startsWith"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-20,600],"id":"79f008ea-6eb4-4577-8c29-fbf89d6433db","name":"url starts with http or https1"},{"parameters":{},"id":"b796ac9f-6075-4554-bc6d-566f3bd33b5e","name":"NoOp1","type":"n8n-nodes-base.noOp","position":[980,600],"typeVersion":1},{"parameters":{"jsCode":"return {\n        base_url: 'https://www.seoultp.or.kr',\n        board_list: '/user/nd19746.do',\n        api_key: 'gqWjltgMgARE3CsbEOXptHkJeXetB4gO',\n        str: ''\n       }"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-820,600],"id":"1c9056a4-c749-41fb-ba76-e0bcee6fb105","name":"settings1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3214aba2-1cb9-4fd8-8c84-f96038b2ba84","leftValue":"={{ $node[\"test\"].context[\"noItemsLeft\"] }}","rightValue":2,"operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1200,600],"id":"395cb5a9-4bff-4e96-969a-ba5cc4a0dccb","name":"ocr end?1"},{"parameters":{"batchSize":1,"options":{"reset":"= {{ $node[\"test\"].context[\"noItemsLeft\"] }}"}},"name":"test","type":"n8n-nodes-base.splitInBatches","position":[-180,600],"typeVersion":1,"id":"7ba65990-9fed-4a0d-a04c-7497f9b28d7e","executeOnce":false,"alwaysOutputData":false},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"append","field":"pages[0].markdown"}]},"options":{}},"type":"n8n-nodes-base.summarize","typeVersion":1.1,"position":[1640,500],"id":"910026ca-346d-463d-b17f-0bbe20b71431","name":"Summarize"}],"connections":{"Create Directory":{"main":[[{"node":"settings","type":"main","index":0}]]},"do ocr":{"main":[[{"node":"NoOp","type":"main","index":0}]]},"ocr end?":{"main":[[{"node":"page end?","type":"main","index":0}],[{"node":"per 1 img","type":"main","index":0}]]},"page end?":{"main":[[],[{"node":"per 1 announcement","type":"main","index":0}]]},"execute":{"main":[[{"node":"settings1","type":"main","index":0}]]},"settings":{"main":[[{"node":"board list","type":"main","index":0}]]},"board list":{"main":[[{"node":"html extract board detail list","type":"main","index":0}]]},"html extract board detail list":{"main":[[{"node":"Prepare announcement","type":"main","index":0}]]},"Prepare announcement":{"main":[[{"node":"per 1 announcement","type":"main","index":0}]]},"per 1 announcement":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"get detail":{"main":[[{"node":"extract img list","type":"main","index":0}]]},"extract img list":{"main":[[{"node":"is it today?","type":"main","index":0}]]},"is it today?":{"main":[[{"node":"Prepare imgs","type":"main","index":0}],[{"node":"page end?","type":"main","index":0}]]},"Prepare imgs":{"main":[[{"node":"per 1 img","type":"main","index":0}]]},"per 1 img":{"main":[[{"node":"url starts with http or https","type":"main","index":0}]]},"get img":{"main":[[{"node":"Upload a img","type":"main","index":0}]]},"Upload a img":{"main":[[{"node":"Retrieve img","type":"main","index":0}]]},"Retrieve img":{"main":[[{"node":"Retrieve img2","type":"main","index":0}]]},"Retrieve img2":{"main":[[{"node":"do ocr","type":"main","index":0}]]},"get img1":{"main":[[{"node":"Upload a img","type":"main","index":0}]]},"url starts with http or https":{"main":[[{"node":"get img","type":"main","index":0}],[{"node":"get img1","type":"main","index":0}]]},"NoOp":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"get detail","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"ocr end?","type":"main","index":0}]]},"do ocr1":{"main":[[{"node":"NoOp1","type":"main","index":0}]]},"get img2":{"main":[[{"node":"Upload a img1","type":"main","index":0}]]},"Upload a img1":{"main":[[{"node":"Retrieve img1","type":"main","index":0}]]},"Retrieve img1":{"main":[[{"node":"Retrieve img3","type":"main","index":0}]]},"Retrieve img3":{"main":[[{"node":"do ocr1","type":"main","index":0}]]},"get img3":{"main":[[{"node":"Upload a img1","type":"main","index":0}]]},"url starts with http or https1":{"main":[[{"node":"get img2","type":"main","index":0}],[{"node":"get img3","type":"main","index":0}]]},"Code":{"main":[[{"node":"test","type":"main","index":0}]]},"settings1":{"main":[[{"node":"Code","type":"main","index":0}]]},"NoOp1":{"main":[[{"node":"ocr end?1","type":"main","index":0}]]},"test":{"main":[[{"node":"url starts with http or https1","type":"main","index":0}]]},"ocr end?1":{"main":[[{"node":"Summarize","type":"main","index":0}],[{"node":"test","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"c427c58d-4d04-4ff4-95fd-d0b210eaea34","triggerCount":0,"shared":[{"createdAt":"2025-05-30T08:08:32.189Z","updatedAt":"2025-05-30T08:08:32.189Z","role":"workflow:owner","workflowId":"vS6KDCxmuKZF040i","projectId":"YGqg9zdxGQSC73yC"}],"tags":[]}